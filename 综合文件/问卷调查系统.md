### 基于Vue、Spring Boot、微信小程序的问卷调查系统项目

#### 第0讲 课程介绍与项目展示

###### 1、技术要点

1.1.1、前端知识：

​	vue   element  css3   html5   vue-admin-template

1.1.2、后端知识：

​	Spring Boot2.x 、MyBatis Plus

1.1.3、数据库:

 	MySql5.7

1.2、学习收货：

​	1.2.1、掌握Vue Element 开发后台页面的能力，从而深入理解Vue在后台管理系统中的开发流程；

​	1.2.2、掌握运用Spring Boot开发后台接口的能力；

​	1.2.3、最终学会用Vue Element  Spring Boot 从零开始搭建小型前后端分离项目的能力，从而更深入的理解系统中整个数据的流向，从哪里来，到哪里去；

​	1.2.4、学会使用微信小程序开发小程序的能力



###### 2、教学方法：全程手把手从零开发搭建前端、后端、小程序



###### 3、课程目标：

​	掌握前端、后端、小程序开发的能力，打通前后端、小程序数据的能力；



###### 3、项目演示：





#### 第1讲 下载vue-admin-template项目

###### 1、下载地址

```js
1、https://gitee.com/panjiachen/vue-admin-template/ 可以直接点击 clone or download直接下载
2、如果安装了git可以使用  git clone https://github.com/PanJiaChen/vue-admin-template.git 克隆下载
```

###### 2、安装依赖

```js
1、cd vue-admin-template 进入到项目根目录
2、安装依赖  npm install
3、运行 npm run dev
```

###### 3、运行项目报错解决

```js
1. error  Multiple spaces found before '//需要添加该项，否则上级不...'  no-multi-spaces错误
 找到项目的.eslintrc.js配置文件把rules:中的   'no-multi-spaces': 'off'   //关闭空格的检查

2. error    Trailing spaces not allowed                          no-trailing-spaces错误
找到项目的.eslintrc.js配置文件在rules:中添加   'no-trailing-spaces': 'error', // 行末不要空格
```





#### 第2讲  修改配置和菜单创建

###### 1、修改应用的名称

找到src目录下的settings.js配置文件，修改为如下所示

```js
module.exports = {

  title: '问卷调查系统',

  /**
   * @type {boolean} true | false
   * @description Whether fix the header
   */
  fixedHeader: true,   //固定头部

  /**
   * @type {boolean} true | false
   * @description Whether show the logo in sidebar
   */
  sidebarLogo: true  //显示图标
}

```

###### 2、配置项目路由

```js
import Vue from 'vue'
import Router from 'vue-router'

Vue.use(Router)

/* Layout */
import Layout from '@/layout'

/**
 * Note: sub-menu only appear when route children.length >= 1
 * Detail see: https://panjiachen.github.io/vue-element-admin-site/guide/essentials/router-and-nav.html
 *
 * hidden: true                   if set true, item will not show in the sidebar(default is false)
 * alwaysShow: true               if set true, will always show the root menu
 *                                if not set alwaysShow, when item has more than one children route,
 *                                it will becomes nested mode, otherwise not show the root menu
 * redirect: noRedirect           if set noRedirect will no redirect in the breadcrumb
 * name:'router-name'             the name is used by <keep-alive> (must set!!!)
 * meta : {
    roles: ['admin','editor']    control the page roles (you can set multiple roles)
    title: 'title'               the name show in sidebar and breadcrumb (recommend set)
    icon: 'svg-name'/'el-icon-x' the icon show in the sidebar
    breadcrumb: false            if set false, the item will hidden in breadcrumb(default is true)
    activeMenu: '/example/list'  if set path, the sidebar will highlight the path you set
  }
 */

/**
 * constantRoutes
 * a base page that does not have permission requirements
 * all roles can be accessed
 */
export const constantRoutes = [
  {
    path: '/login',
    component: () => import('@/views/login/index'),
    hidden: true
  },

  {
    path: '/404',
    component: () => import('@/views/404'),
    hidden: true
  },
  {
    path: '/',
    component: Layout,
    redirect: '/dashboard',
    children: [{
      path: 'dashboard',
      name: 'Dashboard',
      component: () => import('@/views/dashboard/index'),
      meta: { title: '首页', icon: 'dashboard' }
    }]
  },
    {
    path: '/user',
    alwaysShow: true,
    component: Layout,
    name: 'user',
    meta: { title: '用户管理', icon: 'el-icon-s-help' },
    children: [
      {
        path: 'userList',
        name: 'userList',
        component: () => import('@/views/user/userList'),
        meta: { title: '用户列表', icon: 'table' }
      }
    ]
  },
  {
    path: '/question',
    component: Layout,
    alwaysShow: true,
    name: 'question',
    meta: { title: '问卷管理', icon: 'el-icon-s-help' },
    children: [
      {
        path: 'questionList',
        name: 'questionList',
        component: () => import('@/views/question/questionList'),
        meta: { title: '问卷管理', icon: 'table' }
      },
      {
        path: 'paper',
        name: 'paper',
        component: () => import('@/views/paper/paperList'),
        meta: { title: '试题管理', icon: 'tree' }
      }
    ]
  },
  {
    path: '/questionCount',
    alwaysShow: true,
    component: Layout,
    name: 'questionCount',
    meta: { title: '问卷统计', icon: 'el-icon-s-help' },
    children: [
      {
        path: 'questionCountList',
        name: 'questionCountList',
        component: () => import('@/views/question/questionCountList'),
        meta: { title: '统计管理', icon: 'table' }
      }
    ]
  },
  // 404 page must be placed at the end !!!
  { path: '*', redirect: '/404', hidden: true }
]

const createRouter = () => new Router({
  // mode: 'history', // require service support
  scrollBehavior: () => ({ y: 0 }),
  routes: constantRoutes
})

const router = createRouter()

// Detail see: https://github.com/vuejs/vue-router/issues/1234#issuecomment-357941465
export function resetRouter() {
  const newRouter = createRouter()
  router.matcher = newRouter.matcher // reset router
}

export default router

```

###### 3、新建路由对应的页面





#### 第3讲 数据库设计



#### 第4讲  后台多模块项目创建

###### 1、打开IDEA，点击左上角 File  ->  New -> Project 

![](D:\项目实战\问卷调查系统\资料\images\创建后端项目1-1.png)



###### 2、选择 Maven , Project SDK选择 1.8及以上版本，点击 Next进入下一步；

![](D:\项目实战\问卷调查系统\资料\images\创建项目1-2.png)

###### 3、Name:输入模块或项目名称；Location:选择项目存储的路径；GroupId:包名；ArtifactId:跟模块或项目名一致；然后点击Fihish

![](D:\项目实战\问卷调查系统\资料\images\创建项目1-3.png)

###### 4、按照上述步骤，创建question-admin、question-common、question-wxapi子模块；

###### 5、question-project  pom.xml文件

```js
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <groupId>com.itmk</groupId>
    <artifactId>question-project</artifactId>
    <packaging>pom</packaging>
    <version>1.0-SNAPSHOT</version>
    <modules>
        <module>question-admin</module>
        <module>question-wxapi</module>
        <module>question-common</module>
    </modules>
    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>2.4.4</version>
    </parent>
    <properties>
        <java.version>1.8</java.version>
        <lombok-version>1.18.12</lombok-version>
        <mybatis-plus.version>3.4.2</mybatis-plus.version>
        <druid.version>1.2.1</druid.version>
        <fastjson.version>1.2.68</fastjson.version>
        <commons-lang.version>2.6</commons-lang.version>
        <commons-collections.version>3.2.2</commons-collections.version>
        <commons-io.version>2.6</commons-io.version>
        <mysql-connection.version>8.0.21</mysql-connection.version>
    </properties>
    <dependencyManagement>
        <dependencies>
            <dependency>
                <groupId>mysql</groupId>
                <artifactId>mysql-connector-java</artifactId>
                <version>${mysql-connection.version}</version>
            </dependency>
            <!--mybatis-plus启动器-->
            <dependency>
                <groupId>com.baomidou</groupId>
                <artifactId>mybatis-plus-boot-starter</artifactId>
                <version>${mybatis-plus.version}</version>
            </dependency>
            <!--druid连接池-->
            <dependency>
                <groupId>com.alibaba</groupId>
                <artifactId>druid-spring-boot-starter</artifactId>
                <version>${druid.version}</version>
            </dependency>
            <dependency>
                <groupId>org.projectlombok</groupId>
                <artifactId>lombok</artifactId>
                <version>${lombok-version}</version>
            </dependency>
            <dependency>
                <groupId>commons-lang</groupId>
                <artifactId>commons-lang</artifactId>
                <version>${commons-lang.version}</version>
            </dependency>
            <dependency>
                <groupId>commons-collections</groupId>
                <artifactId>commons-collections</artifactId>
                <version>${commons-collections.version}</version>
            </dependency>
            <dependency>
                <groupId>commons-io</groupId>
                <artifactId>commons-io</artifactId>
                <version>${commons-io.version}</version>
            </dependency>
            <!-- JSON转换工具类依赖 -->
            <dependency>
                <groupId>com.alibaba</groupId>
                <artifactId>fastjson</artifactId>
                <version>${fastjson.version}</version>
            </dependency>
        </dependencies>
    </dependencyManagement>
</project>
```

###### 6、question-admin的pom.xml文件

```js
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <parent>
        <artifactId>question-project</artifactId>
        <groupId>com.itmk</groupId>
        <version>1.0-SNAPSHOT</version>
    </parent>
    <modelVersion>4.0.0</modelVersion>

    <artifactId>question-admin</artifactId>
    <dependencies>
        <dependency>
            <groupId>com.itmk</groupId>
            <artifactId>question-common</artifactId>
            <version>1.0-SNAPSHOT</version>
        </dependency>
        <!--web启动器,对springmvc,serlvet等支持-->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-aop</artifactId>
        </dependency>

        <!--数据库依赖-->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-jdbc</artifactId>
        </dependency>
        <dependency>
            <groupId>mysql</groupId>
            <artifactId>mysql-connector-java</artifactId>
        </dependency>
        <!--mybatis-plus启动器-->
        <dependency>
            <groupId>com.baomidou</groupId>
            <artifactId>mybatis-plus-boot-starter</artifactId>
        </dependency>
        <!--druid连接池-->
        <dependency>
            <groupId>com.alibaba</groupId>
            <artifactId>druid-spring-boot-starter</artifactId>
        </dependency>
    </dependencies>
    <build>
        <plugins>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
                <version>2.1.4.RELEASE</version>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-compiler-plugin</artifactId>
                <version>3.1</version>
                <configuration>
                    <source>${java.version}</source>
                    <target>${java.version}</target>
                </configuration>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-surefire-plugin</artifactId>
                <version>2.19.1</version>
                <configuration>
                    <skipTests>true</skipTests>    <!--打包过程默认关掉单元测试 -->
                </configuration>
            </plugin>
        </plugins>
    </build>

</project>
```

###### 7、question-common模块pom.xml

```js
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <parent>
        <artifactId>question-project</artifactId>
        <groupId>com.itmk</groupId>
        <version>1.0-SNAPSHOT</version>
    </parent>
    <modelVersion>4.0.0</modelVersion>

    <artifactId>question-common</artifactId>
    <dependencies>
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
        </dependency>
        <dependency>
            <groupId>commons-lang</groupId>
            <artifactId>commons-lang</artifactId>
        </dependency>
        <dependency>
            <groupId>commons-collections</groupId>
            <artifactId>commons-collections</artifactId>
        </dependency>
        <dependency>
            <groupId>commons-io</groupId>
            <artifactId>commons-io</artifactId>
        </dependency>
        <!-- JSON转换工具类依赖 -->
        <dependency>
            <groupId>com.alibaba</groupId>
            <artifactId>fastjson</artifactId>
        </dependency>
    </dependencies>

</project>
```

###### 8、question-wxapi模块的pom.xml文件

```js
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <parent>
        <artifactId>question-project</artifactId>
        <groupId>com.itmk</groupId>
        <version>1.0-SNAPSHOT</version>
    </parent>
    <modelVersion>4.0.0</modelVersion>

    <artifactId>question-wxapi</artifactId>
    <dependencies>
        <dependency>
            <groupId>com.itmk</groupId>
            <artifactId>question-common</artifactId>
            <version>1.0-SNAPSHOT</version>
        </dependency>
        <!--web启动器,对springmvc,serlvet等支持-->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-aop</artifactId>
        </dependency>

        <!--数据库依赖-->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-jdbc</artifactId>
        </dependency>
        <dependency>
            <groupId>mysql</groupId>
            <artifactId>mysql-connector-java</artifactId>
        </dependency>
        <!--mybatis-plus启动器-->
        <dependency>
            <groupId>com.baomidou</groupId>
            <artifactId>mybatis-plus-boot-starter</artifactId>
        </dependency>
        <!--druid连接池-->
        <dependency>
            <groupId>com.alibaba</groupId>
            <artifactId>druid-spring-boot-starter</artifactId>
        </dependency>
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
        </dependency>
        <dependency>
            <groupId>commons-lang</groupId>
            <artifactId>commons-lang</artifactId>
        </dependency>
        <dependency>
            <groupId>commons-collections</groupId>
            <artifactId>commons-collections</artifactId>
        </dependency>
        <dependency>
            <groupId>commons-io</groupId>
            <artifactId>commons-io</artifactId>
        </dependency>
        <!-- JSON转换工具类依赖 -->
        <dependency>
            <groupId>com.alibaba</groupId>
            <artifactId>fastjson</artifactId>
        </dependency>
        <!--http requset-->
        <dependency>
            <groupId>com.github.kevinsawicki</groupId>
            <artifactId>http-request</artifactId>
            <version>6.0</version>
        </dependency>
    </dependencies>
    <build>
        <plugins>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
                <version>2.1.4.RELEASE</version>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-compiler-plugin</artifactId>
                <version>3.1</version>
                <configuration>
                    <source>${java.version}</source>
                    <target>${java.version}</target>
                </configuration>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-surefire-plugin</artifactId>
                <version>2.19.1</version>
                <configuration>
                    <skipTests>true</skipTests>    <!--打包过程默认关掉单元测试 -->
                </configuration>
            </plugin>
        </plugins>
    </build>

</project>
```



#### 第5讲 整合MyBatis Plus

**mybatis plus官方教程**

```js
https://mp.baomidou.com/guide/
```



###### **1、新建application.yml文件**

​	1.1、在itmk-base-web模块resources文件下新建 application-test.yml文件

```js
#端口号配置
server:
  port: 8089
#数据库连接配置
spring:
  datasource:
    type: com.alibaba.druid.pool.DruidDataSource
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/question-project?useUnicode=true&characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&useSSL=true&serverTimezone=GMT%2B8
    username: root
    password: 123456

#mybatis plus配置
mybatis-plus:
  configuration:
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
  global-config:
    db-config:
      #配置mybatis plus 在更新时只更新非空和非NULL的字段
      update-strategy: not_empty

logging:
  pattern:
    console: '%d{yyyy-MM-dd} [%thread] %-5level %logger- %msg%n'
```

1.2、在itmk-base-web模块resources文件下新建 application.yml文件

```js
spring:
  profiles:
    active: test
```

###### 2、配置MyBatis Plus配置文件

```js
package com.itmk.config.mybatis;

import com.baomidou.mybatisplus.annotation.DbType;
import com.baomidou.mybatisplus.extension.plugins.MybatisPlusInterceptor;
import com.baomidou.mybatisplus.extension.plugins.inner.PaginationInnerInterceptor;
import org.mybatis.spring.annotation.MapperScan;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
@MapperScan("com.itmk.*.*.mapper")
public class MyBatisPlusConfig {
    // 最新版
    @Bean
    public MybatisPlusInterceptor mybatisPlusInterceptor() {
        MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();
        interceptor.addInnerInterceptor(new PaginationInnerInterceptor(DbType.MYSQL));
        return interceptor;
    }
}
```



###### 3、封装返回值

在itmk-base-common下新建 com.itmk.utils包

```js
package com.itmk.utils;
import lombok.AllArgsConstructor;
import lombok.Data;

@Data
@AllArgsConstructor
public class ResultVo<T> {
    private String msg;
    private int code;
    private T data;
}
```



###### 4、返回状态码定义

在itmk-base-common模块新建com.itmk.status包，然后新建 StatusCode类，如下所示

```js
package com.itmk.status;

/**
 * 返回状态码
 */
public class StatusCode {
    //返回成功
    public static final int SUCCESS_CODE = 200;
    //错误状态码
    public static final int ERROR_CODE = 500;
    //无权限
    public static final int NO_LOGIN = 600;
    public static final int NO_AUTH = 700;
}
```



###### 5、返回工具类的封装

在itmk-base-common模块下的com.itmk.utils包中新建ResultUtils类

```js
package com.itmk.utils;

import com.itmk.status.StatusCode;

/**
 * 数据返回工具类
 */
public class ResultUtils {
    /**
     * 无参数返回
     * @return
     */
    public static ResultVo succcess() {
        return Vo(null, StatusCode.SUCCESS_CODE, null);
    }
    public static ResultVo success(String msg){
        return Vo(msg,StatusCode.SUCCESS_CODE,null);
    }
    /**
     * 返回带参数
     * @param msg
     * @param data
     * @return
     */
    public static ResultVo success(String msg,Object data){
        return Vo(msg,StatusCode.SUCCESS_CODE,data);
    }
    public static ResultVo success(String msg,int code,Object data){
        return Vo(msg,code,data);
    }
    public static ResultVo Vo(String msg, int code, Object data) {
        return new ResultVo(msg, code, data);
    }

    /**
     * 错误返回
     * @return
     */
    public static ResultVo error(){
        return Vo(null,StatusCode.ERROR_CODE,null);
    }
    public static ResultVo error(String msg){
        return Vo(msg,StatusCode.ERROR_CODE,null);
    }
    public static ResultVo error(String msg,int code,Object data){
        return Vo(msg,code,data);
    }
    public static ResultVo error(String msg,int code){
        return Vo(msg,code,null);
    }
    public static ResultVo error(String msg,Object data){
        return Vo(msg, StatusCode.ERROR_CODE,data);
    }
}
```



#### 第6讲  用户管理接口开发

###### 1、新建实体类

```js
package com.itmk.web.user.entity;

import com.baomidou.mybatisplus.annotation.IdType;
import com.baomidou.mybatisplus.annotation.TableId;
import com.baomidou.mybatisplus.annotation.TableName;
import lombok.Data;

import java.io.Serializable;

/**
 * 系统用户实体类
 */
@Data  //自动生成get和set方法
@TableName("sys_user")  //指定SysUser对应的表名 sys_user
public class SysUser implements Serializable {
    //主键 ,注解：指明主键，然后是自动递增
    @TableId(type = IdType.AUTO)
    private Long userId;
    //登录账户
    private String username;
    //登录密码
    private String password;
    //电话
    private String phone;
    //邮箱
    private String email;
}

```

**接收分页参数的实体类**

```js
package com.itmk.web.user.entity;

import lombok.Data;

import java.io.Serializable;
@Data
public class UserParm implements Serializable {
    //当前第几页
    private Long currentPage;
    //页容量
    private Long pageSize;
}
```

###### 2、新建mapper层

```js
package com.itmk.web.user.mapper;

import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import com.itmk.web.user.entity.SysUser;

/**
 * 用户的数据访问层
 *  继承 mybatis plus 的 BaseMapper，
 *  可以使用他提供的通用的增删改查的方法
 *
 */
public interface SysUserMapper extends BaseMapper<SysUser> {
}
```

###### 3、新建mapper映射文件

```js
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.itmk.web.user.mapper.SysUserMapper">

</mapper>
```

###### 4、新建service层

```js
package com.itmk.web.user.service;

import com.baomidou.mybatisplus.extension.service.IService;
import com.itmk.web.user.entity.SysUser;

public interface SysUserService extends IService<SysUser>{
}

```

**实现类**

```js
package com.itmk.web.user.service.impl;

import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;
import com.itmk.web.user.entity.SysUser;
import com.itmk.web.user.mapper.SysUserMapper;
import com.itmk.web.user.service.SysUserService;
import org.springframework.stereotype.Service;

@Service
public class SysUserServiceImpl extends ServiceImpl<SysUserMapper, SysUser> implements SysUserService {
}

```

###### 5、新建控制器

```js
package com.itmk.web.user.controller;

import com.baomidou.mybatisplus.core.metadata.IPage;
import com.baomidou.mybatisplus.extension.plugins.pagination.Page;
import com.itmk.utils.ResultUtils;
import com.itmk.utils.ResultVo;
import com.itmk.web.user.entity.SysUser;
import com.itmk.web.user.entity.UserParm;
import com.itmk.web.user.service.SysUserService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

/**
 * 用户管理模块控制器
 */
@RestController
public class SysUserController {

    @Autowired
    private SysUserService sysUserService;
    /**
     * 新增
     */
    @PostMapping
    public ResultVo add(@RequestBody SysUser sysUser){
        boolean save = sysUserService.save(sysUser);
        if(save){
            return ResultUtils.success("新增用户成功!");
        }
        return ResultUtils.error("新增用户失败!");
    }
    /**
     * 编辑
     */
    @PutMapping
    public ResultVo edit(@RequestBody SysUser sysUser){
        boolean b = sysUserService.updateById(sysUser);
        if(b){
            return ResultUtils.success("编辑用户成功!");
        }
        return ResultUtils.error("编辑用户失败!");
    }

    /**
     * 删除
     */
    @DeleteMapping("/{userId}")
    public ResultVo delete(@PathVariable("userId") Long userId){
        boolean b = sysUserService.removeById(userId);if(b){
            return ResultUtils.success("删除用户成功!");
        }
        return ResultUtils.error("删除用户失败!");
    }

    /**
     * 列表查询
     */
    @GetMapping("/list")
    public ResultVo getList(UserParm userParm){
        //构造分页对象
        IPage<SysUser> page = new Page<>();
        page.setCurrent(userParm.getCurrentPage());
        page.setSize(userParm.getPageSize());
        IPage<SysUser> list = sysUserService.page(page);
        return ResultUtils.success("查询成功",list);
    }
}
```

###### 6、新建启动类

​	**注意: 启动类需要建在com.itmk包下面**

```js
package com.itmk;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

/**
 * 项目启动类
 */
@SpringBootApplication
public class AdminBootApplication {
    public static void main(String[] args) {
        SpringApplication.run(AdminBootApplication.class,args);
    }
}
```



#### 第7讲 通用对话框的封装

https://element.eleme.cn/#/zh-CN/component/dialog

```js
<template>
  <el-dialog
    top="1vh"
    :title="title"
    :visible.sync="visible"
    :width="width + 'px'"
    :before-close="onClose"
  >
    <div class="container" :style="{ height: height + 'px' }">
      <slot name="content"></slot>
    </div>
    <span slot="footer">
      <el-button type="danger" @click="onClose">取消</el-button>
      <el-button type="primary" @click="onConfirm">确认</el-button>
    </span>
  </el-dialog>
</template>

<script>
export default {
  props: {
    title: {
      type: String,
      default: "标题",
    },
    visible: {
      type: Boolean,
      default: false,
    },
    width: {
      type: Number,
      default: 600,
    },
    height: {
      type: Number,
      default: 400,
    }
  },
  methods: {
    onClose() {
      this.$emit("onClose");
    },
    onConfirm() {
      this.$emit("onConfirm");
    },
  },
};
</script>

<style lang="scss" scoped>
.container {
  overflow-x: inherit;
  overflow-y: auto;
}
.el-dialog__wrapper {
  ::v-deep .el-dialog {
    border-top-left-radius: 7px;
    border-top-right-radius: 7px;
    .el-dialog__header {
      border-top-left-radius: 7px;
      border-top-right-radius: 7px;
      background-color: #1890ff;
      .el-dialog__title {
        color: #fff;
        font-size: 16px;
        font-weight: 600;
      }
      .el-dialog__close {
        color: #fff;
      }
    }
    .el-dialog__body {
      padding: 10px;
    }
    .el-dialog__footer {
      border-top: 1px solid #e8eaec !important;
      padding: 10px;
    }
  }
}
</style>
```



#### 第8讲 通用工具的讲解

###### 1、清空表单工具

在src/utils下面新建 resetForm.js  如下所示

```js
//表单清空
// formName: 表单的ref属性  obj表单的数据域
export default function resetForm(formName,obj){
    //清空表单
    if(this.$refs[formName]){
        this.$refs[formName].resetFields();
    }
    //清空数据域
    Object.keys(obj).forEach(key =>{
        obj[key] = '';
    })
}
```



###### 2、确认弹框封装

在src/utils下面新建 myconfirm.js  如下所示

```js
import {MessageBox,Message} from 'element-ui'
//信息确认弹框封装
export default function myconfirm(text){
    return new Promise((resolve,reject)=>{
        MessageBox.confirm(text,'系统提示',{
            confirmButtonText:'确定',
            cancelButtonText:'取消',
            type:'warning'
        }).then(()=>{
            resolve(true);
        }).catch(()=>{
            Message.warning('已取消')
            reject(false)
        })
    }).catch(()=>{
        
    })
}
```



###### 3、对象快速复制

在src/utils下面新建 objCoppy.js  如下所示

```js
//对象的快速复制  不存在的key不复制
export default async function objCoppy(obj1,obj2){
    Object.keys(obj2).forEach(key =>{
        obj2[key] = obj1[key]
    })
}

```



###### 3、http.js封装

在src/utils下面新建 http.js  如下所示

```js
import axios from 'axios'
import { MessageBox, Message } from 'element-ui'
import store from '@/store'
import { getToken } from '@/utils/auth'
import qs from 'qs'
// create an axios instance
//创建一个axios实例
const service = axios.create({
  baseURL: process.env.VUE_APP_BASE_API_PRO, // url = base url + request url
  // withCredentials: true, // send cookies when cross-domain requests
  timeout: 5000 // request timeout
})

// request interceptor
//请求发送之前的拦截器
service.interceptors.request.use(
  config => {
    console.log('发送请求之前')
    console.log(config)
    // do something before request is sent
    //如果token存在，把token添加到请求的头部
    if (store.getters.token) {
      // let each request carry token
      // ['X-Token'] is a custom headers key
      // please modify it according to the actual situation
      config.headers['X-Token'] = getToken()
    }
    return config
  },
  error => {
    // do something with request error
    console.log(error) // for debug
    return Promise.reject(error)
  }
)

// response interceptor
//请求返回之后的处理
service.interceptors.response.use(
  /**
   * If you want to get http information such as headers or status
   * Please return  response => response
  */

  /**
   * Determine the request status by custom code
   * Here is just an example
   * You can also judge the status by HTTP Status Code
   */
  response => {
    const res = response.data

    // if the custom code is not 20000, it is judged as an error.
    if (res.code !== 200) {
      Message({
        message: res.msg || '服务器出错',
        type: 'error',
        duration: 5 * 1000
      })

      // 50008: Illegal token; 50012: Other clients logged in; 50014: Token expired;
      if (res.code === 50008 || res.code === 50012 || res.code === 50014) {
        // to re-login
        MessageBox.confirm('You have been logged out, you can cancel to stay on this page, or log in again', 'Confirm logout', {
          confirmButtonText: 'Re-Login',
          cancelButtonText: 'Cancel',
          type: 'warning'
        }).then(() => {
          store.dispatch('user/resetToken').then(() => {
            location.reload()
          })
        })
      }
      return Promise.reject(new Error(res.msg || '服务器出错'))
    } else {
      return res
    }
  },
  error => {
    console.log('err' + error) // for debug
    Message({
      message: error.msg || '服务器出错!',
      type: 'error',
      duration: 5 * 1000
    })
    return Promise.reject(error)
  }
)

//请求方法
const http = {
    post(url, params) {
      return service.post(url, params, {
        transformRequest: [(params) => {
          return JSON.stringify(params)
        }],
        headers: {
          'Content-Type': 'application/json'
        }
      })
    },
    put(url, params) {
      return service.put(url, params, {
        transformRequest: [(params) => {
          return JSON.stringify(params)
        }],
        headers: {
          'Content-Type': 'application/json'
        }
      })
    },
    //parm =>  {id:10}
    // http://localhost:8089/api/user?id=10
    get(url, params) {
      return service.get(url, {
        params: params,
        paramsSerializer: (params) => {
          return qs.stringify(params)
        }
      })
    },
    //parm =>  {id:10}
    // http://localhost:8089/api/user/10
    getRestApi(url, params) {
      let _params
      if (Object.is(params, undefined || null)) {
        _params = ''
      } else {
        _params = '/'
        for (const key in params) {
          console.log(key)
          console.log(params[key])
          // eslint-disable-next-line no-prototype-builtins
          if (params.hasOwnProperty(key) && params[key] !== null && params[key] !== '') {
            _params += `${params[key]}/`
          }
        }
        //去掉参数最后一位?
        _params = _params.substr(0, _params.length - 1)
      }
      console.log(_params)
      if (_params) {
        return service.get(`${url}${_params}`)
      } else {
        return service.get(url)
      }
    },
    //parm =>  {id:10}
    // http://localhost:8089/api/user/10
    delete(url, params) {
      let _params
      if (Object.is(params, undefined || null)) {
        _params = ''
      } else {
        _params = '/'
        for (const key in params) {
          // eslint-disable-next-line no-prototype-builtins
          if (params.hasOwnProperty(key) && params[key] !== null && params[key] !== '') {
            _params += `${params[key]}/`
          }
        }
        //去掉参数最后一位?
        _params = _params.substr(0, _params.length - 1)
      }
      if (_params) {
        return service.delete(`${url}${_params}`).catch(err => {
          // message.error(err.msg)
          return Promise.reject(err)
        })
      } else {
        return service.delete(url).catch(err => {
          // message.error(err.msg)
          return Promise.reject(err)
        })
      }
    },
    upload(url, params) {
      return service.post(url, params, {
        headers: {
          'Content-Type': 'multipart/form-data'
        }
      })
    }
  }
  export default http

```



#### 第9讲 新增用户页面制作

###### 1、页面完整源码

```js
<template>
  <!-- el-main是一个容器，只需要把他当做正常的div使用就可以
:model 绑定表单的数据域
ref 是相当于div的id
:rules 表单的验证规则
:inline 控制表单的展示方向
size 表单的大小
 -->
  <el-main>
    <el-form
      :model="parms"
      ref="searchForm"
      label-width="80px"
      :inline="true"
      size="small"
    >
      <el-form-item label="问卷标题">
        <el-input v-model="parms.title"></el-input>
      </el-form-item>
      <el-form-item>
        <el-button icon="el-icon-search">搜索</el-button>
        <el-button style="color: #ff7670" icon="el-icon-close">重置</el-button>
        <el-button type="primary" icon="el-icon-plus" @click="addBtn">新增</el-button>
      </el-form-item>
    </el-form>
    <!-- 新增弹框 -->
    <sys-dialog
      :title="addDialog.title"
      :height="addDialog.height"
      :width="addDialog.width"
      :visible="addDialog.visible"
      @onClose="onClose"
      @onConfirm="onConfirm"
    >
      <template slot="content">
        <el-form
          :model="addModel"
          ref="addForm"
          :rules="rules"
          label-width="80px"
          :inline="true"
          size="small"
        >
          <el-form-item prop="phone" label="电话">
            <el-input v-model="addModel.phone"></el-input>
          </el-form-item>
          <el-form-item prop="email" label="邮箱">
            <el-input v-model="addModel.email"></el-input>
          </el-form-item>
          <el-form-item prop="username" label="账户">
            <el-input v-model="addModel.username"></el-input>
          </el-form-item>
          <el-form-item prop="password" label="密码">
            <el-input v-model="addModel.password"></el-input>
          </el-form-item>
        </el-form>
      </template>
    </sys-dialog>
  </el-main>
</template>

<script>
import SysDialog from "@/components/system/SysDialog.vue";
export default {
  //注册组件
  components: { SysDialog },
  //在页面需要展示的数据，都需要在data里面显示的定义
  data() {
    return {
      //新增表单的验证规则
      rules: {
        phone: [
          {
            trigger: "change",
            message: "请填写电话",
            required: true,
          },
        ],
        email: [
          {
            trigger: "change",
            message: "请填写邮箱",
            required: true,
          },
        ],
        username: [
          {
            trigger: "change",
            message: "请填写账户",
            required: true,
          },
        ],
        password: [
          {
            trigger: "change",
            message: "请填写密码",
            required: true,
          },
        ],
      },
      //新增表单绑定的数据域
      addModel: {
        phone: "",
        email: "",
        username: "",
        password: "",
      },
      //弹框属性
      addDialog: {
        title: "",
        height: 180,
        width: 650,
        visible: false,
      },
      parms: {
        title: "",
      },
    };
  },
  methods: {
    //新增按钮
    addBtn() {
      this.addDialog.title = "新增用户";
      this.addDialog.visible = true;
    },
    //确认弹框
    onConfirm() {
      //表单验证
      this.$refs.addForm.validate((valid) => {
        if (valid) {
          this.addDialog.visible = false;
        }
      });
    },
    //关闭弹框
    onClose() {
      this.addDialog.visible = false;
    },
  },
};
</script>

<style lang="scss" scoped></style>

```



#### 第10讲 用户登录对接



###### 1、跨域配置

```js
package com.itmk.config;


import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.CorsRegistry;
import org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

@Configuration
public class WebMvcConfig implements WebMvcConfigurer {
    /**
     * 跨域配置
     * @param registry
     */
    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/**")
                .allowedOriginPatterns("*")
                .allowedMethods("*")
                .allowedHeaders("*")
                .maxAge(3600)
                .allowCredentials(true);
    }
}
```

###### 2、编写登录接口方法

在SysUserController控制器添加登录方法

```js
 /**
     * 用户登录
     */
    @PostMapping("/login")
    public ResultVo login(@RequestBody SysUser sysUser){
        QueryWrapper<SysUser> query = new QueryWrapper<>();
        query.lambda().eq(SysUser::getUsername,sysUser.getUsername())
                .eq(SysUser::getPassword,sysUser.getPassword());
        SysUser one = sysUserService.getOne(query);
        if(one == null){
            return ResultUtils.error("用户名或密码错误!");
        }
        return ResultUtils.success("登录成功",one.getUserId());
    }
```



###### 3、编写获取用户信息的方法

在SysUserController控制器添加getInfo()方法

```js
/**
     * 获取用户信息
     */
    @GetMapping("/getInfo")
    public ResultVo getInfo(Long userId){
        SysUser user = sysUserService.getById(userId);
        return ResultUtils.success("查询成功",user.getUsername());
    }
```



###### 4、在src/api/user.js修改请求登录和获取用户信息的方法如下所示

```js
import http from '@/utils/http'

export async function login(parm){
  return http.post("/api/user/login",parm)
}
export function getInfo(token) {
 return http.get("/api/user/getInfo",{userId:token})
}
```

###### 5、修改src/store/modules下的user.js中  action下的 login() 和 getInfo() 方法如下所示

```js
const actions = {
  // user login
  login({ commit }, userInfo) {
    const { username, password } = userInfo
    return new Promise((resolve, reject) => {
      login({ username: username.trim(), password: password }).then(response => {
        console.log('登录成功')
        console.log(response)
        const { data } = response
        commit('SET_TOKEN', data)
        setToken(data)
        resolve()
      }).catch(error => {
        reject(error)
      })
    })
  },

  // get user info
  getInfo({ commit, state }) {
    return new Promise((resolve, reject) => {
      getInfo(state.token).then(response => {
        const { data } = response

        if (!data) {
          return reject('Verification failed, please Login again.')
        }

        const { name,  } = data

        commit('SET_NAME', name)
        commit('SET_AVATAR', "https://wpimg.wallstcn.com/f778738c-e4f8-4870-b634-56703b4acafe.gif")
        resolve(data)
      }).catch(error => {
        reject(error)
      })
    })
  }
}
```



###### 6、安装qs 

```js
npm install qs
```

###### 7、修改http.js

http.js引入qs，并把状态码 20000改为  200，完整http.js源码如下所示

```js
import axios from 'axios'
import { MessageBox, Message } from 'element-ui'
import store from '@/store'
import { getToken } from '@/utils/auth'
import qs from 'qs'
// create an axios instance
const service = axios.create({
  baseURL: process.env.VUE_APP_BASE_API, // url = base url + request url
  // withCredentials: true, // send cookies when cross-domain requests
  timeout: 5000 // request timeout
})

// request interceptor
service.interceptors.request.use(
  config => {
    // do something before request is sent

    if (store.getters.token) {
      // let each request carry token
      // ['X-Token'] is a custom headers key
      // please modify it according to the actual situation
      config.headers['X-Token'] = getToken()
    }
    return config
  },
  error => {
    // do something with request error
    console.log(error) // for debug
    return Promise.reject(error)
  }
)

// response interceptor
service.interceptors.response.use(
  /**
   * If you want to get http information such as headers or status
   * Please return  response => response
  */

  /**
   * Determine the request status by custom code
   * Here is just an example
   * You can also judge the status by HTTP Status Code
   */
  response => {
    const res = response.data

    // if the custom code is not 20000, it is judged as an error.
    if (res.code !== 200) {
      Message({
        message: res.message || 'Error',
        type: 'error',
        duration: 5 * 1000
      })

      // 50008: Illegal token; 50012: Other clients logged in; 50014: Token expired;
      if (res.code === 50008 || res.code === 50012 || res.code === 50014) {
        // to re-login
        MessageBox.confirm('You have been logged out, you can cancel to stay on this page, or log in again', 'Confirm logout', {
          confirmButtonText: 'Re-Login',
          cancelButtonText: 'Cancel',
          type: 'warning'
        }).then(() => {
          store.dispatch('user/resetToken').then(() => {
            location.reload()
          })
        })
      }
      return Promise.reject(new Error(res.message || 'Error'))
    } else {
      return res
    }
  },
  error => {
    console.log('err' + error) // for debug
    Message({
      message: error.message,
      type: 'error',
      duration: 5 * 1000
    })
    return Promise.reject(error)
  }
)


//请求方法 支持 restful api
const http = {
  post(url, params) {
    return service.post(url, params, {
      transformRequest: [(params) => {
        return JSON.stringify(params)
      }],
      headers: {
        'Content-Type': 'application/json'
      }
    })
  },
  put(url, params) {
    return service.put(url, params, {
      transformRequest: [(params) => {
        return JSON.stringify(params)
      }],
      headers: {
        'Content-Type': 'application/json'
      }
    })
  },
  //parm =>  {id:10}
  // http://localhost:8089/api/user?id=10
  get(url, params) {
    return service.get(url, {
      params: params,
      paramsSerializer: (params) => {
        return qs.stringify(params)
      }
    })
  },
  //parm =>  {id:10}
  // http://localhost:8089/api/user/10
  getRestApi(url, params) {
    let _params
    if (Object.is(params, undefined || null)) {
      _params = ''
    } else {
      _params = '/'
      for (const key in params) {
        console.log(key)
        console.log(params[key])
        // eslint-disable-next-line no-prototype-builtins
        if (params.hasOwnProperty(key) && params[key] !== null && params[key] !== '') {
          _params += `${params[key]}/`
        }
      }
      //去掉参数最后一位?
      _params = _params.substr(0, _params.length - 1)
    }
    console.log(_params)
    if (_params) {
      return service.get(`${url}${_params}`)
    } else {
      return service.get(url)
    }
  },
  //parm =>  {id:10}
  // http://localhost:8089/api/user/10
  delete(url, params) {
    let _params
    if (Object.is(params, undefined || null)) {
      _params = ''
    } else {
      _params = '/'
      for (const key in params) {
        // eslint-disable-next-line no-prototype-builtins
        if (params.hasOwnProperty(key) && params[key] !== null && params[key] !== '') {
          _params += `${params[key]}/`
        }
      }
      //去掉参数最后一位?
      _params = _params.substr(0, _params.length - 1)
    }
    if (_params) {
      return service.delete(`${url}${_params}`).catch(err => {
        // message.error(err.msg)
        return Promise.reject(err)
      })
    } else {
      return service.delete(url).catch(err => {
        // message.error(err.msg)
        return Promise.reject(err)
      })
    }
  },
  upload(url, params) {
    return service.post(url, params, {
      headers: {
        'Content-Type': 'multipart/form-data'
      }
    })
  }
}
export default http

```

###### 8、修改 .env.development  和 .env.production 文件

把VUE_APP_BASE_API 修改为自己的后端地址

```js
VUE_APP_BASE_API = 'http://localhost:8089'
```



#### 第11讲  用户新增对接

###### 1、在api/user.js里面添加addApi()方法

```js
//新增用户
export async function addApi(parm){
  return http.post("/api/user",parm)
}
```



###### 2、在userList.vue页面引入

```js
import {addApi} from '@/api/user'
```



###### 3、新增页面完整源码

由于新增和编辑使用的是同一个弹框，所以需要判断是新增还是编辑，在表单绑定的数据域里面添加editType字段做区分

```js
<template>
  <!-- el-main是一个容器，只需要把他当做正常的div使用就可以
:model 绑定表单的数据域
ref 是相当于div的id
:rules 表单的验证规则
:inline 控制表单的展示方向
size 表单的大小
 -->
  <el-main>
    <el-form
      :model="parms"
      ref="searchForm"
      label-width="80px"
      :inline="true"
      size="small"
    >
      <el-form-item label="问卷标题">
        <el-input v-model="parms.title"></el-input>
      </el-form-item>
      <el-form-item>
        <el-button icon="el-icon-search">搜索</el-button>
        <el-button style="color: #ff7670" icon="el-icon-close">重置</el-button>
        <el-button type="primary" icon="el-icon-plus" @click="addBtn">新增</el-button>
      </el-form-item>
    </el-form>
    <!-- 新增弹框 -->
    <sys-dialog
      :title="addDialog.title"
      :height="addDialog.height"
      :width="addDialog.width"
      :visible="addDialog.visible"
      @onClose="onClose"
      @onConfirm="onConfirm"
    >
      <template slot="content">
        <el-form
          :model="addModel"
          ref="addForm"
          :rules="rules"
          label-width="80px"
          :inline="true"
          size="small"
        >
          <el-form-item prop="phone" label="电话">
            <el-input v-model="addModel.phone"></el-input>
          </el-form-item>
          <el-form-item prop="email" label="邮箱">
            <el-input v-model="addModel.email"></el-input>
          </el-form-item>
          <el-form-item prop="username" label="账户">
            <el-input v-model="addModel.username"></el-input>
          </el-form-item>
          <el-form-item prop="password" label="密码">
            <el-input v-model="addModel.password"></el-input>
          </el-form-item>
        </el-form>
      </template>
    </sys-dialog>
  </el-main>
</template>

<script>
import SysDialog from "@/components/system/SysDialog.vue";
import {addApi} from '@/api/user'
export default {
  //注册组件
  components: { SysDialog },
  //在页面需要展示的数据，都需要在data里面显示的定义
  data() {
    return {
      //新增表单的验证规则
      rules: {
        phone: [
          {
            trigger: "change",
            message: "请填写电话",
            required: true,
          },
        ],
        email: [
          {
            trigger: "change",
            message: "请填写邮箱",
            required: true,
          },
        ],
        username: [
          {
            trigger: "change",
            message: "请填写账户",
            required: true,
          },
        ],
        password: [
          {
            trigger: "change",
            message: "请填写密码",
            required: true,
          },
        ],
      },
      //新增表单绑定的数据域
      addModel: {
        userId:'',
        editType:'', //0：新增 1：编辑
        phone: "",
        email: "",
        username: "",
        password: "",
      },
      //弹框属性
      addDialog: {
        title: "",
        height: 180,
        width: 650,
        visible: false,
      },
      parms: {
        title: "",
      },
    };
  },
  methods: {
    //新增按钮
    addBtn() {
      //设置是新增还是编辑
      this.addModel.editType = '0';
      this.addDialog.title = "新增用户";
      this.addDialog.visible = true;
    },
    //确认弹框
    onConfirm() {
      //表单验证
      this.$refs.addForm.validate(async(valid) => {
        if (valid) {
          let res = null;
          //判断是新增还是编辑
          if(this.addModel.editType =='0'){ //新增
            res = await addApi(this.addModel);
          }
          console.log(res)
          if(res && res.code == 200){
              this.addDialog.visible = false;
          }
        }
      });
    },
    //关闭弹框
    onClose() {
      this.addDialog.visible = false;
    },
  },
};
</script>

<style lang="scss" scoped></style>

```



#### 第12讲 用户列表页面制作与接口对接

###### 1、在src/api/user.js中添加获取列表的方法 getListApi() 方法

```js
//获取用户列表
export async function getListApi(parm){
  return await http.get("/api/user/list",parm)
}
```



###### 2、在userList.vue页面引入

```js
import { addApi, getListApi } from "@/api/user";
```



###### 3、页面完整源码

```js
<template>
  <!-- el-main是一个容器，只需要把他当做正常的div使用就可以
:model 绑定表单的数据域
ref 是相当于div的id
:rules 表单的验证规则
:inline 控制表单的展示方向
size 表单的大小
 -->
  <el-main>
    <el-form
      :model="parms"
      ref="searchForm"
      label-width="80px"
      :inline="true"
      size="small"
    >
      <el-form-item label="问卷标题">
        <el-input v-model="parms.username"></el-input>
      </el-form-item>
      <el-form-item>
        <el-button icon="el-icon-search" @click="searchBtn">搜索</el-button>
        <el-button style="color: #ff7670" @click="resetBtn" icon="el-icon-close">重置</el-button>
        <el-button type="primary" icon="el-icon-plus" @click="addBtn">新增</el-button>
      </el-form-item>
    </el-form>
    <!-- 用户表格
    :data= 是表格的数据

    el-table-column 中的  prop需要跟返回的字段对应
    label 字段的名称
     -->
    <el-table :height="tableHeight" :data="tableList" border stripe>
      <el-table-column prop="username" label="账户"></el-table-column>
      <el-table-column prop="phone" label="电话"></el-table-column>
      <el-table-column prop="email" label="邮箱"></el-table-column>
      <el-table-column align="center" width="180" label="操作">
        <template slot-scope="scope">
          <el-button
            icon="el-icon-edit"
            type="primary"
            size="small"
            @click="editBtn(scope.row)"
            >编辑</el-button
          >
          <el-button
            icon="el-icon-delete"
            type="danger"
            size="small"
            @click="deleteBtn(scope.row)"
            >删除</el-button
          >
        </template>
      </el-table-column>
    </el-table>
    <!-- 分页 
    @size-change 页容量改变时触发的事件
    @current-change 页数改变时触发的事件
    :current-page  当前第几页 
    :page-sizes 
    :page-size  没有查询几条
     :total 总条数
    -->
    <el-pagination
      @size-change="sizeChange"
      @current-change="currentChange"
      :current-page.sync="parms.currentPage"
      :page-sizes="[10, 20, 40, 80, 100]"
      :page-size="parms.pageSize"
      layout="total, sizes, prev, pager, next, jumper"
      :total="parms.total"
      background
    >
    </el-pagination>

    <!-- 新增弹框 -->
    <sys-dialog
      :title="addDialog.title"
      :height="addDialog.height"
      :width="addDialog.width"
      :visible="addDialog.visible"
      @onClose="onClose"
      @onConfirm="onConfirm"
    >
      <template slot="content">
        <el-form
          :model="addModel"
          ref="addForm"
          :rules="rules"
          label-width="80px"
          :inline="true"
          size="small"
        >
          <el-form-item prop="phone" label="电话">
            <el-input v-model="addModel.phone"></el-input>
          </el-form-item>
          <el-form-item prop="email" label="邮箱">
            <el-input v-model="addModel.email"></el-input>
          </el-form-item>
          <el-form-item prop="username" label="账户">
            <el-input v-model="addModel.username"></el-input>
          </el-form-item>
          <el-form-item prop="password" label="密码">
            <el-input v-model="addModel.password"></el-input>
          </el-form-item>
        </el-form>
      </template>
    </sys-dialog>
  </el-main>
</template>

<script>
import SysDialog from "@/components/system/SysDialog.vue";
import { addApi, getListApi } from "@/api/user";
export default {
  //注册组件
  components: { SysDialog },
  //在页面需要展示的数据，都需要在data里面显示的定义
  data() {
    return {
      //表格高度
      tableHeight: 0,
      //表格的数据
      tableList: [],

      //新增表单的验证规则
      rules: {
        phone: [
          {
            trigger: "change",
            message: "请填写电话",
            required: true,
          },
        ],
        email: [
          {
            trigger: "change",
            message: "请填写邮箱",
            required: true,
          },
        ],
        username: [
          {
            trigger: "change",
            message: "请填写账户",
            required: true,
          },
        ],
        password: [
          {
            trigger: "change",
            message: "请填写密码",
            required: true,
          },
        ],
      },
      //新增表单绑定的数据域
      addModel: {
        userId: "",
        editType: "", //0：新增 1：编辑
        phone: "",
        email: "",
        username: "",
        password: "",
      },
      //弹框属性
      addDialog: {
        title: "",
        height: 180,
        width: 650,
        visible: false,
      },
      parms: {
        username: "",
        currentPage: 1, //从第几页开始
        pageSize: 10, //每页查询的条数
        total: 0, //总条数
      },
    };
  },
  created() {
    this.getList();
  },
  mounted() {
    this.$nextTick(() => {
      this.tableHeight = window.innerHeight - 200;
    });
  },
  methods: {
    //搜索按钮
    searchBtn(){
      this.getList();
    },
    //重置按钮
    resetBtn(){
      this.parms.username = '';
      this.getList();
    },
    //页数改变时触发
    currentChange(val) {
      console.log(val);
      this.parms.currentPage = val;
      //重新获取列表
      this.getList();
    },
    //页容量改变时触发
    sizeChange(val) {
      console.log(val);
      this.parms.pageSize = val;
      this.parms.currentPage = 1;
      this.getList();
    },
    //删除按钮
    deleteBtn(row) {
      console.log(row);
    },
    //编辑按钮
    editBtn(row) {
      console.log(row);
    },
    //获取表格列表
    async getList() {
      let res = await getListApi(this.parms);
      console.log(res);
      if (res && res.code == 200) {
        //给表格数据赋值
        this.tableList = res.data.records;
        //总条数
        this.parms.total = res.data.total;
      }
    },
    //新增按钮
    addBtn() {
      //设置是新增还是编辑
      this.addModel.editType = "0";
      this.addDialog.title = "新增用户";
      this.addDialog.visible = true;
    },
    //确认弹框
    onConfirm() {
      //表单验证
      this.$refs.addForm.validate(async (valid) => {
        if (valid) {
          let res = null;
          //判断是新增还是编辑
          if (this.addModel.editType == "0") {
            //新增
            res = await addApi(this.addModel);
          }
          console.log(res);
          if (res && res.code == 200) {
            this.addDialog.visible = false;
          }
        }
      });
    },
    //关闭弹框
    onClose() {
      this.addDialog.visible = false;
    },
  },
};
</script>

<style lang="scss" scoped></style>

```



#### 第13讲 用户编辑、删除接口对接

###### 1、分页中文支持

在main.js中添加如下所示代码

```js
import locale from 'element-ui/lib/locale/lang/zh-CN'
```



###### 2、在src/api/user.js添加编辑、删除的方法

```js
//编辑用户
export async function editApi(parm){
  return await http.put("/api/user",parm)
}
//删除用户
export async function deleteApi(parm){
  return await http.delete("/api/user",parm)
}
```



###### 3、在userList.vue页面引入

```js
import { addApi, getListApi,editApi ,deleteApi} from "@/api/user";
```

######  4、userList.vue页面完整代码

```js
<template>
  <!-- el-main是一个容器，只需要把他当做正常的div使用就可以
:model 绑定表单的数据域
ref 是相当于div的id
:rules 表单的验证规则
:inline 控制表单的展示方向
size 表单的大小
 -->
  <el-main>
    <el-form
      :model="parms"
      ref="searchForm"
      label-width="80px"
      :inline="true"
      size="small"
    >
      <el-form-item label="问卷标题">
        <el-input v-model="parms.username"></el-input>
      </el-form-item>
      <el-form-item>
        <el-button icon="el-icon-search" @click="searchBtn">搜索</el-button>
        <el-button style="color: #ff7670" @click="resetBtn" icon="el-icon-close">重置</el-button>
        <el-button type="primary" icon="el-icon-plus" @click="addBtn">新增</el-button>
      </el-form-item>
    </el-form>
    <!-- 用户表格
    :data= 是表格的数据

    el-table-column 中的  prop需要跟返回的字段对应
    label 字段的名称
     -->
    <el-table :height="tableHeight" :data="tableList" border stripe>
      <el-table-column prop="username" label="账户"></el-table-column>
      <el-table-column prop="phone" label="电话"></el-table-column>
      <el-table-column prop="email" label="邮箱"></el-table-column>
      <el-table-column align="center" width="180" label="操作">
        <template slot-scope="scope">
          <el-button
            icon="el-icon-edit"
            type="primary"
            size="small"
            @click="editBtn(scope.row)"
            >编辑</el-button
          >
          <el-button
            icon="el-icon-delete"
            type="danger"
            size="small"
            @click="deleteBtn(scope.row)"
            >删除</el-button
          >
        </template>
      </el-table-column>
    </el-table>
    <!-- 分页 
    @size-change 页容量改变时触发的事件
    @current-change 页数改变时触发的事件
    :current-page  当前第几页 
    :page-sizes 
    :page-size  没有查询几条
     :total 总条数
    -->
    <el-pagination
      @size-change="sizeChange"
      @current-change="currentChange"
      :current-page.sync="parms.currentPage"
      :page-sizes="[10, 20, 40, 80, 100]"
      :page-size="parms.pageSize"
      layout="total, sizes, prev, pager, next, jumper"
      :total="parms.total"
      background
    >
    </el-pagination>

    <!-- 新增弹框 -->
    <sys-dialog
      :title="addDialog.title"
      :height="addDialog.height"
      :width="addDialog.width"
      :visible="addDialog.visible"
      @onClose="onClose"
      @onConfirm="onConfirm"
    >
      <template slot="content">
        <el-form
          :model="addModel"
          ref="addForm"
          :rules="rules"
          label-width="80px"
          :inline="true"
          size="small"
        >
          <el-form-item prop="phone" label="电话">
            <el-input v-model="addModel.phone"></el-input>
          </el-form-item>
          <el-form-item prop="email" label="邮箱">
            <el-input v-model="addModel.email"></el-input>
          </el-form-item>
          <el-form-item prop="username" label="账户">
            <el-input v-model="addModel.username"></el-input>
          </el-form-item>
          <el-form-item prop="password" label="密码">
            <el-input v-model="addModel.password"></el-input>
          </el-form-item>
        </el-form>
      </template>
    </sys-dialog>
  </el-main>
</template>

<script>
import SysDialog from "@/components/system/SysDialog.vue";
import { addApi, getListApi,editApi ,deleteApi} from "@/api/user";
export default {
  //注册组件
  components: { SysDialog },
  //在页面需要展示的数据，都需要在data里面显示的定义
  data() {
    return {
      //表格高度
      tableHeight: 0,
      //表格的数据
      tableList: [],

      //新增表单的验证规则
      rules: {
        phone: [
          {
            trigger: "change",
            message: "请填写电话",
            required: true,
          },
        ],
        email: [
          {
            trigger: "change",
            message: "请填写邮箱",
            required: true,
          },
        ],
        username: [
          {
            trigger: "change",
            message: "请填写账户",
            required: true,
          },
        ],
        password: [
          {
            trigger: "change",
            message: "请填写密码",
            required: true,
          },
        ],
      },
      //新增表单绑定的数据域
      addModel: {
        userId: "",
        editType: "", //0：新增 1：编辑
        phone: "",
        email: "",
        username: "",
        password: "",
      },
      //弹框属性
      addDialog: {
        title: "",
        height: 180,
        width: 650,
        visible: false,
      },
      parms: {
        username: "",
        currentPage: 1, //从第几页开始
        pageSize: 10, //每页查询的条数
        total: 0, //总条数
      },
    };
  },
  created() {
    this.getList();
  },
  mounted() {
    this.$nextTick(() => {
      this.tableHeight = window.innerHeight - 200;
    });
  },
  methods: {
    //搜索按钮
    searchBtn(){
      this.getList();
    },
    //重置按钮
    resetBtn(){
      this.parms.username = '';
      this.getList();
    },
    //页数改变时触发
    currentChange(val) {
      console.log(val);
      this.parms.currentPage = val;
      //重新获取列表
      this.getList();
    },
    //页容量改变时触发
    sizeChange(val) {
      console.log(val);
      this.parms.pageSize = val;
      this.parms.currentPage = 1;
      this.getList();
    },
    //删除按钮
    async deleteBtn(row) {
      console.log(row);
      //信息确认提示
      let confirm = await this.$myconfirm('确定删除该数据吗?')
      console.log(confirm)
      if(confirm){
        let res = await deleteApi({userId:row.userId})
        if(res && res.code == 200){
          //信息提示
          this.$message.success(res.msg)
          //刷新表格
          this.getList();
        }
      }
    },
    //编辑按钮
    editBtn(row) {
      console.log(row);
      //表单的清空
      this.$resetForm('addForm',this.addModel)
      //设置弹框属性
      this.addDialog.title = '编辑用户'
      this.addDialog.visible = true;
      //设置要编辑的数据回显
      //把当前要编辑的数据设置到表单绑定的数据域
      this.$objCoppy(row,this.addModel)
      console.log(this.addModel)
      //设置为编辑
      this.addModel.editType = '1'; //1:标识编辑
    },
    //获取表格列表
    async getList() {
      let res = await getListApi(this.parms);
      console.log(res);
      if (res && res.code == 200) {
        //给表格数据赋值
        this.tableList = res.data.records;
        //总条数
        this.parms.total = res.data.total;
      }
    },
    //新增按钮
    addBtn() {
      //表单的清空
      this.$resetForm('addForm',this.addModel)
      //设置是新增还是编辑
      this.addModel.editType = "0";
      this.addDialog.title = "新增用户";
      this.addDialog.visible = true;
    },
    //确认弹框
    onConfirm() {
      //表单验证
      this.$refs.addForm.validate(async (valid) => {
        if (valid) {
          let res = null;
          //判断是新增还是编辑
          if (this.addModel.editType == "0") {
            //新增
            res = await addApi(this.addModel);
          }else{
            res = await editApi(this.addModel)
          }
          console.log(res);
          if (res && res.code == 200) {
            //信息提示
            this.$message.success(res.msg)
            //刷新列表
            this.getList();
            this.addDialog.visible = false;
          }
        }
      });
    },
    //关闭弹框
    onClose() {
      this.addDialog.visible = false;
    },
  },
};
</script>

<style lang="scss" scoped></style>

```



#### 第14讲 问卷管理模块接口开发

###### 1、新建实体

```js
package com.itmk.web.question.entity;

import com.baomidou.mybatisplus.annotation.IdType;
import com.baomidou.mybatisplus.annotation.TableId;
import com.baomidou.mybatisplus.annotation.TableName;
import lombok.Data;

import java.io.Serializable;
@Data  //自动生成get和set方法
@TableName("sys_question") //指明该实体对应的数据库表名是 sys_question
public class SysQuestion implements Serializable {
    //主键 自动递增
    @TableId(type = IdType.AUTO)
    private Long questionId;
    //问卷标题
    private String questionTitle;
    //问卷描述
    private String questionDesc;
    //图片路径
    private String questionImg;
    //问卷状态 0：关闭 1：调查中
    private String questionStatus;
    //序号
    private Long questionOrder;
}

```

**列表参数接收类**

```js
package com.itmk.web.question.entity;

import lombok.Data;

import java.io.Serializable;

@Data
public class SysQuestionParn implements Serializable {
    //当前页
    private Long currentPage;
    //页容量 每页的条数
    private Long pageSize;
    //问卷标题
    private String questionTitle;
}

```

###### 2、新建mapper层

```js
package com.itmk.web.question.mapper;

import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import com.itmk.web.question.entity.SysQuestion;

public interface SysQuestionMapper extends BaseMapper<SysQuestion> {
}

```

###### 3、新建mapper映射文件

```js
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.itmk.web.question.mapper.SysQuestionMapper">

</mapper>
```

###### 4、新建service层

```js
package com.itmk.web.question.service;

import com.baomidou.mybatisplus.extension.service.IService;
import com.itmk.web.question.entity.SysQuestion;

public interface SysQuestionService extends IService<SysQuestion> {
}

```

**实现类**

```js
package com.itmk.web.question.service.impl;

import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;
import com.itmk.web.question.entity.SysQuestion;
import com.itmk.web.question.mapper.SysQuestionMapper;
import com.itmk.web.question.service.SysQuestionService;
import org.springframework.stereotype.Service;

@Service
public class SysQuestionServiceImpl extends ServiceImpl<SysQuestionMapper, SysQuestion> implements SysQuestionService {
}

```

###### 5、新建控制器

```js
package com.itmk.web.question.controller;

import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;
import com.baomidou.mybatisplus.core.metadata.IPage;
import com.baomidou.mybatisplus.extension.plugins.pagination.Page;
import com.itmk.utils.ResultUtils;
import com.itmk.utils.ResultVo;
import com.itmk.web.question.entity.SysQuestion;
import com.itmk.web.question.entity.SysQuestionParn;
import com.itmk.web.question.service.SysQuestionService;
import org.apache.commons.lang.StringUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

/**
 * 问卷控制器
 */
@RestController
public class SysQuestionController {
    @Autowired
    private SysQuestionService sysQuestionService;

    /**
     * 新增问卷
     * @param sysQuestion
     * @return
     */
    @PostMapping
    public ResultVo add(@RequestBody SysQuestion sysQuestion){
        boolean save = sysQuestionService.save(sysQuestion);
        if(save){
            return ResultUtils.success("新增问卷成功!");
        }
        return ResultUtils.error("新增问卷失败!");
    }

    /**
     * 编辑问卷
     */
    @PutMapping
    public ResultVo edit(@RequestBody SysQuestion sysQuestion){
        boolean b = sysQuestionService.updateById(sysQuestion);
        if(b){
            return ResultUtils.success("编辑问卷成功!");
        }
        return ResultUtils.error("编辑问卷失败!");
    }

    /**
     * 删除问卷
     * @return
     */
    @DeleteMapping("/{questionId}")
    public ResultVo delete(@PathVariable("questionId") Long questionId){
        boolean b = sysQuestionService.removeById(questionId);
        if(b){
            return ResultUtils.success("删除问卷成功!");
        }
        return ResultUtils.error("删除问卷失败!");
    }

    /**
     * 问卷列表
     */
    @GetMapping("/list")
    public ResultVo getList(SysQuestionParn sysQuestionParn){
        //构造分页对象
        IPage<SysQuestion> page = new Page<>();
        page.setSize(sysQuestionParn.getPageSize());
        page.setCurrent(sysQuestionParn.getCurrentPage());
        //构造查询条件
        QueryWrapper<SysQuestion> query = new QueryWrapper<>();
        //模糊查询
        if(StringUtils.isNotEmpty(sysQuestionParn.getQuestionTitle())){
            query.lambda().like(SysQuestion::getQuestionTitle,sysQuestionParn.getQuestionTitle());
        }
        //排序
        query.lambda().orderByAsc(SysQuestion::getQuestionOrder);
        IPage<SysQuestion> list = sysQuestionService.page(page, query);
        return ResultUtils.success("查询成功",list);
    }
}

```



#### 第15讲 问卷管理列表页面制作与接口对接

###### 1、在src/api下新建question.js

```js
import http from '@/utils/http'
//获取列表
export async function getListApi(parm){
    return await http.get("/api/question/list",parm)
}
```



###### 2、questionList.vue页面引入

```js
import { getListApi } from "@/api/question";
```



###### 3、questionList.vue页面完整代码

```js
<template>
  <el-main>
    <!-- 模糊查询 -->
    <el-form
      :model="parms"
      ref="searchForm"
      label-width="80px"
      :inline="true"
      size="small"
    >
      <el-form-item label="问卷标题">
        <el-input v-model="parms.questionTitle"></el-input>
      </el-form-item>
      <el-form-item>
        <el-button icon="el-icon-search" @click="searchBtn">搜索</el-button>
        <el-button style="color: #ff7670" @click="resetBtn" icon="el-icon-close"
          >重置</el-button
        >
        <el-button type="primary" icon="el-icon-plus">新增</el-button>
      </el-form-item>
    </el-form>
    <!-- 表格列表 -->
    <el-table :height="tableHeight" :data="tableList" border stripe>
      <el-table-column prop="questionTitle" label="问卷标题"></el-table-column>
      <el-table-column prop="questionDesc" label="问卷描述"></el-table-column>
      <el-table-column prop="questionOrder" label="问卷序号"></el-table-column>
      <el-table-column prop="questionStatus" label="状态">
        <template slot-scope="scope">
          <el-tag v-if="scope.row.questionStatus == '0'" type="danger" size="normal"
            >关闭</el-tag
          >
          <el-tag v-if="scope.row.questionStatus == '1'" type="success" size="normal"
            >调查中</el-tag
          >
        </template>
      </el-table-column>
      <el-table-column align="center" width="180" label="操作">
        <template slot-scope="scope">
          <el-button type="primary" size="small" @click="editBtn(scope.row)"
            >编辑</el-button
          >
          <el-button type="danger" size="small" @click="deleteBtn(scope.row)"
            >删除</el-button
          >
        </template>
      </el-table-column>
    </el-table>
    <!-- 分页 
    @size-change 页容量改变时触发的事件
    @current-change 页数改变时触发的事件
    :current-page  当前第几页 
    :page-sizes 
    :page-size  没有查询几条
     :total 总条数
    -->
    <el-pagination
      @size-change="sizeChange"
      @current-change="currentChange"
      :current-page.sync="parms.currentPage"
      :page-sizes="[10, 20, 40, 80, 100]"
      :page-size="parms.pageSize"
      layout="total, sizes, prev, pager, next, jumper"
      :total="parms.total"
      background
    >
    </el-pagination>
  </el-main>
</template>

<script>
import { getListApi } from "@/api/question";
export default {
  data() {
    return {
      //表格的高度
      tableHeight: 0,
      //表格数据
      tableList: [],
      //列表参数
      parms: {
        currentPage: 1,
        pageSize: 10,
        questionTitle: "",
        total: 0, //分页用的总条数
      },
    };
  },
  created() {
    this.getList();
  },
  mounted() {
    this.$nextTick(() => {
      this.tableHeight = window.innerHeight - 200;
    });
  },
  methods: {
    //重置按钮
    resetBtn() {
      this.parms.questionTitle = "";
      this.getList();
    },
    //搜索按钮
    searchBtn() {
      this.getList();
    },
    //页数改变时触发
    currentChange(val) {
      this.parms.currentPage = val;
      this.getList();
    },
    //页容量改变时触发
    sizeChange(val) {
      this.parms.pageSize = val;
      this.parms.currentPage = 1;
      this.getList();
    },
    //删除按钮
    deleteBtn(row) {
      console.log(row);
    },
    //编辑按钮
    editBtn(row) {
      console.log(row);
    },
    //获取列表
    async getList() {
      let res = await getListApi(this.parms);
      if (res && res.code == 200) {
        //给表格数据赋值
        this.tableList = res.data.records;
        //分页总条数
        this.parms.total = res.data.total;
      }
      console.log(res);
    },
  },
};
</script>

<style lang="scss" scoped></style>

```



#### 第16讲 图片上传接口开发

###### 1、配置文件添加文件上传地址

```js
web:
  uploadpath: D:/images/  #图片上传的路径

```

###### 2、文件上传控制器

```js
package com.itmk.web.image.controller;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.multipart.MultipartFile;

import java.io.File;
import java.util.UUID;

/**
 * 图片上传控制器
 */
@RestController
@RequestMapping("/api/upload/")
public class ImageUploadController {
    //图片上传的路径
    @Value("${web.uploadpath}")
    private String webUploadpath;

    @RequestMapping("/uploadImage")
    public String uploadImage(@RequestParam("file")MultipartFile file){
        String Url = null;
        //获取名字
        String fileName = file.getOriginalFilename();
        //扩展名  aa.png
        String fileExtenionName = fileName.substring(fileName.indexOf("."));
        //生成新的名称
        String newName = UUID.randomUUID().toString() + fileExtenionName;
        String path = webUploadpath;
        File fileDir = new File(path);
        if(!fileDir.exists()){
            //设置权限
            fileDir.setWritable(true);
            fileDir.mkdirs();
        }
        File targetFile = new File(path,newName);
        try{
            file.transferTo(targetFile);
            Url = "/" + targetFile.getName();
        }catch (Exception e){
            return  null;
        }
        return "/images" + Url;
    }
}

```



#### 第17讲 新增问卷页面制作与接口对接

###### 1、在src/api/question.js添加addApi()方法

```js
//新增问卷
export async function addApi(parm){
    return await http.post("/api/question",parm)
}
```

###### 2、questionList.vue页面引入

```js
import { getListApi, addApi } from "@/api/question";
```

###### 3、在src/settings.js里面添加请求地址

```js

  baseUrl: 'http://localhost:8089',
  /**
   * 图片上传路径
   */
  imageUrl: 'http://localhost:8089/api/upload/uploadImage'
```

###### 4、questionList.vue页面引入

```js
import { baseUrl, imageUrl } from "@/settings";
```



###### 5、questionList.vue页面完整代码

```js
<template>
  <el-main>
    <!-- 模糊查询 -->
    <el-form
      :model="parms"
      ref="searchForm"
      label-width="80px"
      :inline="true"
      size="small"
    >
      <el-form-item label="问卷标题">
        <el-input v-model="parms.questionTitle"></el-input>
      </el-form-item>
      <el-form-item>
        <el-button icon="el-icon-search" @click="searchBtn">搜索</el-button>
        <el-button style="color: #ff7670" @click="resetBtn" icon="el-icon-close"
          >重置</el-button
        >
        <el-button type="primary" @click="addBtn" icon="el-icon-plus">新增</el-button>
      </el-form-item>
    </el-form>
    <!-- 表格列表 -->
    <el-table :height="tableHeight" :data="tableList" border stripe>
      <el-table-column prop="questionTitle" label="问卷标题"></el-table-column>
      <el-table-column prop="questionDesc" label="问卷描述"></el-table-column>
      <el-table-column prop="questionOrder" label="问卷序号"></el-table-column>
      <el-table-column prop="questionStatus" label="状态">
        <template slot-scope="scope">
          <el-tag v-if="scope.row.questionStatus == '0'" type="danger" size="normal"
            >关闭</el-tag
          >
          <el-tag v-if="scope.row.questionStatus == '1'" type="success" size="normal"
            >调查中</el-tag
          >
        </template>
      </el-table-column>
      <el-table-column align="center" width="180" label="操作">
        <template slot-scope="scope">
          <el-button type="primary" size="small" @click="editBtn(scope.row)"
            >编辑</el-button
          >
          <el-button type="danger" size="small" @click="deleteBtn(scope.row)"
            >删除</el-button
          >
        </template>
      </el-table-column>
    </el-table>
    <!-- 分页 
    @size-change 页容量改变时触发的事件
    @current-change 页数改变时触发的事件
    :current-page  当前第几页 
    :page-sizes 
    :page-size  没有查询几条
     :total 总条数
    -->
    <el-pagination
      @size-change="sizeChange"
      @current-change="currentChange"
      :current-page.sync="parms.currentPage"
      :page-sizes="[10, 20, 40, 80, 100]"
      :page-size="parms.pageSize"
      layout="total, sizes, prev, pager, next, jumper"
      :total="parms.total"
      background
    >
    </el-pagination>
    <!-- 新增弹框 -->
    <sys-dialog
      :title="addDialog.title"
      :width="addDialog.width"
      :height="addDialog.height"
      :visible="addDialog.visible"
      @onClose="onClose"
      @onConfirm="onConfirm"
    >
      <template slot="content">
        <el-form
          :model="addModel"
          ref="addForm"
          :rules="rules"
          label-width="80px"
          :inline="false"
          size="small"
        >
          <el-form-item prop="questionTitle" label="问卷标题">
            <el-input v-model="addModel.questionTitle"></el-input>
          </el-form-item>
          <el-form-item prop="questionDesc" label="问卷描述">
            <el-input type="textarea" v-model="addModel.questionDesc"></el-input>
          </el-form-item>
          <el-form-item prop="questionOrder" label="问卷序号">
            <el-input v-model="addModel.questionOrder"></el-input>
          </el-form-item>
          <el-form-item prop="questionStatus" label="问卷状态">
            <el-radio-group v-model="addModel.questionStatus">
              <el-radio :label="'1'">启用</el-radio>
              <el-radio :label="'0'">停用</el-radio>
            </el-radio-group>
          </el-form-item>
          <el-form-item prop="questionImg" label="问卷图片">
            <!-- el-upload
            action ：图片上传请求的地址
            :auto-upload 自动上传 
             -->
            <el-upload
              :action="onUpLoad()"
              :on-success="onSuccess"
              :file-list="fileList"
              list-type="picture-card"
              :auto-upload="true"
              :limit="1"
            >
              <i slot="default" class="el-icon-plus"></i>
              <div slot="file" slot-scope="{ file }">
                <img class="el-upload-list__item-thumbnail" :src="file.url" alt="" />
                <span class="el-upload-list__item-actions">
                  <span
                    class="el-upload-list__item-preview"
                    @click="handlePictureCardPreview(file)"
                  >
                    <i class="el-icon-zoom-in"></i>
                  </span>
                  <span
                    v-if="!disabled"
                    class="el-upload-list__item-delete"
                    @click="handleRemove(file)"
                  >
                    <i class="el-icon-delete"></i>
                  </span>
                </span>
              </div>
            </el-upload>
            <el-dialog :visible.sync="dialogVisible">
              <img width="100%" :src="dialogImageUrl" alt="" />
            </el-dialog>
          </el-form-item>
        </el-form>
      </template>
    </sys-dialog>
  </el-main>
</template>

<script>
import { getListApi, addApi } from "@/api/question";
import SysDialog from "@/components/system/SysDialog.vue";
import { baseUrl, imageUrl } from "@/settings";
export default {
  //注册组件
  components: {
    SysDialog,
  },
  data() {
    return {
      fileList: [],
      dialogImageUrl: "",
      dialogVisible: false,
      disabled: false,
      //表单验证规则
      rules: {
        questionImg: [
          {
            trigger: "change",
            required: true,
            message: "请上传图片",
          },
        ],
        questionTitle: [
          {
            trigger: "change",
            required: true,
            message: "请填写问卷标题",
          },
        ],
        questionDesc: [
          {
            trigger: "change",
            required: true,
            message: "请填写问卷描述",
          },
        ],
        questionStatus: [
          {
            trigger: "change",
            required: true,
            message: "请选择问卷状态",
          },
        ],
        questionOrder: [
          {
            trigger: "change",
            required: true,
            message: "请选择问卷序号",
          },
        ],
      },
      //新增或编辑表单绑定的数据域
      addModel: {
        editType: "", //0 新增 1 编辑
        questionId: "",
        questionTitle: "",
        questionDesc: "",
        questionImg: "",
        questionStatus: "",
        questionOrder: "",
      },
      //弹框属性
      addDialog: {
        title: "",
        width: 630,
        height: 350,
        visible: false,
      },
      //表格的高度
      tableHeight: 0,
      //表格数据
      tableList: [],
      //列表参数
      parms: {
        currentPage: 1,
        pageSize: 10,
        questionTitle: "",
        total: 0, //分页用的总条数
      },
    };
  },
  created() {
    this.getList();
  },
  mounted() {
    this.$nextTick(() => {
      this.tableHeight = window.innerHeight - 200;
    });
  },
  methods: {
    //图片上传成功的回调
    onSuccess(response, file, fileList) {
      console.log(response);
      console.log(file);
      console.log(fileList);
      this.addModel.questionImg = baseUrl + response;
      this.$message.success("图片上传成功!");
      console.log(this.addModel);
    },
    //图片删除
    handleRemove() {
      this.fileList = [];
      this.addModel.questionImg = "";
    },
    //图片上传请求方法
    onUpLoad() {
      return imageUrl;
    },
    //点击预览
    handlePictureCardPreview(file) {
      console.log(file);
      this.dialogImageUrl = file.url;
      this.dialogVisible = true;
    },
    //新增按钮
    addBtn() {
      //清空表单
      this.$resetForm("addForm", this.addModel);
      //设置编辑类型  新增 还是 编辑
      this.addModel.editType = "0";
      //设置弹框属性
      this.addDialog.title = "新增问卷";
      this.addDialog.visible = true;
    },
    //弹框确认
    onConfirm() {
      //表单验证
      this.$refs.addForm.validate(async (valid) => {
        if (valid) {
          let res = null;
          if (this.addModel.editType == "0") {
            res = await addApi(this.addModel);
          }
          if (res && res.code == 200) {
            //刷新列表
            this.getList();
            //信息提示
            this.$message.success(res.msg);
            this.addDialog.visible = false;
          }
        }
      });
    },
    //弹框关闭
    onClose() {
      this.addDialog.visible = false;
    },
    //重置按钮
    resetBtn() {
      this.parms.questionTitle = "";
      this.getList();
    },
    //搜索按钮
    searchBtn() {
      this.getList();
    },
    //页数改变时触发
    currentChange(val) {
      this.parms.currentPage = val;
      this.getList();
    },
    //页容量改变时触发
    sizeChange(val) {
      this.parms.pageSize = val;
      this.parms.currentPage = 1;
      this.getList();
    },
    //删除按钮
    deleteBtn(row) {
      console.log(row);
    },
    //编辑按钮
    editBtn(row) {
      console.log(row);
    },
    //获取列表
    async getList() {
      let res = await getListApi(this.parms);
      if (res && res.code == 200) {
        //给表格数据赋值
        this.tableList = res.data.records;
        //分页总条数
        this.parms.total = res.data.total;
      }
      console.log(res);
    },
  },
};
</script>

<style lang="scss" scoped></style>

```



#### 第18讲 编辑、删除问卷接口对接

###### 1、element编辑图片回显时动画延时处理

```js
<style>
  /*解决element上传组件回显动画问题*/
  .el-upload-list__item {
    transition: none !important;
  }
</style>
```

###### 2、在src/api/question.js里面添加 editApi() 和 deleteApi()

```js

//编辑
export async function editApi(parm){
    return await http.put("/api/question",parm)
}
//删除
export async function deleteApi(parm){
    return await http.delete("/api/question",parm)
}
```

###### 3、在questionList.vue页面引入

```js
import { getListApi, addApi, editApi, deleteApi } from "@/api/question";
```

###### 4、questionList.vue页面完整代码

```js
<template>
  <el-main>
    <!-- 模糊查询 -->
    <el-form
      :model="parms"
      ref="searchForm"
      label-width="80px"
      :inline="true"
      size="small"
    >
      <el-form-item label="问卷标题">
        <el-input v-model="parms.questionTitle"></el-input>
      </el-form-item>
      <el-form-item>
        <el-button icon="el-icon-search" @click="searchBtn">搜索</el-button>
        <el-button style="color: #ff7670" @click="resetBtn" icon="el-icon-close"
          >重置</el-button
        >
        <el-button type="primary" @click="addBtn" icon="el-icon-plus">新增</el-button>
      </el-form-item>
    </el-form>
    <!-- 表格列表 -->
    <el-table :height="tableHeight" :data="tableList" border stripe>
      <el-table-column prop="questionImg" width="80" label="问卷图片" align="center">
        <template slot-scope="scope">
          <el-image
            style="width: 50px; height: 50px; border-radius: 50%"
            :src="scope.row.questionImg"
          ></el-image>
        </template>
      </el-table-column>
      <el-table-column prop="questionTitle" label="问卷标题"></el-table-column>
      <el-table-column prop="questionDesc" label="问卷描述"></el-table-column>
      <el-table-column prop="questionOrder" label="问卷序号"></el-table-column>
      <el-table-column prop="questionStatus" label="状态">
        <template slot-scope="scope">
          <el-tag v-if="scope.row.questionStatus == '0'" type="danger" size="normal"
            >关闭</el-tag
          >
          <el-tag v-if="scope.row.questionStatus == '1'" type="success" size="normal"
            >调查中</el-tag
          >
        </template>
      </el-table-column>
      <el-table-column align="center" width="180" label="操作">
        <template slot-scope="scope">
          <el-button type="primary" size="small" @click="editBtn(scope.row)"
            >编辑</el-button
          >
          <el-button type="danger" size="small" @click="deleteBtn(scope.row)"
            >删除</el-button
          >
        </template>
      </el-table-column>
    </el-table>
    <!-- 分页 
    @size-change 页容量改变时触发的事件
    @current-change 页数改变时触发的事件
    :current-page  当前第几页 
    :page-sizes 
    :page-size  没有查询几条
     :total 总条数
    -->
    <el-pagination
      @size-change="sizeChange"
      @current-change="currentChange"
      :current-page.sync="parms.currentPage"
      :page-sizes="[10, 20, 40, 80, 100]"
      :page-size="parms.pageSize"
      layout="total, sizes, prev, pager, next, jumper"
      :total="parms.total"
      background
    >
    </el-pagination>
    <!-- 新增弹框 -->
    <sys-dialog
      :title="addDialog.title"
      :width="addDialog.width"
      :height="addDialog.height"
      :visible="addDialog.visible"
      @onClose="onClose"
      @onConfirm="onConfirm"
    >
      <template slot="content">
        <el-form
          :model="addModel"
          ref="addForm"
          :rules="rules"
          label-width="80px"
          :inline="false"
          size="small"
        >
          <el-form-item prop="questionTitle" label="问卷标题">
            <el-input v-model="addModel.questionTitle"></el-input>
          </el-form-item>
          <el-form-item prop="questionDesc" label="问卷描述">
            <el-input type="textarea" v-model="addModel.questionDesc"></el-input>
          </el-form-item>
          <el-form-item prop="questionOrder" label="问卷序号">
            <el-input v-model="addModel.questionOrder"></el-input>
          </el-form-item>
          <el-form-item prop="questionStatus" label="问卷状态">
            <el-radio-group v-model="addModel.questionStatus">
              <el-radio :label="'1'">启用</el-radio>
              <el-radio :label="'0'">停用</el-radio>
            </el-radio-group>
          </el-form-item>
          <el-form-item prop="questionImg" label="问卷图片">
            <!-- el-upload
            action ：图片上传请求的地址
            :auto-upload 自动上传 
             -->
            <el-upload
              :action="onUpLoad()"
              :on-success="onSuccess"
              :file-list="fileList"
              list-type="picture-card"
              :auto-upload="true"
              :limit="1"
            >
              <i slot="default" class="el-icon-plus"></i>
              <div slot="file" slot-scope="{ file }">
                <img class="el-upload-list__item-thumbnail" :src="file.url" alt="" />
                <span class="el-upload-list__item-actions">
                  <span
                    class="el-upload-list__item-preview"
                    @click="handlePictureCardPreview(file)"
                  >
                    <i class="el-icon-zoom-in"></i>
                  </span>
                  <span
                    v-if="!disabled"
                    class="el-upload-list__item-delete"
                    @click="handleRemove(file)"
                  >
                    <i class="el-icon-delete"></i>
                  </span>
                </span>
              </div>
            </el-upload>
            <el-dialog :visible.sync="dialogVisible">
              <img width="100%" :src="dialogImageUrl" alt="" />
            </el-dialog>
          </el-form-item>
        </el-form>
      </template>
    </sys-dialog>
  </el-main>
</template>

<script>
import { getListApi, addApi, editApi, deleteApi } from "@/api/question";
import SysDialog from "@/components/system/SysDialog.vue";
import { baseUrl, imageUrl } from "@/settings";
export default {
  //注册组件
  components: {
    SysDialog,
  },
  data() {
    return {
      fileList: [],
      dialogImageUrl: "",
      dialogVisible: false,
      disabled: false,
      //表单验证规则
      rules: {
        questionImg: [
          {
            trigger: "change",
            required: true,
            message: "请上传图片",
          },
        ],
        questionTitle: [
          {
            trigger: "change",
            required: true,
            message: "请填写问卷标题",
          },
        ],
        questionDesc: [
          {
            trigger: "change",
            required: true,
            message: "请填写问卷描述",
          },
        ],
        questionStatus: [
          {
            trigger: "change",
            required: true,
            message: "请选择问卷状态",
          },
        ],
        questionOrder: [
          {
            trigger: "change",
            required: true,
            message: "请选择问卷序号",
          },
        ],
      },
      //新增或编辑表单绑定的数据域
      addModel: {
        editType: "", //0 新增 1 编辑
        questionId: "",
        questionTitle: "",
        questionDesc: "",
        questionImg: "",
        questionStatus: "",
        questionOrder: "",
      },
      //弹框属性
      addDialog: {
        title: "",
        width: 760,
        height: 410,
        visible: false,
      },
      //表格的高度
      tableHeight: 0,
      //表格数据
      tableList: [],
      //列表参数
      parms: {
        currentPage: 1,
        pageSize: 10,
        questionTitle: "",
        total: 0, //分页用的总条数
      },
    };
  },
  created() {
    this.getList();
  },
  mounted() {
    this.$nextTick(() => {
      this.tableHeight = window.innerHeight - 200;
    });
  },
  methods: {
    //图片上传成功的回调
    onSuccess(response, file, fileList) {
      console.log(response);
      console.log(file);
      console.log(fileList);
      this.addModel.questionImg = baseUrl + response;
      this.$message.success("图片上传成功!");
      console.log(this.addModel);
    },
    //图片删除
    handleRemove() {
      this.fileList = [];
      this.addModel.questionImg = "";
    },
    //图片上传请求方法
    onUpLoad() {
      return imageUrl;
    },
    //点击预览
    handlePictureCardPreview(file) {
      console.log(file);
      this.dialogImageUrl = file.url;
      this.dialogVisible = true;
    },
    //新增按钮
    addBtn() {
      //清空表单
      this.$resetForm("addForm", this.addModel);
      //设置编辑类型  新增 还是 编辑
      this.addModel.editType = "0";
      // 清空图片
      this.fileList = [];
      //设置弹框属性
      this.addDialog.title = "新增问卷";
      this.addDialog.visible = true;
    },
    //删除按钮
    async deleteBtn(row) {
      console.log(row);
      //信息提示
      let confirm = await this.$myconfirm("确定删除该数据吗？");
      if (confirm) {
        let res = await deleteApi({ questionId: row.questionId });
        if (res && res.code == 200) {
          //信息提示
          this.$message.success(res.msg);
          //刷新表格
          this.getList();
        }
      }
    },
    //编辑按钮
    editBtn(row) {
      console.log(row);
      //清空表单
      this.$resetForm("addForm", this.addModel);
      //设置编辑类型  新增 还是 编辑
      this.addModel.editType = "1";
      //设置弹框属性
      this.addDialog.title = "编辑问卷";
      this.addDialog.visible = true;
      // 清空图片
      this.fileList = [];
      //表单数据赋值
      this.$objCoppy(row, this.addModel);
      //图片回显处理
      if (row.questionImg) {
        let obj = {};
        obj.url = row.questionImg;
        this.fileList.push(obj);
      }
    },
    //弹框确认
    onConfirm() {
      //表单验证
      this.$refs.addForm.validate(async (valid) => {
        if (valid) {
          let res = null;
          if (this.addModel.editType == "0") {
            //新增
            res = await addApi(this.addModel);
          } else {
            res = await editApi(this.addModel);
          }
          if (res && res.code == 200) {
            //刷新列表
            this.getList();
            //信息提示
            this.$message.success(res.msg);
            this.addDialog.visible = false;
          }
        }
      });
    },
    //弹框关闭
    onClose() {
      this.addDialog.visible = false;
    },
    //重置按钮
    resetBtn() {
      this.parms.questionTitle = "";
      this.getList();
    },
    //搜索按钮
    searchBtn() {
      this.getList();
    },
    //页数改变时触发
    currentChange(val) {
      this.parms.currentPage = val;
      this.getList();
    },
    //页容量改变时触发
    sizeChange(val) {
      this.parms.pageSize = val;
      this.parms.currentPage = 1;
      this.getList();
    },
    //获取列表
    async getList() {
      let res = await getListApi(this.parms);
      if (res && res.code == 200) {
        //给表格数据赋值
        this.tableList = res.data.records;
        //分页总条数
        this.parms.total = res.data.total;
      }
      console.log(res);
    },
  },
};
</script>

<style lang="scss" scoped></style>

```

###### 5、编辑图片不能显示的问题

application-test.yml添加配置

```js
web:
  uploadpath: D:/images/  #图片上传的路径
  load-path: file:D://images/ #图片访问、加载的路径

```

WebMvcConfig配置为如下所示

```js
package com.itmk.config.webmvc;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.CorsRegistry;
import org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

/**
 * 跨域配置
 */
@Configuration
public class WebMvcConfig implements WebMvcConfigurer {
    //获取图片加载路径
    @Value("${web.load-path}")
    private String loadPath;
    /**
     * 跨域配置
     * @param registry
     */
    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/**")
                .allowedOriginPatterns("*")
                .allowedMethods("*")
                .allowedHeaders("*")
                .maxAge(3600)
                .allowCredentials(true);
    }

    /**
     * 解决图片访问不到的问题
     * @param registry
     */
    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler("/images/**").addResourceLocations(loadPath);
    }
}

```



#### 第19讲 试题管理列表页面制作与接口对接

###### paperList.vue页面代码

```js
<template>
  <el-main>
    <!-- 模糊查询 -->
    <el-form
      :model="parms"
      ref="searchForm"
      label-width="80px"
      :inline="true"
      size="small"
    >
      <el-form-item label="问卷标题">
        <el-input v-model="parms.questionTitle"></el-input>
      </el-form-item>
      <el-form-item>
        <el-button icon="el-icon-search" @click="searchBtn">搜索</el-button>
        <el-button style="color: #ff7670" @click="resetBtn" icon="el-icon-close"
          >重置</el-button
        >
      </el-form-item>
    </el-form>
    <!-- 表格列表 -->
    <el-table :height="tableHeight" :data="tableList" border stripe>
      <el-table-column prop="questionImg" width="80" label="问卷图片" align="center">
        <template slot-scope="scope">
          <el-image
            style="width: 50px; height: 50px; border-radius: 50%"
            :src="scope.row.questionImg"
          ></el-image>
        </template>
      </el-table-column>
      <el-table-column prop="questionTitle" label="问卷标题"></el-table-column>
      <el-table-column prop="questionDesc" label="问卷描述"></el-table-column>
      <el-table-column prop="questionOrder" label="问卷序号"></el-table-column>
      <el-table-column prop="questionStatus" label="状态">
        <template slot-scope="scope">
          <el-tag v-if="scope.row.questionStatus == '0'" type="danger" size="normal"
            >关闭</el-tag
          >
          <el-tag v-if="scope.row.questionStatus == '1'" type="success" size="normal"
            >调查中</el-tag
          >
        </template>
      </el-table-column>
      <el-table-column align="center" width="180" label="操作">
        <template slot-scope="scope">
          <el-button type="success" icon="el-icon-setting" size="small" @click="addPaper(scope.row)"
            >设计试题</el-button
          >
        </template>
      </el-table-column>
    </el-table>
    <!-- 分页 
    @size-change 页容量改变时触发的事件
    @current-change 页数改变时触发的事件
    :current-page  当前第几页 
    :page-sizes 
    :page-size  没有查询几条
     :total 总条数
    -->
    <el-pagination
      @size-change="sizeChange"
      @current-change="currentChange"
      :current-page.sync="parms.currentPage"
      :page-sizes="[10, 20, 40, 80, 100]"
      :page-size="parms.pageSize"
      layout="total, sizes, prev, pager, next, jumper"
      :total="parms.total"
      background
    >
    </el-pagination>
    <!-- 新增弹框 -->
    <sys-dialog
      :title="addDialog.title"
      :width="addDialog.width"
      :height="addDialog.height"
      :visible="addDialog.visible"
      @onClose="onClose"
      @onConfirm="onConfirm"
    >
      <template slot="content"> 弹框 </template>
    </sys-dialog>
  </el-main>
</template>

<script>
import { getListApi, addApi, editApi, deleteApi } from "@/api/question";
import SysDialog from "@/components/system/SysDialog.vue";
import { baseUrl, imageUrl } from "@/settings";
export default {
  //注册组件
  components: {
    SysDialog,
  },
  data() {
    return {
      //弹框属性
      addDialog: {
        title: "",
        width: 760,
        height: 410,
        visible: false,
      },
      //表格的高度
      tableHeight: 0,
      //表格数据
      tableList: [],
      //列表参数
      parms: {
        currentPage: 1,
        pageSize: 10,
        questionTitle: "",
        total: 0, //分页用的总条数
      },
    };
  },
  created() {
    this.getList();
  },
  mounted() {
    this.$nextTick(() => {
      this.tableHeight = window.innerHeight - 200;
    });
  },
  methods: {
    //设计试题按钮
    addPaper(row) {
      console.log(row);
    },
    //重置按钮
    resetBtn() {
      this.parms.questionTitle = "";
      this.getList();
    },
    //搜索按钮
    searchBtn() {
      this.getList();
    },
    //页数改变时触发
    currentChange(val) {
      this.parms.currentPage = val;
      this.getList();
    },
    //页容量改变时触发
    sizeChange(val) {
      this.parms.pageSize = val;
      this.parms.currentPage = 1;
      this.getList();
    },
    //获取列表
    async getList() {
      let res = await getListApi(this.parms);
      if (res && res.code == 200) {
        //给表格数据赋值
        this.tableList = res.data.records;
        //分页总条数
        this.parms.total = res.data.total;
      }
      console.log(res);
    },
  },
};
</script>

<style lang="scss" scoped></style>

```



#### 第20讲 设计试题之题目类型页面制作



###### 页面完整代码

```js
<template>
  <el-main>
    <!-- 模糊查询 -->
    <el-form
      :model="parms"
      ref="searchForm"
      label-width="80px"
      :inline="true"
      size="small"
    >
      <el-form-item label="问卷标题">
        <el-input v-model="parms.questionTitle"></el-input>
      </el-form-item>
      <el-form-item>
        <el-button icon="el-icon-search" @click="searchBtn">搜索</el-button>
        <el-button style="color: #ff7670" @click="resetBtn" icon="el-icon-close"
          >重置</el-button
        >
      </el-form-item>
    </el-form>
    <!-- 表格列表 -->
    <el-table :height="tableHeight" :data="tableList" border stripe>
      <el-table-column prop="questionImg" width="80" label="问卷图片" align="center">
        <template slot-scope="scope">
          <el-image
            style="width: 50px; height: 50px; border-radius: 50%"
            :src="scope.row.questionImg"
          ></el-image>
        </template>
      </el-table-column>
      <el-table-column prop="questionTitle" label="问卷标题"></el-table-column>
      <el-table-column prop="questionDesc" label="问卷描述"></el-table-column>
      <el-table-column prop="questionOrder" label="问卷序号"></el-table-column>
      <el-table-column prop="questionStatus" label="状态">
        <template slot-scope="scope">
          <el-tag v-if="scope.row.questionStatus == '0'" type="danger" size="normal"
            >关闭</el-tag
          >
          <el-tag v-if="scope.row.questionStatus == '1'" type="success" size="normal"
            >调查中</el-tag
          >
        </template>
      </el-table-column>
      <el-table-column align="center" width="180" label="操作">
        <template slot-scope="scope">
          <el-button
            type="success"
            icon="el-icon-setting"
            size="small"
            @click="addPaper(scope.row)"
            >设计试题</el-button
          >
        </template>
      </el-table-column>
    </el-table>
    <!-- 分页 
    @size-change 页容量改变时触发的事件
    @current-change 页数改变时触发的事件
    :current-page  当前第几页 
    :page-sizes 
    :page-size  没有查询几条
     :total 总条数
    -->
    <el-pagination
      @size-change="sizeChange"
      @current-change="currentChange"
      :current-page.sync="parms.currentPage"
      :page-sizes="[10, 20, 40, 80, 100]"
      :page-size="parms.pageSize"
      layout="total, sizes, prev, pager, next, jumper"
      :total="parms.total"
      background
    >
    </el-pagination>
    <!-- 新增弹框 -->
    <sys-dialog
      :title="addDialog.title"
      :width="addDialog.width"
      :height="addDialog.height"
      :visible="addDialog.visible"
      @onClose="onClose"
      @onConfirm="onConfirm"
    >
      <template slot="content">
        <el-container  style="height: 100%">
          <el-aside width="200px" style="border-right: 1px solid #e8eaec !important">
            <div class="left-btn">
              <el-button class="btnitem" size="small">单选题</el-button>
              <el-button class="btnitem" size="small">多选题</el-button>
              <el-button class="btnitem" size="small">单文本</el-button>
              <el-button class="btnitem" size="small">多文本</el-button>
            </div>
          </el-aside>
          <el-main style=""> 中间 </el-main>
        </el-container>
      </template>
    </sys-dialog>
  </el-main>
</template>

<script>
import { getListApi, addApi, editApi, deleteApi } from "@/api/question";
import SysDialog from "@/components/system/SysDialog.vue";
import { baseUrl, imageUrl } from "@/settings";
export default {
  //注册组件
  components: {
    SysDialog,
  },
  data() {
    return {
      //弹框属性
      addDialog: {
        title: "",
        width: 1080,
        height: 600,
        visible: false,
      },
      //表格的高度
      tableHeight: 0,
      //表格数据
      tableList: [],
      //列表参数
      parms: {
        currentPage: 1,
        pageSize: 10,
        questionTitle: "",
        total: 0, //分页用的总条数
      },
    };
  },
  created() {
    this.getList();
  },
  mounted() {
    this.$nextTick(() => {
      this.tableHeight = window.innerHeight - 200;
    });
  },
  methods: {
    //设计试题按钮
    addPaper(row) {
      console.log(row);
      this.addDialog.title = "为【" + row.questionTitle + "】设计试题";
      this.addDialog.visible = true;
    },
    onConfirm() {
      this.addDialog.visible = false;
    },
    onClose() {
      this.addDialog.visible = false;
    },
    //重置按钮
    resetBtn() {
      this.parms.questionTitle = "";
      this.getList();
    },
    //搜索按钮
    searchBtn() {
      this.getList();
    },
    //页数改变时触发
    currentChange(val) {
      this.parms.currentPage = val;
      this.getList();
    },
    //页容量改变时触发
    sizeChange(val) {
      this.parms.pageSize = val;
      this.parms.currentPage = 1;
      this.getList();
    },
    //获取列表
    async getList() {
      let res = await getListApi(this.parms);
      if (res && res.code == 200) {
        //给表格数据赋值
        this.tableList = res.data.records;
        //分页总条数
        this.parms.total = res.data.total;
      }
      console.log(res);
    },
  },
};
</script>

<style lang="scss" scoped>
.left-btn{
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  padding-right: 10px;
}
.btnitem{
  margin-left: 0px;
  width: 100%;
  margin-bottom: 10px;
}
</style>

```



#### 第21讲 试题设计之题目设计

###### 页面完整代码

```js
<template>
  <el-main>
    <!-- 模糊查询 -->
    <el-form
      :model="parms"
      ref="searchForm"
      label-width="80px"
      :inline="true"
      size="small"
    >
      <el-form-item label="问卷标题">
        <el-input v-model="parms.questionTitle"></el-input>
      </el-form-item>
      <el-form-item>
        <el-button icon="el-icon-search" @click="searchBtn">搜索</el-button>
        <el-button style="color: #ff7670" @click="resetBtn" icon="el-icon-close"
          >重置</el-button
        >
      </el-form-item>
    </el-form>
    <!-- 表格列表 -->
    <el-table :height="tableHeight" :data="tableList" border stripe>
      <el-table-column prop="questionImg" width="80" label="问卷图片" align="center">
        <template slot-scope="scope">
          <el-image
            style="width: 50px; height: 50px; border-radius: 50%"
            :src="scope.row.questionImg"
          ></el-image>
        </template>
      </el-table-column>
      <el-table-column prop="questionTitle" label="问卷标题"></el-table-column>
      <el-table-column prop="questionDesc" label="问卷描述"></el-table-column>
      <el-table-column prop="questionOrder" label="问卷序号"></el-table-column>
      <el-table-column prop="questionStatus" label="状态">
        <template slot-scope="scope">
          <el-tag v-if="scope.row.questionStatus == '0'" type="danger" size="normal"
            >关闭</el-tag
          >
          <el-tag v-if="scope.row.questionStatus == '1'" type="success" size="normal"
            >调查中</el-tag
          >
        </template>
      </el-table-column>
      <el-table-column align="center" width="180" label="操作">
        <template slot-scope="scope">
          <el-button
            type="success"
            icon="el-icon-setting"
            size="small"
            @click="addPaper(scope.row)"
            >设计试题</el-button
          >
        </template>
      </el-table-column>
    </el-table>
    <!-- 分页 
    @size-change 页容量改变时触发的事件
    @current-change 页数改变时触发的事件
    :current-page  当前第几页 
    :page-sizes 
    :page-size  没有查询几条
     :total 总条数
    -->
    <el-pagination
      @size-change="sizeChange"
      @current-change="currentChange"
      :current-page.sync="parms.currentPage"
      :page-sizes="[10, 20, 40, 80, 100]"
      :page-size="parms.pageSize"
      layout="total, sizes, prev, pager, next, jumper"
      :total="parms.total"
      background
    >
    </el-pagination>
    <!-- 新增弹框 -->
    <sys-dialog
      :title="addDialog.title"
      :width="addDialog.width"
      :height="addDialog.height"
      :visible="addDialog.visible"
      @onClose="onClose"
      @onConfirm="onConfirm"
    >
      <template slot="content">
        <el-container style="height: 100%">
          <!-- 左侧分类 -->
          <el-aside class="leftcontainer" width="200px">
            <div class="btns">
              <el-button class="btnitem" size="default">单选题</el-button>
              <el-button class="btnitem" size="default">多选题</el-button>
              <el-button class="btnitem" size="default">单文本</el-button>
              <el-button class="btnitem" size="default">多文本</el-button>
            </div>
          </el-aside>
          <!-- 右侧试题 -->
          <el-main style="padding-top:1px;">
            <el-form
              :model="customerFormDodel"
              ref="customerForm"
              label-width="50px"
              :inline="false"
              size="small"
            >
              <div>
                <!-- 单选、多选 -->
                <div class="papetitem">
                  <!-- <el-row>：代表一行 ，里面的子元素会横向排列
                     <el-col ：代表的是列 
                     :span 代表所占的分数，总分数是 24
                      -->
                  <el-row>
                    <el-col :span="17" :offset="0">
                      <el-form-item label="1、" label-width="30px" size="small">
                        <el-input size="small"></el-input>
                      </el-form-item>
                    </el-col>
                    <el-col :span="7" :offset="0">
                      <el-button
                        style="margin-left: 15px"
                        size="small"
                        icon="el-icon-plus"
                        >新增选项</el-button
                      >
                      <el-button
                        style="margin-left: 15px"
                        type="danger"
                        size="small"
                        icon="el-icon-delete"
                        >删除试题</el-button
                      >
                    </el-col>
                  </el-row>
                  <el-form-item label="" size="small">
                    <el-row>
                      <el-col :span="10" :offset="0">
                        <el-form-item label="选项1" size="small">
                          <el-input size="small"></el-input>
                        </el-form-item>
                      </el-col>
                      <el-col :span="10" :offset="0">
                        <el-form-item label="序号" size="small">
                          <el-input size="small"></el-input>
                        </el-form-item>
                      </el-col>
                      <el-col :span="2" :offset="0">
                        <el-button
                          style="color: #ff7670; margin-left: 15px"
                          size="small"
                          circle=""
                          icon="el-icon-close"
                        ></el-button>
                      </el-col>
                    </el-row>
                  </el-form-item>
                  <el-form-item label="" size="small">
                    <el-row>
                      <el-col :span="10" :offset="0">
                        <el-form-item label="选项2" size="small">
                          <el-input size="small"></el-input>
                        </el-form-item>
                      </el-col>
                      <el-col :span="10" :offset="0">
                        <el-form-item label="序号" size="small">
                          <el-input size="small"></el-input>
                        </el-form-item>
                      </el-col>
                      <el-col :span="2" :offset="0">
                        <el-button
                          style="color: #ff7670; margin-left: 15px"
                          size="small"
                          circle=""
                          icon="el-icon-close"
                        ></el-button>
                      </el-col>
                    </el-row>
                  </el-form-item>
                  <el-form-item label="" size="small">
                    <el-row>
                      <el-col :span="10" :offset="0">
                        <el-form-item label="选项3" size="small">
                          <el-input size="small"></el-input>
                        </el-form-item>
                      </el-col>
                      <el-col :span="10" :offset="0">
                        <el-form-item label="序号" size="small">
                          <el-input size="small"></el-input>
                        </el-form-item>
                      </el-col>
                      <el-col :span="2" :offset="0">
                        <el-button
                          style="color: #ff7670; margin-left: 15px"
                          size="small"
                          circle=""
                          icon="el-icon-close"
                        ></el-button>
                      </el-col>
                    </el-row>
                  </el-form-item>
                </div>
                <!-- 单文本 -->
                <div class="papetitem">
                  <el-row>
                    <el-col :span="17" :offset="0">
                      <el-form-item label="2、" label-width="30px" size="small">
                         <el-input size="small"></el-input>
                      </el-form-item>
                    </el-col>
                    <el-col class="delBtn" :span="7" :offset="0">
                      <el-button style="margin-left:15px;" type="danger" icon="el-icon-delete" size="small">删除试题</el-button>
                    </el-col>
                  </el-row>
                </div>
                 <!-- 多文本 -->
                <div class="papetitem">
                  <el-row>
                    <el-col :span="17" :offset="0">
                      <el-form-item label="3、" label-width="30px" size="small">
                         <el-input type="textarea" size="small"></el-input>
                      </el-form-item>
                    </el-col>
                    <el-col class="delBtn" :span="7" :offset="0">
                      <el-button style="margin-left:15px;" type="danger" icon="el-icon-delete" size="small">删除试题</el-button>
                    </el-col>
                  </el-row>
                </div>
              </div>
            </el-form>
          </el-main>
        </el-container>
      </template>
    </sys-dialog>
  </el-main>
</template>

<script>
import { getListApi} from "@/api/question";
import SysDialog from "@/components/system/SysDialog.vue";
export default {
  //注册组件
  components: {
    SysDialog,
  },
  data() {
    return {
      //试题绑定的数据域
      customerFormDodel: {
        addModel: [],
      },
      //弹框属性
      addDialog: {
        title: "",
        width: 1080,
        height: 600,
        visible: false,
      },
      //表格的高度
      tableHeight: 0,
      //表格数据
      tableList: [],
      //列表参数
      parms: {
        currentPage: 1,
        pageSize: 10,
        questionTitle: "",
        total: 0, //分页用的总条数
      },
    };
  },
  created() {
    this.getList();
  },
  mounted() {
    this.$nextTick(() => {
      this.tableHeight = window.innerHeight - 200;
    });
  },
  methods: {
    //弹框确认事件
    onConfirm() {
      this.addDialog.visible = false;
    },
    //弹框关闭事件
    onClose() {
      this.addDialog.visible = false;
    },
    //设计试题按钮
    addPaper(row) {
      console.log(row);
      //设置弹框属性
      this.addDialog.title = "为【" + row.questionTitle + "】设计试题";
      this.addDialog.visible = true;
    },
    //重置按钮
    resetBtn() {
      this.parms.questionTitle = "";
      this.getList();
    },
    //搜索按钮
    searchBtn() {
      this.getList();
    },
    //页数改变时触发
    currentChange(val) {
      this.parms.currentPage = val;
      this.getList();
    },
    //页容量改变时触发
    sizeChange(val) {
      this.parms.pageSize = val;
      this.parms.currentPage = 1;
      this.getList();
    },
    //获取列表
    async getList() {
      let res = await getListApi(this.parms);
      if (res && res.code == 200) {
        //给表格数据赋值
        this.tableList = res.data.records;
        //分页总条数
        this.parms.total = res.data.total;
      }
      console.log(res);
    },
  },
};
</script>

<style lang="scss" scoped>
.leftcontainer {
  border-right: 1px solid #e8eaec;
}
.btns {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  padding-right: 10px;
}
.btnitem {
  width: 100%;
  margin-left: 0px;
  margin-bottom: 10px;
}
.delBtn{
  display: flex;
  justify-content: flex-end;
  padding-right: 15px;
}
.papetitem{
  border-bottom: 1px solid #e8eaec;
  padding-top: 20px;
}
</style>

```



#### 第22讲 试题表单的动态新增、删除

###### 页面完整代码

```js
<template>
  <el-main>
    <!-- 模糊查询 -->
    <el-form
      :model="parms"
      ref="searchForm"
      label-width="80px"
      :inline="true"
      size="small"
    >
      <el-form-item label="问卷标题">
        <el-input v-model="parms.questionTitle"></el-input>
      </el-form-item>
      <el-form-item>
        <el-button icon="el-icon-search" @click="searchBtn">搜索</el-button>
        <el-button style="color: #ff7670" @click="resetBtn" icon="el-icon-close"
          >重置</el-button
        >
      </el-form-item>
    </el-form>
    <!-- 表格列表 -->
    <el-table :height="tableHeight" :data="tableList" border stripe>
      <el-table-column prop="questionImg" width="80" label="问卷图片" align="center">
        <template slot-scope="scope">
          <el-image
            style="width: 50px; height: 50px; border-radius: 50%"
            :src="scope.row.questionImg"
          ></el-image>
        </template>
      </el-table-column>
      <el-table-column prop="questionTitle" label="问卷标题"></el-table-column>
      <el-table-column prop="questionDesc" label="问卷描述"></el-table-column>
      <el-table-column prop="questionOrder" label="问卷序号"></el-table-column>
      <el-table-column prop="questionStatus" label="状态">
        <template slot-scope="scope">
          <el-tag v-if="scope.row.questionStatus == '0'" type="danger" size="normal"
            >关闭</el-tag
          >
          <el-tag v-if="scope.row.questionStatus == '1'" type="success" size="normal"
            >调查中</el-tag
          >
        </template>
      </el-table-column>
      <el-table-column align="center" width="180" label="操作">
        <template slot-scope="scope">
          <el-button
            type="success"
            icon="el-icon-setting"
            size="small"
            @click="addPaper(scope.row)"
            >设计试题</el-button
          >
        </template>
      </el-table-column>
    </el-table>
    <!-- 分页 
    @size-change 页容量改变时触发的事件
    @current-change 页数改变时触发的事件
    :current-page  当前第几页 
    :page-sizes 
    :page-size  没有查询几条
     :total 总条数
    -->
    <el-pagination
      @size-change="sizeChange"
      @current-change="currentChange"
      :current-page.sync="parms.currentPage"
      :page-sizes="[10, 20, 40, 80, 100]"
      :page-size="parms.pageSize"
      layout="total, sizes, prev, pager, next, jumper"
      :total="parms.total"
      background
    >
    </el-pagination>
    <!-- 新增弹框 -->
    <sys-dialog
      :title="addDialog.title"
      :width="addDialog.width"
      :height="addDialog.height"
      :visible="addDialog.visible"
      @onClose="onClose"
      @onConfirm="onConfirm"
    >
      <template slot="content">
        <el-container style="height: 100%">
          <!-- 左侧分类 -->
          <el-aside class="leftcontainer" width="200px">
            <div class="btns">
              <el-button @click="addPaperData('1')" class="btnitem" size="default">单选题</el-button>
              <el-button @click="addPaperData('2')" class="btnitem" size="default">多选题</el-button>
              <el-button @click="addPaperData('3')" class="btnitem" size="default">单文本</el-button>
              <el-button @click="addPaperData('4')" class="btnitem" size="default">多文本</el-button>
            </div>
          </el-aside>
          <!-- 右侧试题 -->
          <el-main style="padding-top:1px;">
            <el-form
              :model="customerFormDodel"
              ref="customerForm"
              label-width="50px"
              :inline="false"
              size="small"
            >
              <div :key='index' v-for="index in customerFormDodel.addModel.length">
                <!-- 单选、多选 -->
                <div v-if="customerFormDodel.addModel[index-1].paperType == '1' || customerFormDodel.addModel[index-1].paperType == '2'" class="papetitem">
                  <!-- <el-row>：代表一行 ，里面的子元素会横向排列
                     <el-col ：代表的是列 
                     :span 代表所占的分数，总分数是 24
                      -->
                  <el-row>
                    <el-col :span="17" :offset="0">
                      <el-form-item :label="index+'、'" label-width="30px" size="small">
                        <el-input size="small"></el-input>
                      </el-form-item>
                    </el-col>
                    <el-col :span="7" :offset="0">
                      <el-button
                        style="margin-left: 15px"
                        size="small"
                        icon="el-icon-plus"
                        >新增选项</el-button
                      >
                      <el-button
                        style="margin-left: 15px"
                        type="danger"
                        size="small"
                        icon="el-icon-delete"
                        @click="deletePaper(index)"
                        >删除试题</el-button
                      >
                    </el-col>
                  </el-row>
                  <el-form-item label="" size="small">
                    <el-row>
                      <el-col :span="10" :offset="0">
                        <el-form-item label="选项1" size="small">
                          <el-input size="small"></el-input>
                        </el-form-item>
                      </el-col>
                      <el-col :span="10" :offset="0">
                        <el-form-item label="序号" size="small">
                          <el-input size="small"></el-input>
                        </el-form-item>
                      </el-col>
                      <el-col :span="2" :offset="0">
                        <el-button
                          style="color: #ff7670; margin-left: 15px"
                          size="small"
                          circle=""
                          icon="el-icon-close"
                        ></el-button>
                      </el-col>
                    </el-row>
                  </el-form-item>
                  <el-form-item label="" size="small">
                    <el-row>
                      <el-col :span="10" :offset="0">
                        <el-form-item label="选项2" size="small">
                          <el-input size="small"></el-input>
                        </el-form-item>
                      </el-col>
                      <el-col :span="10" :offset="0">
                        <el-form-item label="序号" size="small">
                          <el-input size="small"></el-input>
                        </el-form-item>
                      </el-col>
                      <el-col :span="2" :offset="0">
                        <el-button
                          style="color: #ff7670; margin-left: 15px"
                          size="small"
                          circle=""
                          icon="el-icon-close"
                        ></el-button>
                      </el-col>
                    </el-row>
                  </el-form-item>
                  <el-form-item label="" size="small">
                    <el-row>
                      <el-col :span="10" :offset="0">
                        <el-form-item label="选项3" size="small">
                          <el-input size="small"></el-input>
                        </el-form-item>
                      </el-col>
                      <el-col :span="10" :offset="0">
                        <el-form-item label="序号" size="small">
                          <el-input size="small"></el-input>
                        </el-form-item>
                      </el-col>
                      <el-col :span="2" :offset="0">
                        <el-button
                          style="color: #ff7670; margin-left: 15px"
                          size="small"
                          circle=""
                          icon="el-icon-close"
                        ></el-button>
                      </el-col>
                    </el-row>
                  </el-form-item>
                </div>
                <!-- 单文本 -->
                <div v-if="customerFormDodel.addModel[index-1].paperType == '3'" class="papetitem">
                  <el-row>
                    <el-col :span="17" :offset="0">
                      <el-form-item :label="index+'、'" label-width="30px" size="small">
                         <el-input size="small"></el-input>
                      </el-form-item>
                    </el-col>
                    <el-col class="delBtn" :span="7" :offset="0">
                      <el-button @click="deletePaper(index)" style="margin-left:15px;" type="danger" icon="el-icon-delete" size="small">删除试题</el-button>
                    </el-col>
                  </el-row>
                </div>
                 <!-- 多文本 -->
                <div v-if="customerFormDodel.addModel[index-1].paperType == '4'" class="papetitem">
                  <el-row>
                    <el-col :span="17" :offset="0">
                      <el-form-item :label="index+'、'" label-width="30px" size="small">
                         <el-input type="textarea" size="small"></el-input>
                      </el-form-item>
                    </el-col>
                    <el-col class="delBtn" :span="7" :offset="0">
                      <el-button @click="deletePaper(index)" style="margin-left:15px;" type="danger" icon="el-icon-delete" size="small">删除试题</el-button>
                    </el-col>
                  </el-row>
                </div>
              </div>
            </el-form>
          </el-main>
        </el-container>
      </template>
    </sys-dialog>
  </el-main>
</template>

<script>
import { getListApi} from "@/api/question";
import SysDialog from "@/components/system/SysDialog.vue";
export default {
  //注册组件
  components: {
    SysDialog,
  },
  data() {
    return {
      //问卷id
      questionId:'',
      //试题绑定的数据域
      customerFormDodel: {
        addModel: [],
      },
      //弹框属性
      addDialog: {
        title: "",
        width: 1080,
        height: 600,
        visible: false,
      },
      //表格的高度
      tableHeight: 0,
      //表格数据
      tableList: [],
      //列表参数
      parms: {
        currentPage: 1,
        pageSize: 10,
        questionTitle: "",
        total: 0, //分页用的总条数
      },
    };
  },
  created() {
    this.getList();
  },
  mounted() {
    this.$nextTick(() => {
      this.tableHeight = window.innerHeight - 200;
    });
  },
  methods: {
    //删除试题
    deletePaper(index){
      this.customerFormDodel.addModel.splice(index-1,1);
    },
    //弹框确认事件
    onConfirm() {
      this.addDialog.visible = false;
    },
    //弹框关闭事件
    onClose() {
      this.addDialog.visible = false;
    },
    //设计试题按钮
    addPaper(row) {
      console.log(row);
      //清空数据
      this.customerFormDodel.addModel = [];
      //设置问卷id
      this.questionId = row.questionId;
      //初始表单数据，默认展示一个单选题
      this.addPaperData('1');
      //设置弹框属性
      this.addDialog.title = "为【" + row.questionTitle + "】设计试题";
      this.addDialog.visible = true;
    },
    addPaperData(type){
      //试题的数据格式，根据数据库字段所得
      let objModel = {
        paperId:'',
        questionId:'',
        paperTitle:'',
        paperType:'',
        paperOrder:'',
        //试题的选项
        paperChoice:[]
      }
      //如果是单选题或者多选题，需要设置选项
      if(type == '1' || type =='2'){
        let obj = {
          choiceText:'',
          choiceOrder:''
        }
        objModel.paperChoice.push(obj)
      }
      //设置问卷id
      objModel.questionId = this.questionId;
      //设置试题的类型
      objModel.paperType = type;
      //设置到表单绑定的数据域
      this.customerFormDodel.addModel.push(objModel);
    },
    //重置按钮
    resetBtn() {
      this.parms.questionTitle = "";
      this.getList();
    },
    //搜索按钮
    searchBtn() {
      this.getList();
    },
    //页数改变时触发
    currentChange(val) {
      this.parms.currentPage = val;
      this.getList();
    },
    //页容量改变时触发
    sizeChange(val) {
      this.parms.pageSize = val;
      this.parms.currentPage = 1;
      this.getList();
    },
    //获取列表
    async getList() {
      let res = await getListApi(this.parms);
      if (res && res.code == 200) {
        //给表格数据赋值
        this.tableList = res.data.records;
        //分页总条数
        this.parms.total = res.data.total;
      }
      console.log(res);
    },
  },
};
</script>

<style lang="scss" scoped>
.leftcontainer {
  border-right: 1px solid #e8eaec;
}
.btns {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  padding-right: 10px;
}
.btnitem {
  width: 100%;
  margin-left: 0px;
  margin-bottom: 10px;
}
.delBtn{
  display: flex;
  justify-content: flex-end;
  padding-right: 15px;
}
.papetitem{
  border-bottom: 1px solid #e8eaec;
  padding-top: 20px;
}
</style>

```



#### 第23讲  选择题新增选项和删除选项

###### 页面完整源码

```js
<template>
  <el-main>
    <!-- 模糊查询 -->
    <el-form
      :model="parms"
      ref="searchForm"
      label-width="80px"
      :inline="true"
      size="small"
    >
      <el-form-item label="问卷标题">
        <el-input v-model="parms.questionTitle"></el-input>
      </el-form-item>
      <el-form-item>
        <el-button icon="el-icon-search" @click="searchBtn">搜索</el-button>
        <el-button style="color: #ff7670" @click="resetBtn" icon="el-icon-close"
          >重置</el-button
        >
      </el-form-item>
    </el-form>
    <!-- 表格列表 -->
    <el-table :height="tableHeight" :data="tableList" border stripe>
      <el-table-column prop="questionImg" width="80" label="问卷图片" align="center">
        <template slot-scope="scope">
          <el-image
            style="width: 50px; height: 50px; border-radius: 50%"
            :src="scope.row.questionImg"
          ></el-image>
        </template>
      </el-table-column>
      <el-table-column prop="questionTitle" label="问卷标题"></el-table-column>
      <el-table-column prop="questionDesc" label="问卷描述"></el-table-column>
      <el-table-column prop="questionOrder" label="问卷序号"></el-table-column>
      <el-table-column prop="questionStatus" label="状态">
        <template slot-scope="scope">
          <el-tag v-if="scope.row.questionStatus == '0'" type="danger" size="normal"
            >关闭</el-tag
          >
          <el-tag v-if="scope.row.questionStatus == '1'" type="success" size="normal"
            >调查中</el-tag
          >
        </template>
      </el-table-column>
      <el-table-column align="center" width="180" label="操作">
        <template slot-scope="scope">
          <el-button
            type="success"
            icon="el-icon-setting"
            size="small"
            @click="addPaper(scope.row)"
            >设计试题</el-button
          >
        </template>
      </el-table-column>
    </el-table>
    <!-- 分页 
    @size-change 页容量改变时触发的事件
    @current-change 页数改变时触发的事件
    :current-page  当前第几页 
    :page-sizes 
    :page-size  没有查询几条
     :total 总条数
    -->
    <el-pagination
      @size-change="sizeChange"
      @current-change="currentChange"
      :current-page.sync="parms.currentPage"
      :page-sizes="[10, 20, 40, 80, 100]"
      :page-size="parms.pageSize"
      layout="total, sizes, prev, pager, next, jumper"
      :total="parms.total"
      background
    >
    </el-pagination>
    <!-- 新增弹框 -->
    <sys-dialog
      :title="addDialog.title"
      :width="addDialog.width"
      :height="addDialog.height"
      :visible="addDialog.visible"
      @onClose="onClose"
      @onConfirm="onConfirm"
    >
      <template slot="content">
        <el-container style="height: 100%">
          <!-- 左侧分类 -->
          <el-aside class="leftcontainer" width="200px">
            <div class="btns">
              <el-button @click="addPaperData('1')" class="btnitem" size="default"
                >单选题</el-button
              >
              <el-button @click="addPaperData('2')" class="btnitem" size="default"
                >多选题</el-button
              >
              <el-button @click="addPaperData('3')" class="btnitem" size="default"
                >单文本</el-button
              >
              <el-button @click="addPaperData('4')" class="btnitem" size="default"
                >多文本</el-button
              >
            </div>
          </el-aside>
          <!-- 右侧试题 -->
          <el-main style="padding-top: 1px">
            <el-form
              :model="customerFormDodel"
              ref="customerForm"
              label-width="50px"
              :inline="false"
              size="small"
            >
              <div :key="index" v-for="index in customerFormDodel.addModel.length">
                <!-- 单选、多选 -->
                <div
                  v-if="
                    customerFormDodel.addModel[index - 1].paperType == '1' ||
                    customerFormDodel.addModel[index - 1].paperType == '2'
                  "
                  class="papetitem"
                >
                  <!-- <el-row>：代表一行 ，里面的子元素会横向排列
                     <el-col ：代表的是列 
                     :span 代表所占的分数，总分数是 24
                      -->
                  <el-row>
                    <el-col :span="17" :offset="0">
                      <el-form-item :label="index + '、'" label-width="30px" size="small">
                        <el-input v-model="customerFormDodel.addModel[index - 1].paperTitle" size="small"></el-input>
                      </el-form-item>
                    </el-col>
                    <el-col :span="7" :offset="0">
                      <el-button
                        style="margin-left: 15px"
                        size="small"
                        icon="el-icon-plus"
                        @click="addChoice(index)"
                        >新增选项</el-button
                      >
                      <el-button
                        style="margin-left: 15px"
                        type="danger"
                        size="small"
                        icon="el-icon-delete"
                        @click="deletePaper(index)"
                        >删除试题</el-button
                      >
                    </el-col>
                  </el-row>
                  <el-form-item
                    :key="num"
                    v-for="num in customerFormDodel.addModel[index - 1].paperChoice
                      .length"
                    label=""
                    size="small"
                  >
                    <el-row>
                      <el-col :span="10" :offset="0">
                        <el-form-item :label="'选项' + num" size="small">
                          <el-input
                            v-model="
                              customerFormDodel.addModel[index - 1].paperChoice[num - 1]
                                .choiceText
                            "
                            size="small"
                          ></el-input>
                        </el-form-item>
                      </el-col>
                      <el-col :span="10" :offset="0">
                        <el-form-item label="序号" size="small">
                          <el-input
                            v-model="
                              customerFormDodel.addModel[index - 1].paperChoice[num - 1]
                                .choiceOrder
                            "
                            size="small"
                          ></el-input>
                        </el-form-item>
                      </el-col>
                      <el-col :span="2" :offset="0">
                        <el-button
                          style="color: #ff7670; margin-left: 15px"
                          size="small"
                          circle
                          icon="el-icon-close"
                          @click="deleteChoice(index, num)"
                        ></el-button>
                      </el-col>
                    </el-row>
                  </el-form-item>
                </div>
                <!-- 单文本 -->
                <div
                  v-if="customerFormDodel.addModel[index - 1].paperType == '3'"
                  class="papetitem"
                >
                  <el-row>
                    <el-col :span="17" :offset="0">
                      <el-form-item :label="index + '、'" label-width="30px" size="small">
                        <el-input v-model="customerFormDodel.addModel[index - 1].paperTitle"  size="small"></el-input>
                      </el-form-item>
                    </el-col>
                    <el-col class="delBtn" :span="7" :offset="0">
                      <el-button
                        @click="deletePaper(index)"
                        style="margin-left: 15px"
                        type="danger"
                        icon="el-icon-delete"
                        size="small"
                        >删除试题</el-button
                      >
                    </el-col>
                  </el-row>
                </div>
                <!-- 多文本 -->
                <div
                  v-if="customerFormDodel.addModel[index - 1].paperType == '4'"
                  class="papetitem"
                >
                  <el-row>
                    <el-col :span="17" :offset="0">
                      <el-form-item :label="index + '、'" label-width="30px" size="small">
                        <el-input v-model="customerFormDodel.addModel[index - 1].paperTitle"  type="textarea" size="small"></el-input>
                      </el-form-item>
                    </el-col>
                    <el-col class="delBtn" :span="7" :offset="0">
                      <el-button
                        @click="deletePaper(index)"
                        style="margin-left: 15px"
                        type="danger"
                        icon="el-icon-delete"
                        size="small"
                        >删除试题</el-button
                      >
                    </el-col>
                  </el-row>
                </div>
              </div>
            </el-form>
          </el-main>
        </el-container>
      </template>
    </sys-dialog>
  </el-main>
</template>

<script>
import { getListApi } from "@/api/question";
import SysDialog from "@/components/system/SysDialog.vue";
export default {
  //注册组件
  components: {
    SysDialog,
  },
  data() {
    return {
      //问卷id
      questionId: "",
      //试题绑定的数据域
      customerFormDodel: {
        addModel: [],
      },
      //弹框属性
      addDialog: {
        title: "",
        width: 1080,
        height: 600,
        visible: false,
      },
      //表格的高度
      tableHeight: 0,
      //表格数据
      tableList: [],
      //列表参数
      parms: {
        currentPage: 1,
        pageSize: 10,
        questionTitle: "",
        total: 0, //分页用的总条数
      },
    };
  },
  created() {
    this.getList();
  },
  mounted() {
    this.$nextTick(() => {
      this.tableHeight = window.innerHeight - 200;
    });
  },
  methods: {
    // 删除选项
    deleteChoice(index, num) {
      this.customerFormDodel.addModel[index - 1].paperChoice.splice(num - 1, 1);
    },
    //新增选择题的选项
    addChoice(index) {
      console.log(index);
      this.customerFormDodel.addModel[index - 1].paperChoice.push({
        choiceText: "",
        choiceOrder: "",
      });
    },
    //删除试题
    deletePaper(index) {
      this.customerFormDodel.addModel.splice(index - 1, 1);
    },
    //弹框确认事件
    onConfirm() {
      if (this.customerFormDodel.addModel.length < 1) {
        this.$message.warning("请设计试题!");
        return;
      }
      console.log(this.customerFormDodel.addModel)
      this.addDialog.visible = false;
    },
    //弹框关闭事件
    onClose() {
      this.addDialog.visible = false;
    },
    //设计试题按钮
    addPaper(row) {
      console.log(row);
      //清空数据
      this.customerFormDodel.addModel = [];
      //设置问卷id
      this.questionId = row.questionId;
      //初始表单数据，默认展示一个单选题
      this.addPaperData("1");
      //设置弹框属性
      this.addDialog.title = "为【" + row.questionTitle + "】设计试题";
      this.addDialog.visible = true;
    },
    addPaperData(type) {
      //试题的数据格式，根据数据库字段所得
      let objModel = {
        paperId: "",
        questionId: "",
        paperTitle: "",
        paperType: "",
        paperOrder: "",
        //试题的选项
        paperChoice: [],
      };
      //如果是单选题或者多选题，需要设置选项
      if (type == "1" || type == "2") {
        let obj = {
          choiceText: "",
          choiceOrder: "",
        };
        objModel.paperChoice.push(obj);
      }
      //设置问卷id
      objModel.questionId = this.questionId;
      //设置试题的类型
      objModel.paperType = type;
      //设置到表单绑定的数据域
      this.customerFormDodel.addModel.push(objModel);
    },
    //重置按钮
    resetBtn() {
      this.parms.questionTitle = "";
      this.getList();
    },
    //搜索按钮
    searchBtn() {
      this.getList();
    },
    //页数改变时触发
    currentChange(val) {
      this.parms.currentPage = val;
      this.getList();
    },
    //页容量改变时触发
    sizeChange(val) {
      this.parms.pageSize = val;
      this.parms.currentPage = 1;
      this.getList();
    },
    //获取列表
    async getList() {
      let res = await getListApi(this.parms);
      if (res && res.code == 200) {
        //给表格数据赋值
        this.tableList = res.data.records;
        //分页总条数
        this.parms.total = res.data.total;
      }
      console.log(res);
    },
  },
};
</script>

<style lang="scss" scoped>
.leftcontainer {
  border-right: 1px solid #e8eaec;
}
.btns {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  padding-right: 10px;
}
.btnitem {
  width: 100%;
  margin-left: 0px;
  margin-bottom: 10px;
}
.delBtn {
  display: flex;
  justify-content: flex-end;
  padding-right: 15px;
}
.papetitem {
  border-bottom: 1px solid #e8eaec;
  padding-top: 20px;
}
</style>

```



#### 第24讲 试题保存接口开发与对接

###### 1、新建试题选项实体类

```js
package com.itmk.web.sys_paper_choice.entity;

import com.baomidou.mybatisplus.annotation.IdType;
import com.baomidou.mybatisplus.annotation.TableId;
import com.baomidou.mybatisplus.annotation.TableName;
import lombok.Data;

import java.io.Serializable;
@Data
@TableName("sys_paper_choice")
public class SysPaperChoice implements Serializable {
    //选项id
    @TableId(type = IdType.AUTO)
    private Long chioceId;
    //试题id
    private Long paperId;
    //选项的名称
    private String choiceText;
    //序号
    private Long choiceOrder;
}
```

###### 2、新建试题选项mapper层

```js
package com.itmk.web.sys_paper_choice.mapper;

import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import com.itmk.web.sys_paper_choice.entity.SysPaperChoice;

public interface SysPaperChoiceMapper extends BaseMapper<SysPaperChoice> {
}

```

###### 3、新建试题选项映射文件

```js
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.itmk.web.sys_paper_choice.mapper.SysPaperChoiceMapper">

</mapper>
```

###### 4、新建试题选项service层

```js
package com.itmk.web.sys_paper_choice.service;

import com.baomidou.mybatisplus.extension.service.IService;
import com.itmk.web.sys_paper_choice.entity.SysPaperChoice;

public interface SysPaperChoiceService extends IService<SysPaperChoice> {
}

```

**实现类**

```js
package com.itmk.web.sys_paper_choice.service.impl;

import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;
import com.itmk.web.sys_paper_choice.entity.SysPaperChoice;
import com.itmk.web.sys_paper_choice.mapper.SysPaperChoiceMapper;
import com.itmk.web.sys_paper_choice.service.SysPaperChoiceService;
import org.springframework.stereotype.Service;

@Service
public class SysPaperChoiceServiceImpl extends ServiceImpl<SysPaperChoiceMapper, SysPaperChoice> implements SysPaperChoiceService {
}

```



###### 5、新建试题实体类

```js
package com.itmk.web.sys_paper.entity;

import com.baomidou.mybatisplus.annotation.IdType;
import com.baomidou.mybatisplus.annotation.TableField;
import com.baomidou.mybatisplus.annotation.TableId;
import com.baomidou.mybatisplus.annotation.TableName;
import com.itmk.web.sys_paper_choice.entity.SysPaperChoice;
import lombok.Data;

import java.io.Serializable;
import java.util.List;

@Data
@TableName("sys_paper")
public class SysPaper implements Serializable {
    //试题id
    @TableId(type = IdType.AUTO)
    private Long paperId;
    //问卷id
    private Long questionId;
    //标题
    private String paperTitle;
    //试题类型
    private String paperType;
    private Long paperOrder;

    //单选、多选题对应的选项,不属于 试题表，需要排除
    @TableField(exist =  false)
    private List<SysPaperChoice> paperChoice;
}

```

###### 6、新建试题mapper层

```js
package com.itmk.web.sys_paper.mapper;

import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import com.itmk.web.sys_paper.entity.SysPaper;

public interface SysPaperMapper extends BaseMapper<SysPaper> {
}

```

###### 7、新建试题映射文件

```js
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.itmk.web.sys_paper.mapper.SysPaperMapper">

</mapper>
```

###### 8、新建试题service

```js
package com.itmk.web.sys_paper.service;

import com.baomidou.mybatisplus.extension.service.IService;
import com.itmk.web.sys_paper.entity.SysPaper;

import java.util.List;

public interface SysPaperService extends IService<SysPaper> {
    void savePaper(List<SysPaper> paperList);
}

```

**实现类**

```js
package com.itmk.web.sys_paper.service.impl;

import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;
import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;
import com.itmk.web.sys_paper.entity.SysPaper;
import com.itmk.web.sys_paper.mapper.SysPaperMapper;
import com.itmk.web.sys_paper.service.SysPaperService;
import com.itmk.web.sys_paper_choice.entity.SysPaperChoice;
import com.itmk.web.sys_paper_choice.mapper.SysPaperChoiceMapper;
import com.itmk.web.sys_paper_choice.service.SysPaperChoiceService;
import org.springframework.beans.BeanUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import javax.annotation.Resource;
import java.util.List;


@Service
public class SysPaperServiceImpl extends ServiceImpl<SysPaperMapper, SysPaper> implements SysPaperService {
//    @Resource
//    private SysPaperMapper sysPaperMapper;

    @Autowired
    private SysPaperChoiceService sysPaperChoiceService;
    @Override
    @Transactional
    public void savePaper(List<SysPaper> paperList) {
        //先删除，再保存
        for (int i=0;i<paperList.size();i++){
            //判断是否是单选、多选；需要删除对应的选项数据
            if(paperList.get(i).getPaperType().equals("1") || paperList.get(i).getPaperType().equals("2")){
                //删除选项，构造删除的条件
                QueryWrapper<SysPaperChoice> queryWrapper = new QueryWrapper<>();
                queryWrapper.lambda().eq(SysPaperChoice::getPaperId,paperList.get(i).getPaperId());
                //删除选项
                sysPaperChoiceService.remove(queryWrapper);
            }
            //删除试题
            this.baseMapper.deleteById(paperList.get(i).getPaperId());
//            sysPaperMapper.deleteById(paperList.get(i).getPaperId());
        }
        //保存
        for (int k =0;k<paperList.size();k++){
            //先保存试题
            SysPaper sysPaper = new SysPaper();
            BeanUtils.copyProperties(paperList.get(k),sysPaper);
            //试题序号
            sysPaper.setPaperOrder(k+1L);
            //保存试题
            this.baseMapper.insert(sysPaper);
            //判断是否是单选、多选;需要保存选项
            if(paperList.get(k).getPaperType().equals("1") || paperList.get(k).getPaperType().equals("2")){
                //批量保存，保存之前，需要设置试题的id
                paperList.get(k).getPaperChoice().forEach(item ->{
                    //设置试题的id
                    item.setPaperId(sysPaper.getPaperId());
                });
                //保存选项
                sysPaperChoiceService.saveBatch(paperList.get(k).getPaperChoice());
            }
        }
    }
}

```

###### 9、新建试题控制器

```js
package com.itmk.web.sys_paper.controller;

import com.itmk.utils.ResultUtils;
import com.itmk.utils.ResultVo;
import com.itmk.web.sys_paper.entity.SysPaper;
import com.itmk.web.sys_paper.service.SysPaperService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.List;

/**
 * 试题模块控制器
 */
@RestController
@RequestMapping("/api/syspaper")
public class SysPaperController {
    @Autowired
    private SysPaperService sysPaperService;

    //保存试题
    @PostMapping("/savePaper")
    public ResultVo savePaper(@RequestBody List<SysPaper> paperList){
        sysPaperService.savePaper(paperList);
        return ResultUtils.success("设计试题成功!");
    }
}

```

###### 10、在前端src/api下新建paper.js，并新增保存的方法

```js
import http from '@/utils/http'
//保存试题
export async function savePaperApi(parm){
    return await http.post("/api/syspaper/savePaper",parm)
}
```

###### 11、paperList.vue页面确认按钮

```js
//弹框确认事件
    async onConfirm() {
      if (this.customerFormDodel.addModel.length < 1) {
        this.$message.warning("请设计试题!");
        return;
      }
      let res = await savePaperApi(this.customerFormDodel.addModel);
      if(res && res.code == 200){
        this.addDialog.visible = false;
        this.$message.success(res.msg);
      }
      console.log(this.customerFormDodel.addModel)
    },
```



#### 第25讲 试题编辑、回显

###### 1、在后端SysPaperService接口添加如下方法

```js
//试题回显
    List<SysPaper> getList(String questionId);
```

###### 2、在实现类SysPaperServiceImpl中实现如上方法

<span style="color:#FF7670;">注意修改一下新增的方法中，删除试题需要根据问卷id删除试题，如下所示</span>

```js
package com.itmk.web.sys_paper.service.impl;

import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;
import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;
import com.itmk.web.sys_paper.entity.SysPaper;
import com.itmk.web.sys_paper.mapper.SysPaperMapper;
import com.itmk.web.sys_paper.service.SysPaperService;
import com.itmk.web.sys_paper_choice.entity.SysPaperChoice;
import com.itmk.web.sys_paper_choice.mapper.SysPaperChoiceMapper;
import com.itmk.web.sys_paper_choice.service.SysPaperChoiceService;
import org.springframework.beans.BeanUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import javax.annotation.Resource;
import java.util.List;


@Service
public class SysPaperServiceImpl extends ServiceImpl<SysPaperMapper, SysPaper> implements SysPaperService {
//    @Resource
//    private SysPaperMapper sysPaperMapper;

    @Autowired
    private SysPaperChoiceService sysPaperChoiceService;
    @Override
    @Transactional
    public void savePaper(List<SysPaper> paperList) {
        //先删除，再保存
        for (int i=0;i<paperList.size();i++){
            //判断是否是单选、多选；需要删除对应的选项数据
            if(paperList.get(i).getPaperType().equals("1") || paperList.get(i).getPaperType().equals("2")){
                //删除选项，构造删除的条件
                QueryWrapper<SysPaperChoice> queryWrapper = new QueryWrapper<>();
                queryWrapper.lambda().eq(SysPaperChoice::getPaperId,paperList.get(i).getPaperId());
                //删除选项
                sysPaperChoiceService.remove(queryWrapper);
            }
            //删除试题
//            this.baseMapper.deleteById(paperList.get(i).getPaperId());
            QueryWrapper<SysPaper> query = new QueryWrapper<>();
            query.lambda().eq(SysPaper::getQuestionId,paperList.get(i).getQuestionId());
            this.baseMapper.delete(query);
//            sysPaperMapper.deleteById(paperList.get(i).getPaperId());
        }
        //保存
        for (int k =0;k<paperList.size();k++){
            //先保存试题
            SysPaper sysPaper = new SysPaper();
            BeanUtils.copyProperties(paperList.get(k),sysPaper);
            //试题序号
            sysPaper.setPaperOrder(k+1L);
            //保存试题
            this.baseMapper.insert(sysPaper);
            //判断是否是单选、多选;需要保存选项
            if(paperList.get(k).getPaperType().equals("1") || paperList.get(k).getPaperType().equals("2")){
                //批量保存，保存之前，需要设置试题的id
                paperList.get(k).getPaperChoice().forEach(item ->{
                    //设置试题的id
                    item.setPaperId(sysPaper.getPaperId());
                });
                //保存选项
                sysPaperChoiceService.saveBatch(paperList.get(k).getPaperChoice());
            }
        }
    }

    @Override
    public List<SysPaper> getList(String questionId) {
        //构造查询条件
        QueryWrapper<SysPaper> query = new QueryWrapper<>();
        query.lambda().eq(SysPaper::getQuestionId,questionId);
        //试题列表
        List<SysPaper> paperList = this.baseMapper.selectList(query);
        //如果是单选、多选，需要查询对于的选项
       if(paperList.size()>0){
           for (int i =0;i<paperList.size();i++){
                if(paperList.get(i).getPaperType().equals("1") || paperList.get(i).getPaperType().equals("2")){
                    //构造查询选项的条件
                    QueryWrapper<SysPaperChoice> queryWrapper = new QueryWrapper<>();
                    queryWrapper.lambda().eq(SysPaperChoice::getPaperId,paperList.get(i).getPaperId());
                    //查询选项
                    List<SysPaperChoice> list = sysPaperChoiceService.list(queryWrapper);
                    //把查询到的选项设置到试题
                    paperList.get(i).setPaperChoice(list);
                }
           }
       }
        return paperList;
    }
}

```



#### 第26讲 小程序开发准备与项目创建



###### 1、小程序开发文档

```js
https://developers.weixin.qq.com/miniprogram/dev/framework/
```



###### 2、申请账号

开发小程序的第一步，你需要拥有一个小程序帐号，通过这个帐号你就可以管理你的小程序。

小程序账号申请页面，如下所示

```js
https://mp.weixin.qq.com/wxopen/waregister?action=step1
```



###### 3、小程序登录页面

```js
https://mp.weixin.qq.com/
```



###### 4、小程序开发工具下载地址

```js
https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html
```



###### 5、创建项目

​	需要填写appId



#### 第27讲   小程序底部tabbar和页面创建

###### 1、iconfont官网

https://www.iconfont.cn/

###### 2、搜索找到你想要的图标

###### 3、点击下载，设置图标颜色  #6ECEB0

###### 4、把下载的图标放到小程序项目的images目录下

###### 5、新建页面   

```js
在app.json配置文件的pages中写入页面路径和名称保存即可；
```



###### 6、配置app.json

```js
{
  "pages": [
    "pages/home/home",
    "pages/answer/index",
    "pages/mypage/mypage",
    "pages/detail/index",
    "pages/myanswer/index"
  ],
  "window": {
    "backgroundTextStyle": "light",
    "navigationBarBackgroundColor": "#6ECEB0",
    "navigationBarTitleText": "微问卷",
    "navigationBarTextStyle": "white"
  },
  "tabBar": {
    "color":"#000000",
    "selectedColor":"#6ECEB0",
    "list": [{
      "pagePath": "pages/home/home",
      "text": "首页",
      "iconPath":"/images/home.png",
      "selectedIconPath":"/images/home_select.png"
    }, {
      "pagePath": "pages/mypage/mypage",
      "text": "我的",
      "iconPath":"/images/my.png",
      "selectedIconPath":"/images/my_select.png"
    }]
  },
  "style": "v2",
  "sitemapLocation": "sitemap.json"
}
```



#### 第28讲 微信小程序登录对接

小程序登录流程时序图

```js
https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/login.html
```



###### 1、小程序登录后端接口开发

<1、>在question-wxapi模块的question-wxapi的pom.xml里面引入<!--http requset-->的依赖用于发送请求

```js
		<!--http requset-->
        <dependency>
            <groupId>com.github.kevinsawicki</groupId>
            <artifactId>http-request</artifactId>
            <version>6.0</version>
        </dependency>
```

<2、>在question-wxapi模块下的java新建com.itmk.login.controller包，然后新建WechatController控制器

```js
package com.itmk.login.controller;

import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.JSONObject;
import com.github.kevinsawicki.http.HttpRequest;
import com.itmk.utils.result.ResultUtils;
import com.itmk.utils.result.ResultVo;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

import java.util.HashMap;
import java.util.Map;

@RestController
@RequestMapping("/wxapi/weChat")
public class WechatController {
    @RequestMapping("/wxLogin")
    public ResultVo wxLogin(@RequestParam("code") String code){
        Map<String,String> map = new HashMap<>();
        map.put("appid","wx05eda073665c9384");
        map.put("secret","60f535a5ae021053542ba971fdcc7e93");
        map.put("js_code", code);
        map.put("grant_type", "authorization_code");
        String response = HttpRequest.get("https://api.weixin.qq.com/sns/jscode2session").form(map).body();
        System.out.println("Response was: " + response);
        JSONObject obj= JSON.parseObject(response);//将json字符串转换为json对
        System.out.println(obj);
        return ResultUtils.success("成功",obj);
    }
}

```

###### 2、小程序端对接

```js
// app.js
App({
  onLaunch() {
    let that = this;
    // 展示本地存储能力
    const logs = wx.getStorageSync('logs') || []
    logs.unshift(Date.now())
    wx.setStorageSync('logs', logs);

    // 登录
    wx.login({
      success: res => {
        // 发送 res.code 到后台换取 openId, sessionKey, unionId
        if (res.code) {
          wx.request({
            url: that.globalData.url+'/wxapi/weChat/wxLogin',
            data: {
              code: res.code
            },
            header: {
              'content-type': 'application/x-www-form-urlencoded'
            },
            success(res) {
              console.log(res.data);
              if (res.data.data.openid) {
                that.globalData.openid = res.data.data.openid;
              }
            }
          })
        } else {
          console.log('获取用户登录态失败！' + res.errMsg)
        }
      }
    })
  },
  globalData: {
    userInfo: null,
    token: '',
    url:'http://192.168.1.102:8078',
    openid:''
  }
})
```



#### 第29讲 小程序首页列表接口开发

###### 1、新建实体类

新建包 com.itmk.wxapi.question.entity  然后新建SysQuestion 实体类

```js
package com.itmk.wxapi.question.entity;

import com.baomidou.mybatisplus.annotation.IdType;
import com.baomidou.mybatisplus.annotation.TableField;
import com.baomidou.mybatisplus.annotation.TableId;
import com.baomidou.mybatisplus.annotation.TableName;
import lombok.Data;

import java.io.Serializable;

@Data  //自动生成get和set方法
@TableName("sys_question") //指明该实体对应的数据库表名是 sys_question
public class SysQuestion implements Serializable {
    //主键 自动递增
    @TableId(type = IdType.AUTO)
    private Long questionId;
    //问卷标题
    private String questionTitle;
    //问卷描述
    private String questionDesc;
    //图片路径
    private String questionImg;
    //问卷状态 0：关闭 1：调查中
    private String questionStatus;
    //序号
    private Long questionOrder;
    //参与人数,不属于问卷表，需要排除
    @TableField(exist = false)
    private Long joinCount;
}

```

###### 2、新建mapper

新建包 com.itmk.wxapi.question.mapper 然后新建SysQuestionMapper

```js
package com.itmk.wxapi.question.mapper;

import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import com.baomidou.mybatisplus.core.metadata.IPage;
import com.itmk.wxapi.question.entity.SysQuestion;

public interface SysQuestionMapper extends BaseMapper<SysQuestion> {
    //获取首页列表
    IPage<SysQuestion> getList(IPage<SysQuestion> page);
}

```

###### 3、新建映射文件

```js
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.itmk.wxapi.question.mapper.SysQuestionMapper">
    <select id="getList" resultType="com.itmk.wxapi.question.entity.SysQuestion">
        select sq.*,(select count(openid) from answer_question as aq where aq.question_id = sq.question_id) as join_count
        from sys_question as sq
    </select>
</mapper>
```

###### 4、新建service

新建包 com.itmk.wxapi.question.service 然后新建SysQuestionService接口

```js
package com.itmk.wxapi.question.service;

import com.baomidou.mybatisplus.core.metadata.IPage;
import com.baomidou.mybatisplus.extension.service.IService;
import com.itmk.wxapi.question.entity.SysQuestion;

public interface SysQuestionService extends IService<SysQuestion> {
    //获取首页列表
    IPage<SysQuestion> getList(IPage<SysQuestion> page);
}

```

实现类

```js
package com.itmk.wxapi.question.service.impl;

import com.baomidou.mybatisplus.core.metadata.IPage;
import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;
import com.itmk.wxapi.question.entity.SysQuestion;
import com.itmk.wxapi.question.mapper.SysQuestionMapper;
import com.itmk.wxapi.question.service.SysQuestionService;
import org.springframework.stereotype.Service;

@Service
public class SysQuestionServiceImpl extends ServiceImpl<SysQuestionMapper, SysQuestion> implements SysQuestionService {
    @Override
    public IPage<SysQuestion> getList(IPage<SysQuestion> page) {
        return this.baseMapper.getList(page);
    }
}

```

###### 5、新建控制器

新建包  com.itmk.wxapi.home 然后新建 HomeController控制器

```js
package com.itmk.wxapi.home;

import com.baomidou.mybatisplus.core.metadata.IPage;
import com.baomidou.mybatisplus.extension.plugins.pagination.Page;
import com.itmk.utils.ResultUtils;
import com.itmk.utils.ResultVo;
import com.itmk.wxapi.question.entity.SysQuestion;
import com.itmk.wxapi.question.entity.SysQuestionParn;
import com.itmk.wxapi.question.service.SysQuestionService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

/**
 * 小程序首控制器
 */
@RestController
@RequestMapping("/wxapi/home")
public class HomeController {
    @Autowired
    private SysQuestionService sysQuestionService;
    /**
     * 查询首页列表
     */
    @GetMapping("/getList")
    public ResultVo getList(SysQuestionParn sysQuestionParn){
        //构造分页对象
        IPage<SysQuestion> page = new Page<>();
        page.setCurrent(sysQuestionParn.getCurrentPage());
        page.setSize(sysQuestionParn.getPageSize());
        IPage<SysQuestion> list = sysQuestionService.getList(page);
        return ResultUtils.success("查询成功",list);
    }
}

```





#### 第30讲 小程序首页列表数据对接

###### 1、http工具的封装

```js

const app = getApp()
 
const requestData = (path, method, data) => {
  return new Promise(function(resolve, reject) {
    var token = app.globalData.token
    if (token == null) {
      token = wx.getStorageSync('token') ? wx.getStorageSync('token') : ''
    }
    wx.request({
      url: app.globalData.url + path,
      data: data,
      method: method,
      header: {
        'content-type': 'application/json',
        'token': token
      },
      success: function(res) {
        if (res.statusCode == 200) {
          resolve(res.data)
        } else {
          reject(e)
        }
      },
      fail: function(e) {
        //e = { errMsg: "request:fail invalid url" }
        e.errMsg = "网络请求失败"
        reject(e)
      }
    })
  })
}
function getData(path, data) {
  return requestData(path, 'GET', data)
}
 
function postData(path, data) {
  return requestData(path, 'POST', data)
}
 
 
module.exports = {
  GET: getData,
  POST: postData
}
```

###### 2、在根目录新建api目录，然后建home.js

```js
const http = require('../utils/http.js')
//获取问卷列表
export async function getQuestionListApi(parm) {
  return await http.GET("/wxapi/home/getQuestList", parm);
}
```

###### 3、首页页面home.js里面引入

```js
import {
  getQuestionListApi
} from '../../api/home'
```

###### 4、获取列表的方法

```js
data: {
    total: 0,
    //获取列表参数
    parms: {
      currentPage: 1,
      pageSize: 10,
    },
    //列表数据
    tableList: []
  },
```



```js

  //获取问卷列表
  async getQuestionList() {
    let that = this;
    console.log(this.data.total)
    let res = await getQuestionListApi(this.data.parms);
    console.log(res)
    if (res && res.code == 200) {
      //注意，赋值不能使用this.data.的方式赋值，这样没有双向数据绑定的效果，虽然有数据，但是页面不会改变
      that.setData({
        tableList: that.data.tableList.concat(res.data.records),
        total: res.data.total
      })
      // that.data.parms.total = res.data.total;
      console.log(res.data.total)
    }
  },
```

5、

#### 第31讲 首页列表页面布局讲解

###### 1、页面代码

```js
<view class="homecontainer">
  <view wx:for="{{tableList}}" wx:key='index' class="item">
    <!-- <image class="images" src="../../images/diaocha.png"></image> -->
    <image class="images" src="{{item.questionImg}}"></image>
    <view class="item-right" data-item="{{item}}" bindtap="gotoDetail">
      <view class="item-title">{{item.questionTitle}}</view>
      <view class="item-desc">{{item.questionDesc}}</view>
      <view class="item-desc">参与人数:{{item.joinCount}}人</view>
    </view>
  </view>
</view>
```



###### 2、页面样式

```js
.homecontainer {
  height: 100%;
  display: flex;
  flex-direction: column;
  box-sizing: border-box;
}

.item {
  padding: 50rpx 20rpx;
  height: 200rpx;
  display: flex;
  align-items: center;
  border-bottom: 1px solid #e8eaec;
}

.images {
  width: 140rpx;
  height: 140rpx;
  border: 1px solid #e8eaec;
  border-radius: 50%;
}

.item-right {
  padding-left: 15rpx;
  display: flex;
  flex: 1;
  flex-direction: column;
  background-color: #FFF;
}

.item-title {
  font-size: 36rpx;
  color: #333333;
}

.item-desc {
  padding-top: 15rpx;
  font-size: 28rpx;
  color: #666666;
  display:-webkit-box;
  -webkit-line-clamp:1;
  overflow:hidden;
  text-overflow:ellipsis;
  -webkit-box-orient:vertical;
  word-break:break-all;
}
```



#### 第32讲 首页数据刷新讲解

###### 1、页面代码

```js
<!--首页页面
<view> :视图容器 ,可以把他当做一个通常前端中div
homecontainer: 样式的名字，在home.wxss里面定义
-->
<view class='homecontainer'>
  <!--
  item:表示问卷的每一项；每一项是按从左到右排列 左侧是头像，右侧是 问卷信息
-->
  <view class="item" wx:for="{{tableList}}" wx:key='index'>
    <!-- 左侧图片 -->
    <!-- <image class="images" src="../../images/avuser.jpg"></image> -->
    <image class="images" src="{{item.questionImg}}"></image>
    <!--右侧 问卷信息 -->
    <view class="item-right" bindtap="gotoDetail">
      <view class="item-title">{{item.questionTitle}}</view>
      <view class="item-desc">{{item.questionDesc}}</view>
      <view class="item-join">参与人数:{{item.joinCount}}</view>
    </view>
  </view>
</view>
```

###### 2、home.js

```js
// pages/home/home.js
//引入api 
import {
  getHomeListApi
} from '../../api/home.js'
Page({

  /**
   * 页面的初始数据
   */
  data: {
    total: 0, //分页总条数
    parms: {
      currentPage: 1, //从第几页开始
      pageSize: 10 //每页查询的条数
    },
    tableList: [], //列表数据
  },

  /**
   * 生命周期函数--监听页面加载
   */
  onLoad: function (options) {
    console.log('执行onload')
    //获取数据列表
    this.getHomeListApi();
    //数据加载完，停止下拉刷新
    wx.stopPullDownRefresh();
  },

  /**
   * 生命周期函数--监听页面初次渲染完成
   */
  onReady: function () {

  },

  /**
   * 生命周期函数--监听页面显示
   */
  onShow: function () {
    console.log('执行onshow')
    // 清空数据  setData赋值才会是响应式的数据，页面才会跟着变化
    // this.setData({
    //   tableList: [],
    //   total: 0
    // })
    
  },
  /**
   * 获取列表
   */
  async getHomeListApi() {
    let that = this;
    let res = await getHomeListApi(that.data.parms);
    if (res && res.code == 200) {
      console.log(res)
      //返回成功，把值赋值到data里面
      //方式1 ： 数据不是响应式的，data里面的数据发生变化，不会导致页面变化
      // that.data.tableList = res.data.records;
      // that.data.total = res.data.total;
      // console.log(that.data)
      //方式2: 响应式的数据，页面会发生变化
      that.setData({
        total: res.data.total,
        tableList: that.data.tableList.concat(res.data.records)
      })
      console.log(that.data)
    }
  },
  /**
   * 生命周期函数--监听页面隐藏
   */
  onHide: function () {

  },

  /**
   * 生命周期函数--监听页面卸载
   */
  onUnload: function () {

  },

  /**
   * 页面相关事件处理函数--监听用户下拉动作
   */
  onPullDownRefresh: function () {
    console.log('下拉刷新')
    //思路  从第一页开加载，把原来列表里面的数据清空
    this.data.parms.currentPage = 1;
    this.setData({
      tableList:[]
    })
    //重新加载列表
    this.onLoad();
  },

  /**
   * 页面上拉触底事件的处理函数
   */
  onReachBottom: function () {
    console.log('上拉刷新')
    //判断是否还有下一页，如果有，继续加载数据；没有，停止加载，信息提示
    let that = this;
    //总页数
    let totalPage = Math.ceil(that.data.total / that.data.parms.pageSize);
    if(that.data.parms.currentPage >=totalPage){ //说明没有下一页
      //信息提示
      wx.showToast({
        title: '没有更多数据了',
      })
    }else{
      that.setData({
        currentPage:that.data.parms.currentPage++
      })
      //从新加载数据
      that.onLoad();
    }
  },

  /**
   * 用户点击右上角分享
   */
  onShareAppMessage: function () {

  },
  gotoDetail:function(e){
    console.log(e)
    wx.navigateTo({
      url: '../detail/index',
    })
  }
})
```



#### 第33讲 小程序手机联调与本地图片展示问题

###### 小程序手机联调的几个要点：

###### 1、微信开发工具设置；

开发工具右上角，点击详情，本地设置；勾选不校验合法域名、web-view(业务域名)、TLS版本以及HTTPS证书；如下图所示

![](D:\项目实战\问卷调查系统\资料\images\小程序测试1.png)



###### 2、修改app.js里面的请求地址

​	 修改请求的url 为本机  ip和  端口号![](D:\项目实战\问卷调查系统\资料\images\小程序测试2.png)



###### 3、手机和电脑需要连接的是同一局域网，如手机和电脑连接同一wifi即可



###### 4、手机测试

点击微信开发者工具上面的预览，可以选择 二维码预览和 自动预览两种方式；如下图所示

![](D:\项目实战\问卷调查系统\资料\images\小程序测试3.png)



###### 5、手机测试，图片不显示问题

​	5.1、启动后端question-admin服务

​	5.2、数据库图片路径，需要把localhost改为 本机的 ip ;如下图所示

![](D:\项目实战\问卷调查系统\资料\images\小程序测试4.png)

改为如下所示

![](D:\项目实战\问卷调查系统\资料\images\小程序测试5.png)



#### 第34讲  问卷详情接口开发与数据对接

###### 1、新建答卷实体类

新建包 com.itmk.wxapi.answer_question

```js
package com.itmk.wxapi.answer_question.entity;

import com.baomidou.mybatisplus.annotation.IdType;
import com.baomidou.mybatisplus.annotation.TableId;
import com.baomidou.mybatisplus.annotation.TableName;
import lombok.Data;

import java.io.Serializable;
import java.util.Date;

@Data
@TableName("answer_question")
public class AnswerQuestion implements Serializable {
    @TableId(type = IdType.AUTO)
    private Long answerId;
    private Long questionId;
    private String openid;
    private Date createTime;
}

```

###### 2、新建答卷mapper层

```js
package com.itmk.wxapi.answer_question.mapper;

import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import com.itmk.wxapi.answer_question.entity.AnswerQuestion;

public interface AnswerQuestionMapper extends BaseMapper<AnswerQuestion> {
}

```

###### 3、新建mapper映射文件AnswerQuestionMapper.xml

```js
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.itmk.wxapi.answer_question.mapper.AnswerQuestionMapper">

</mapper>
```



###### 4、新建service层

```js
package com.itmk.wxapi.answer_question.service;

import com.baomidou.mybatisplus.extension.service.IService;
import com.itmk.wxapi.answer_question.entity.AnswerQuestion;

public interface AnswerQuestionService extends IService<AnswerQuestion> {
}

```

**实现类**

```js
package com.itmk.wxapi.answer_question.service.impl;

import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;
import com.itmk.wxapi.answer_question.entity.AnswerQuestion;
import com.itmk.wxapi.answer_question.mapper.AnswerQuestionMapper;
import com.itmk.wxapi.answer_question.service.AnswerQuestionService;
import org.springframework.stereotype.Service;

@Service
public class AnswerQuestionServiceImpl extends ServiceImpl<AnswerQuestionMapper, AnswerQuestion> implements AnswerQuestionService {
}

```

###### 5、HomeController控制器

在控制器中添加 getDetails 方法

```js
package com.itmk.wxapi.home;

import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;
import com.baomidou.mybatisplus.core.metadata.IPage;
import com.baomidou.mybatisplus.extension.plugins.pagination.Page;
import com.itmk.utils.ResultUtils;
import com.itmk.utils.ResultVo;
import com.itmk.wxapi.answer_question.entity.AnswerQuestion;
import com.itmk.wxapi.answer_question.service.AnswerQuestionService;
import com.itmk.wxapi.question.entity.SysQuestion;
import com.itmk.wxapi.question.entity.SysQuestionParn;
import com.itmk.wxapi.question.service.SysQuestionService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

/**
 * 小程序首控制器
 */
@RestController
@RequestMapping("/wxapi/home")
public class HomeController {
    @Autowired
    private SysQuestionService sysQuestionService;
    @Autowired
    private AnswerQuestionService answerQuestionService;

    /**
     * 查询首页列表
     */
    @GetMapping("/getList")
    public ResultVo getList(SysQuestionParn sysQuestionParn){
        //构造分页对象
        IPage<SysQuestion> page = new Page<>();
        page.setCurrent(sysQuestionParn.getCurrentPage());
        page.setSize(sysQuestionParn.getPageSize());
        IPage<SysQuestion> list = sysQuestionService.getList(page);
        return ResultUtils.success("查询成功",list);
    }
    /**
     * 问卷详情查询
     * 1、根据问卷id查询
     * 2、根据问卷id和openid查询
     *
     */
    @GetMapping("/getDetails")
    public ResultVo getDetails(String questionId,String openid){
        //1、根据问卷id查询
        SysQuestion question = sysQuestionService.getById(questionId);
        //2、根据问卷id和openid查询
        //构造查询条件
        QueryWrapper<AnswerQuestion> query = new QueryWrapper<>();
        query.lambda().eq(AnswerQuestion::getQuestionId,questionId)
                .eq(AnswerQuestion::getOpenid,openid);
        AnswerQuestion answerQuestion = answerQuestionService.getOne(query);
        if(answerQuestion != null){
            question.setStatus("1"); //已答卷
        }else{
            question.setStatus("0");//未答卷
        }
        return ResultUtils.success("查询成功",question);
    }
}

```

###### 7、小程序api/home.js中添加查询问卷详情的方法getDetailsApi()

```js
//引入http
const http = require('../utils/http.js')
//获取列表
export async function getHomeListApi(parm){
  return await http.GET("/wxapi/home/getList",parm)
}
//查询问卷详情表
export async function getDetailsApi(parm){
  return await http.GET("/wxapi/home/getDetails",parm)
}
```



###### 8、在home.wxml里面绑定问卷的id和点击事件

```js
data-questionId="{{item.questionId}}" bindtap="gotoDetail"
```

完整源码：

```js
<!--首页页面
<view> :视图容器 ,可以把他当做一个通常前端中div
homecontainer: 样式的名字，在home.wxss里面定义
-->
<view class='homecontainer'>
  <!--
  item:表示问卷的每一项；每一项是按从左到右排列 左侧是头像，右侧是 问卷信息
-->
  <view class="item" wx:for="{{tableList}}" wx:key='index'>
    <!-- 左侧图片 -->
    <!-- <image class="images" src="../../images/avuser.jpg"></image> -->
    <image class="images" src="{{item.questionImg}}"></image>
    <!--右侧 问卷信息 -->
    <view class="item-right" data-questionId="{{item.questionId}}" bindtap="gotoDetail">
      <view class="item-title">{{item.questionTitle}}</view>
      <view class="item-desc">{{item.questionDesc}}</view>
      <view class="item-join">参与人数:{{item.joinCount}}</view>
    </view>
  </view>
</view>
```

###### 9、在home下的home.js中添加上面页面中绑定的事件 gotoDetail()

```js
gotoDetail: function (e) {
    console.log(e)
    wx.navigateTo({
      url: '../detail/index?questionId=' + e.currentTarget.dataset.questionid,
    })
  }
```

###### 10、在页面模块detail下的index.js引入如下请求api 和 全局app

```js
const app = getApp();
import {
  getDetailsApi
} from '../../api/home.js'
```

###### 11、onLoad()方法改为如下,并添加 getDetails()方法

```js

  /**
   * 生命周期函数--监听页面加载
   */
  onLoad: function (options) {
    console.log('详情页')
    console.log(options)
    let parm = {
      questionId:options.questionId,
      openid:app.globalData.openid
    }
    this.getDetails(parm)
  },
  async getDetails(parm) {
    let res = await getDetailsApi(parm);
    console.log(res)
  },
```



#### 第35讲 问卷详情页制作

###### 1、详情页面

```js
<!--问卷详情页-->
<view class="detailcontainer">
  <view class="detail-item">
    <!-- 左侧图片 -->
    <image class="images" src='{{questionImg}}'></image>
    <!-- 右侧 -->
    <view class="item-right">
      <view class="item-title">{{questionTitle}}</view>
      <view class="item-desc">{{questionDesc}}</view>
    </view>
  </view>
  <!-- 分隔符 -->
  <view class="point"></view>
  <!-- 按钮 -->
  <view class="btn-item">
    <button wx:if="{{status == '0'}}" class="btn">开始答卷</button>
    <button wx:if="{{status == '1'}}" class="btn">已答卷</button>
  </view>
</view>
```

###### 2、index.js

```js
// pages/detail/index.js
const app = getApp();
import {
  getDetailsApi
} from '../../api/home.js'
Page({

  /**
   * 页面的初始数据
   */
  data: {
    questionDesc: '',
    questionId: '',
    questionImg: '',
    questionTitle: '',
    status: ''
  },

  /**
   * 生命周期函数--监听页面加载
   */
  onLoad: function (options) {
    console.log('详情页')
    console.log(options)
    let parm = {
      questionId: options.questionId,
      openid: app.globalData.openid
    }
    this.getDetails(parm)
  },
  async getDetails(parm) {
    let that = this;
    let res = await getDetailsApi(parm);
    if(res && res.code == 200){
      that.setData({
        questionDesc: res.data.questionDesc,
        questionId: res.data.questionId,
        questionImg: res.data.questionImg,
        questionTitle: res.data.questionTitle,
        status: res.data.status
      })
    }
  },
  /**
   * 生命周期函数--监听页面初次渲染完成
   */
  onReady: function () {

  },

  /**
   * 生命周期函数--监听页面显示
   */
  onShow: function () {

  },

  /**
   * 生命周期函数--监听页面隐藏
   */
  onHide: function () {

  },

  /**
   * 生命周期函数--监听页面卸载
   */
  onUnload: function () {

  },

  /**
   * 页面相关事件处理函数--监听用户下拉动作
   */
  onPullDownRefresh: function () {

  },

  /**
   * 页面上拉触底事件的处理函数
   */
  onReachBottom: function () {

  },

  /**
   * 用户点击右上角分享
   */
  onShareAppMessage: function () {

  }
})
```

###### 3、css样式

```js
.detailcontainer{
  height: 100%;
  width: 100%;
  display: flex;
  flex-direction: column;
  box-sizing: border-box;
}
.detail-item{
  display: flex;
  padding: 30rpx 10rpx 40rpx 20rpx;
}
.images{
  height: 120rpx;
  width: 120rpx;
}
.item-right{
  padding-left: 15rpx;
  display: flex;
  flex-direction: column;
  flex: 1;
}
.item-title{
  font-size: 36rpx;
  color: #333333;
}
.item-desc{
  padding-top: 15rpx;
  font-size: 28rpx;
  color: #666666;
}
.point{
  height: 15rpx;
  background-color: #e5e5e5;
}
.btn-item{
  margin-top: 100rpx;
  display: flex;
  flex-direction: column;
  flex: 1;
  align-items: center;
}
.btn{
  width: 75%!important;
  background-color: #6ECEB0;
  color: #FFF;
}

```



#### 第36讲 问卷试题接口开发与数据对接

###### 1、新建SysPaper实体类

新建包com.itmk.wxapi.sys_paper，然后新建SysPaper类

```js
package com.itmk.wxapi.sys_paper.entity;

import com.baomidou.mybatisplus.annotation.IdType;
import com.baomidou.mybatisplus.annotation.TableField;
import com.baomidou.mybatisplus.annotation.TableId;
import com.baomidou.mybatisplus.annotation.TableName;
import com.itmk.wxapi.sys_paper_choice.entity.SysPaperChoice;
import lombok.Data;

import java.io.Serializable;
import java.util.List;


@Data
@TableName("sys_paper")
public class SysPaper implements Serializable {
    //试题id
    @TableId(type = IdType.AUTO)
    private Long paperId;
    //问卷id
    private Long questionId;
    //标题
    private String paperTitle;
    //试题类型
    private String paperType;
    private Long paperOrder;

    //单选、多选题对应的选项,不属于 试题表，需要排除
    @TableField(exist =  false)
    private List<SysPaperChoice> paperChoice;
}

```

###### 2、新建SysPaperMapper接口

```js
package com.itmk.wxapi.sys_paper.mapper;

import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import com.itmk.wxapi.sys_paper.entity.SysPaper;


public interface SysPaperMapper extends BaseMapper<SysPaper> {
}

```

###### 3、新建SysPaperMapper.xml映射文件

```js
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.itmk.wxapi.sys_paper.mapper.SysPaperMapper">

</mapper>
```

###### 4、新建SysPaperService接口

```js
package com.itmk.wxapi.sys_paper.service;

import com.baomidou.mybatisplus.extension.service.IService;
import com.itmk.wxapi.sys_paper.entity.SysPaper;

public interface SysPaperService extends IService<SysPaper> {

}

```

**实现类**

```js
package com.itmk.wxapi.sys_paper.service.impl;
import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;

import com.itmk.wxapi.sys_paper.entity.SysPaper;
import com.itmk.wxapi.sys_paper.mapper.SysPaperMapper;
import com.itmk.wxapi.sys_paper.service.SysPaperService;
import org.springframework.stereotype.Service;

@Service
public class SysPaperServiceImpl extends ServiceImpl<SysPaperMapper, SysPaper> implements SysPaperService {

}

```

###### 5、新建SysPaperChoice实体类

```js
package com.itmk.wxapi.sys_paper_choice.entity;

import com.baomidou.mybatisplus.annotation.IdType;
import com.baomidou.mybatisplus.annotation.TableId;
import com.baomidou.mybatisplus.annotation.TableName;
import lombok.Data;

import java.io.Serializable;
@Data
@TableName("sys_paper_choice")
public class SysPaperChoice implements Serializable {
    //选项id
    @TableId(type = IdType.AUTO)
    private Long chioceId;
    //试题id
    private Long paperId;
    //选项的名称
    private String choiceText;
    //序号
    private Long choiceOrder;
}

```

###### 6、新建SysPaperChoiceMapper接口

```js
package com.itmk.wxapi.sys_paper_choice.mapper;

import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import com.itmk.wxapi.sys_paper_choice.entity.SysPaperChoice;

public interface SysPaperChoiceMapper extends BaseMapper<SysPaperChoice> {
}

```

###### 7、新建SysPaperChoiceMapper.xml映射文件

```js
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.itmk.wxapi.sys_paper_choice.mapper.SysPaperChoiceMapper">

</mapper>
```

###### 8、新建SysPaperChoiceService接口

```js
package com.itmk.wxapi.sys_paper_choice.service;

import com.baomidou.mybatisplus.extension.service.IService;
import com.itmk.wxapi.sys_paper_choice.entity.SysPaperChoice;
public interface SysPaperChoiceService extends IService<SysPaperChoice> {
}

```

**实现类**

```js
package com.itmk.wxapi.sys_paper_choice.service.impl;

import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;

import com.itmk.wxapi.sys_paper_choice.entity.SysPaperChoice;
import com.itmk.wxapi.sys_paper_choice.mapper.SysPaperChoiceMapper;
import com.itmk.wxapi.sys_paper_choice.service.SysPaperChoiceService;
import org.springframework.stereotype.Service;

@Service
public class SysPaperChoiceServiceImpl extends ServiceImpl<SysPaperChoiceMapper, SysPaperChoice> implements SysPaperChoiceService {
}

```

###### 9、HomeController控制器添加getPaperList()方法

```js
/**
     * 根据问卷id查询试题列表
     *
     * 1、查询问卷
     * 2、根据问卷id查试题列表
     * 3、查询单选和多选对应的选项
     */
    @GetMapping("/getPaperList")
    public ResultVo getPaperList(String questionId){
        // 1、查询问卷
        SysQuestion question = sysQuestionService.getById(questionId);
        //2、根据问卷id查试题列表
        //构造查询条件
        QueryWrapper<SysPaper> query = new QueryWrapper<>();
        query.lambda().eq(SysPaper::getQuestionId,questionId);
        //试题列表
        List<SysPaper> paperList = sysPaperService.list(query);
         // 3、查询单选和多选对应的选项
        for (int i=0;i<paperList.size();i++){
            //如果是单选或者多选的时候，需要查询选项
            if(paperList.get(i).getPaperType().equals("1") || paperList.get(i).getPaperType().equals("2")){
                QueryWrapper<SysPaperChoice> queryWrapper = new QueryWrapper<>();
                queryWrapper.lambda().eq(SysPaperChoice::getPaperId,paperList.get(i).getPaperId());
                List<SysPaperChoice> paperChoices = sysPaperChoiceService.list(queryWrapper);
                //设置单选和多选的选项
                paperList.get(i).setPaperChoice(paperChoices);
            }
        }
        //给问卷设置试题
        question.setListPaper(paperList);
        return ResultUtils.success("查询成功",question);
    }
```



#### 第37讲 试题页面制作

###### 1、页面代码

```js
<!--试题列表页面-->
<view class="answercontainer">
  <form>
    <view class="item" wx:for="{{paperList}}" wx:for-item='paper' wx:key='index'>
      <!-- 标题 -->
      <view class="title">
        {{index+1+'、'+paper.paperTitle}}
      </view>
      <!-- 试题选项 -->
      <view class="choiceList">
        <!-- 判断是单选、多选、单文本、多文本 -->
        <!-- 单选 -->
        <radio-group wx:if="{{paper.paperType == '1'}}">
          <label class="radioClass" wx:for="{{paper.paperChoice}}" wx:for-item='choice' wx:key='choice.chioceId'>
            <view>
              <radio value="{{choice.chioceId}}"></radio>
            </view>
            <view class="radioText">
              {{choice.choiceText}}
            </view>
          </label>
        </radio-group>
        <!-- 多选 -->
        <checkbox-group wx:if="{{paper.paperType == '2'}}">
          <label class="radioClass" wx:for="{{paper.paperChoice}}" wx:for-item='choice' wx:key='choice.chioceId'>
            <view>
              <checkbox value="{{choice.chioceId}}"></checkbox>
            </view>
            <view class="radioText">
              {{choice.choiceText}}
            </view>
          </label>
        </checkbox-group>
        <!-- 单文本 -->
        <input style="height:100rpx;" wx:if="{{paper.paperType == '3'}}" />
        <!-- 多文本 -->
        <textarea wx:if="{{paper.paperType == '4'}}"></textarea>
      </view>
    </view>
    <view class="bottom-bar">
      <button class="comit-btn">提交</button>
    </view>
  </form>
</view>
```



###### 2、css样式

```js
.answercontainer{
  /* height: 100%; */
  width: 100%;
  background-color: #F0F0F0;
  display: flex;
  flex-direction: column;
  box-sizing: border-box;
  padding-bottom: 125rpx;
}
.item{
  background-color: #FFF;
  margin: 25rpx;
  border-radius: 20rpx;
  padding: 25rpx;
}
.title{
  border-bottom: 1px solid #d1d1d1;
  padding-bottom: 20rpx;
  color: #333333;
}
.choiceList{
  color: #666666;
  display: flex;
  flex-direction: column;
}
.radioClass{
  display: flex;
  padding: 10rpx;
}
.radioText{
  padding-left: 10rpx;
}
.bottom-bar{
  width: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  position: fixed;
  bottom: 0;
  left: 0;
  background-color: #F0F0F0;
}
.comit-btn{
  width: 90%!important;
  background-color: #6ECEB0;
  color: #FFF;
  margin-bottom: 30rpx;
  z-index: 999;
}
```

###### 3、index.js

```js
// pages/answer/index.js
const app = getApp();
import {
  getPaperListApi
} from '../../api/home.js'
Page({

  /**
   * 页面的初始数据
   */
  data: {
    //试题数据列表
    paperList:[]
  },

  /**
   * 生命周期函数--监听页面加载
   */
  onLoad: function (options) {
    console.log(options)
    let parm = {
      questionId: options.questionId
    }
    this.getPaperList(parm);
  },
  async getPaperList(parm) {
    let that = this;
    let res = await getPaperListApi(parm);
    if (res && res.code == 200) {
      console.log(res)
      //如果数据变化，需要页面也变化，需要setData
      that.setData({
        paperList:res.data.listPaper
      })
      console.log(that.data.paperList)
    }
  },
  /**
   * 生命周期函数--监听页面初次渲染完成
   */
  onReady: function () {

  },

  /**
   * 生命周期函数--监听页面显示
   */
  onShow: function () {

  },

  /**
   * 生命周期函数--监听页面隐藏
   */
  onHide: function () {

  },

  /**
   * 生命周期函数--监听页面卸载
   */
  onUnload: function () {

  },

  /**
   * 页面相关事件处理函数--监听用户下拉动作
   */
  onPullDownRefresh: function () {

  },

  /**
   * 页面上拉触底事件的处理函数
   */
  onReachBottom: function () {

  },

  /**
   * 用户点击右上角分享
   */
  onShareAppMessage: function () {

  }
})
```



#### 第38讲  试题答题获取答案

###### 1、页面

```js
<!--试题列表页面-->
<view class="answercontainer">
  <form>
    <view class="item" wx:for="{{paperList}}" wx:for-item='paper' wx:key='index'>
      <!-- 标题 -->
      <view class="title">
        {{index+1+'、'+paper.paperTitle}}
      </view>
      <!-- 试题选项 -->
      <view class="choiceList">
        <!-- 判断是单选、多选、单文本、多文本 -->
        <!-- 单选 -->
        <radio-group data-papertype="{{paper.paperType}}" data-paperid="{{paper.paperId}}" bindchange="selectChange" wx:if="{{paper.paperType == '1'}}">
          <label class="radioClass" wx:for="{{paper.paperChoice}}" wx:for-item='choice' wx:key='choice.chioceId'>
            <view>
              <radio value="{{choice.chioceId}}"></radio>
            </view>
            <view class="radioText">
              {{choice.choiceText}}
            </view>
          </label>
        </radio-group>
        <!-- 多选 -->
        <checkbox-group data-papertype="{{paper.paperType}}" data-paperid="{{paper.paperId}}" bindchange="selectChange" wx:if="{{paper.paperType == '2'}}">
          <label class="radioClass" wx:for="{{paper.paperChoice}}" wx:for-item='choice' wx:key='choice.chioceId'>
            <view>
              <checkbox value="{{choice.chioceId}}"></checkbox>
            </view>
            <view class="radioText">
              {{choice.choiceText}}
            </view>
          </label>
        </checkbox-group>
        <!-- 单文本 -->
        <input data-papertype="{{paper.paperType}}" data-paperid="{{paper.paperId}}" bindblur="selectChange" style="height:100rpx;" wx:if="{{paper.paperType == '3'}}" />
        <!-- 多文本 -->
        <textarea data-papertype="{{paper.paperType}}" data-paperid="{{paper.paperId}}" bindblur="selectChange" wx:if="{{paper.paperType == '4'}}"></textarea>
      </view>
    </view>
    <view class="bottom-bar">
      <button class="comit-btn">提交</button>
    </view>
  </form>
</view>
```

###### 2、index.js

```js
// pages/answer/index.js
const app = getApp();
import {
  getPaperListApi
} from '../../api/home.js'
Page({

  /**
   * 页面的初始数据
   */
  data: {
    questionId: '',
    //试题数据列表
    paperList: [],
    //表单提交的数据
    answer: {
      openid: '',
      questionId: '',
      paperList: []
    }
  },

  /**
   * 生命周期函数--监听页面加载
   */
  onLoad: function (options) {
    console.log(options)
    this.setData({
      questionId: options.questionId
    })
    let parm = {
      questionId: options.questionId
    }
    this.getPaperList(parm);
  },
  async getPaperList(parm) {
    let that = this;
    let res = await getPaperListApi(parm);
    if (res && res.code == 200) {
      console.log(res)
      //如果数据变化，需要页面也变化，需要setData
      that.setData({
        paperList: res.data.listPaper
      })
      console.log(that.data.paperList)
    }
  },
  /**
   * 生命周期函数--监听页面初次渲染完成
   */
  onReady: function () {

  },

  /**
   * 生命周期函数--监听页面显示
   */
  onShow: function () {

  },

  /**
   * 生命周期函数--监听页面隐藏
   */
  onHide: function () {

  },

  /**
   * 生命周期函数--监听页面卸载
   */
  onUnload: function () {

  },

  /**
   * 页面相关事件处理函数--监听用户下拉动作
   */
  onPullDownRefresh: function () {

  },

  /**
   * 页面上拉触底事件的处理函数
   */
  onReachBottom: function () {

  },

  /**
   * 用户点击右上角分享
   */
  onShareAppMessage: function () {

  },
  selectChange(e) {
    // console.log(e)
    let that = this;
    //obj是试题信息和答案的存储
    let obj = {
      questionId: '',
      paperId: '',
      paperType: '',
      paperValue: ''
    }
    obj.questionId = that.data.questionId;
    obj.paperId = e.currentTarget.dataset.paperid;
    obj.paperType = e.currentTarget.dataset.papertype;
    //获取选中的值
    //多选的时候，需要把值设置为字符串
    if (e.currentTarget.dataset.papertype == '2') {
      obj.paperValue = e.detail.value.join(",")
    } else {
      obj.paperValue = e.detail.value;
    }
    //判断答卷是否存在
    let list = that.data.answer.paperList;
    if (list.length > 0) {
      //需要判断是否存在
      for (let i = 0; i < list.length; i++) {
        if (list[i].paperId === obj.paperId && list[i].paperType === obj.paperType) {
          //删除原来的
          list.splice(i, 1);
        }
      }
      //删除之后，把新的存进去
      list.push(obj);
    } else {
      list.push(obj);
    }
    console.log(list)
  }
})
```



#### 第39讲 问卷提交接口开发与数据对接

###### 1、新建AnswerPaper实体类

```js
package com.itmk.wxapi.answer_paper.entity;

import com.baomidou.mybatisplus.annotation.IdType;
import com.baomidou.mybatisplus.annotation.TableId;
import com.baomidou.mybatisplus.annotation.TableName;
import lombok.Data;

import java.io.Serializable;

@Data
@TableName("answer_paper")
public class AnswerPaper implements Serializable {
    @TableId(type = IdType.AUTO)
    private Long answerPaperId;
    private Long paperId;
    private String openid;
    private String paperType;
    private String paperValue;
}
```

###### 2、新建AnswerPaperMapper接口

```js
package com.itmk.wxapi.answer_paper.mapper;

import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import com.itmk.wxapi.answer_paper.entity.AnswerPaper;

public interface AnswerPaperMapper extends BaseMapper<AnswerPaper> {
}

```

###### 3、新建映射文件

```js
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.itmk.wxapi.answer_paper.mapper.AnswerPaperMapper">

</mapper>
```

###### 4、新建AnswerPaperService接口

```js
package com.itmk.wxapi.answer_paper.service;

import com.baomidou.mybatisplus.extension.service.IService;
import com.itmk.wxapi.answer_paper.entity.AnswerPaper;

public interface AnswerPaperService extends IService<AnswerPaper> {
}

```

**实现类**

```js
package com.itmk.wxapi.answer_paper.service.impl;

import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;
import com.itmk.wxapi.answer_paper.entity.AnswerPaper;
import com.itmk.wxapi.answer_paper.mapper.AnswerPaperMapper;
import com.itmk.wxapi.answer_paper.service.AnswerPaperService;
import org.springframework.stereotype.Service;

@Service
public class AnswerPaperServiceImpl extends ServiceImpl<AnswerPaperMapper, AnswerPaper> implements AnswerPaperService {
}

```

###### 5、新建AnswerPaperChoice实体类

```js
package com.itmk.wxapi.answer_paper_choice.entity;

import com.baomidou.mybatisplus.annotation.IdType;
import com.baomidou.mybatisplus.annotation.TableId;
import com.baomidou.mybatisplus.annotation.TableName;
import lombok.Data;

import java.io.Serializable;
@Data
@TableName("answer_paper_choice")
public class AnswerPaperChoice implements Serializable {
    @TableId(type = IdType.AUTO)
    private Long answerChoiceId;
    private Long paperId;
    private Long chioceId;
    private String openid;
}

```

###### 6、新建AnswerPaperChoiceMapper接口

```js
package com.itmk.wxapi.answer_paper_choice.mapper;

import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import com.itmk.wxapi.answer_paper_choice.entity.AnswerPaperChoice;

public interface AnswerPaperChoiceMapper extends BaseMapper<AnswerPaperChoice> {
}

```

###### 7、新建AnswerPaperChoiceMapper映射文件

```js
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.itmk.wxapi.answer_paper_choice.mapper.AnswerPaperChoiceMapper">

</mapper>
```

###### 8、新建AnswerPaperChoiceService接口

```js
package com.itmk.wxapi.answer_paper_choice.service;

import com.baomidou.mybatisplus.extension.service.IService;
import com.itmk.wxapi.answer_paper_choice.entity.AnswerPaperChoice;

public interface AnswerPaperChoiceService extends IService<AnswerPaperChoice> {
}

```

**实现类**

```js
package com.itmk.wxapi.answer_paper_choice.service.impl;

import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;
import com.itmk.wxapi.answer_paper_choice.entity.AnswerPaperChoice;
import com.itmk.wxapi.answer_paper_choice.mapper.AnswerPaperChoiceMapper;
import com.itmk.wxapi.answer_paper_choice.service.AnswerPaperChoiceService;
import org.springframework.stereotype.Service;

@Service
public class AnswerPaperChoiceServiceImpl extends ServiceImpl<AnswerPaperChoiceMapper, AnswerPaperChoice> implements AnswerPaperChoiceService {
}

```

###### 9、AnswerQuestionService接口添加如下方法

```js
void saveCommit(CommitParm parm);
```

###### 10、实现上面方法

```js
package com.itmk.wxapi.answer_question.service.impl;

import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;
import com.itmk.wxapi.answer_paper.entity.AnswerPaper;
import com.itmk.wxapi.answer_paper.service.AnswerPaperService;
import com.itmk.wxapi.answer_paper_choice.entity.AnswerPaperChoice;
import com.itmk.wxapi.answer_paper_choice.service.AnswerPaperChoiceService;
import com.itmk.wxapi.answer_question.entity.AnswerQuestion;
import com.itmk.wxapi.answer_question.entity.CommitParm;
import com.itmk.wxapi.answer_question.entity.PaperPrm;
import com.itmk.wxapi.answer_question.mapper.AnswerQuestionMapper;
import com.itmk.wxapi.answer_question.service.AnswerQuestionService;
import org.springframework.beans.BeanUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.ArrayList;
import java.util.Date;
import java.util.List;

@Service
public class AnswerQuestionServiceImpl extends ServiceImpl<AnswerQuestionMapper, AnswerQuestion> implements AnswerQuestionService {
    @Autowired
    private AnswerPaperChoiceService answerPaperChoiceService;
    @Autowired
    private AnswerPaperService answerPaperService;

    @Override
    @Transactional
    public void saveCommit(CommitParm parm) {
        //保存answer_question表
        AnswerQuestion answerQuestion = new AnswerQuestion();
        answerQuestion.setOpenid(parm.getOpenid());
        answerQuestion.setQuestionId(parm.getQuestionId());
        answerQuestion.setCreateTime(new Date());
        this.baseMapper.insert(answerQuestion);
        //保存answer_paper表
        //前端传来的试题
        List<PaperPrm> paperList = parm.getPaperList();
        List<AnswerPaper> list = new ArrayList<>();
        for(int i=0;i<paperList.size();i++){
            AnswerPaper answerPaper = new AnswerPaper();
            BeanUtils.copyProperties(paperList.get(i),answerPaper);
            answerPaper.setOpenid(parm.getOpenid());
            list.add(answerPaper);
            //保存answer_paper_choice表
            //单选和多选需要单独保存选项
            if(paperList.get(i).getPaperType().equals("1")){
                AnswerPaperChoice choice = new AnswerPaperChoice();
                choice.setOpenid(parm.getOpenid());
                choice.setPaperId(paperList.get(i).getPaperId());
                choice.setChioceId(Long.valueOf(paperList.get(i).getPaperValue()));
                answerPaperChoiceService.save(choice);
            }
            if(paperList.get(i).getPaperType().equals("2")){
                String regx = ",";
                String[] strings = paperList.get(i).getPaperValue().split(regx);
                List<AnswerPaperChoice> choiceList = new ArrayList<>();
                for(int j=0;j<strings.length;j++){
                    AnswerPaperChoice choice = new AnswerPaperChoice();
                    choice.setOpenid(parm.getOpenid());
                    choice.setPaperId(paperList.get(i).getPaperId());
                    choice.setChioceId(Long.valueOf(strings[j]));
                    choiceList.add(choice);
                }
                answerPaperChoiceService.saveBatch(choiceList);
            }
        }
        answerPaperService.saveBatch(list);
    }
}

```

###### 11、HomeController控制器添加如下方法

```js
/**
     * 保存问卷
     */
    @PostMapping("/saveCommit")
    public ResultVo saveCommit(@RequestBody CommitParm parm){
        answerQuestionService.saveCommit(parm);
        return ResultUtils.success("提交成功!");
    }
```

###### 12、前端小程序api/home.js添加如下方法

```js
//问卷提交
export async function saveCommitApi(parm){
  return await http.POST("/wxapi/home/saveCommit",parm)
}
```

###### 13、pages/answer/index.js添加如下方法

```js
//问卷提交事件
  async submitBtn(e) {
    this.data.answer.openid = app.globalData.openid;
    this.data.answer.questionId = this.data.questionId;
    console.log(this.data.answer)
    let res = await saveCommitApi(this.data.answer);
    if (res && res.code == 200) {
      console.log(res)
      wx.navigateBack({
        delta:1
      })
    }
  }
```



#### 第40讲 解决提交成功页面返回刷新问题

#### 第41讲  我的页面接口开发与数据对接

###### 1、页面

```js
<view class="userInfo">
  <open-data type="userAvatarUrl" class="userImg"></open-data>
  <open-data type="userNickName"></open-data>
</view>
<view class="answerList">
  <view wx:for="{{tableList}}" wx:key='index'>
    <view class="item">
      <!-- <image class="images" src="../../images/diaocha.png"></image> -->
      <image class="images" src="{{item.questionImg}}"></image>
      <view class="item-right" data-item="{{item}}" bindtap="gotoDetail">
        <view class="item-title">{{item.questionTitle}}</view>
        <view class="item-desc">{{item.questionDesc}}</view>
        <view class="item-desc">参与人数:{{item.joinCount}}人</view>
      </view>
    </view>
  </view>
</view>
```

###### 2、样式

```js
.userInfo{
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}
.userImg{
  height: 120rpx;
  width: 120rpx;
  border-radius: 50%;
  overflow: hidden;
  margin-top: 15rpx;
}
.answerList{
  margin-top: 20rpx;
  border-top: solid 1px #e5e5e5;
  display: flex;
  flex-direction: column;
  box-sizing: border-box;
}

.item {
  padding: 20rpx 20rpx;
  height: 200rpx;
  display: flex;
  align-items: center;
  border-bottom: 1px solid #e8eaec;
}

.images {
  width: 140rpx;
  height: 140rpx;
  border: 1px solid #e8eaec;
  border-radius: 50%;
}

.item-right {
  padding-left: 15rpx;
  display: flex;
  flex: 1;
  flex-direction: column;
  background-color: #FFF;
}

.item-title {
  font-size: 36rpx;
  color: #333333;
}

.item-desc {
  padding-top: 15rpx;
  font-size: 28rpx;
  color: #666666;
  display:-webkit-box;
  -webkit-line-clamp:1;
  overflow:hidden;
  text-overflow:ellipsis;
  -webkit-box-orient:vertical;
  word-break:break-all;
}
```

###### 3、index.js

```js
// pages/mypage/mypage.js
import {
  getMyQuestListApi
} from '../../api/home'
//获取应用实例
var app = getApp();
Page({

  /**
   * 页面的初始数据
   */
  data: {
    total: 0,
    //获取列表参数
    parms: {
      currentPage: 1,
      pageSize: 10,
      openid: app.globalData.openid
    },
    //列表数据
    tableList: []
  },

  /**
   * 生命周期函数--监听页面加载
   */
  onLoad: function (options) {
    console.log('我的野蛮')
    console.log(app.globalData.openid)
  },

  //获取问卷列表
  async getQuestionList() {
    let that = this;
    console.log(this.data.total)
    this.data.parms.openid = app.globalData.openid;
    let res = await getMyQuestListApi(this.data.parms);
    console.log(res)
    if (res && res.code == 200) {
      //注意，赋值不能使用this.data.的方式赋值，这样没有双向数据绑定的效果，虽然有数据，但是页面不会改变
      that.setData({
        tableList: that.data.tableList.concat(res.data.records),
        total: res.data.total
      })
      // that.data.parms.total = res.data.total;
      console.log(res.data.total)
    }
  },
  /**
   * 生命周期函数--监听页面初次渲染完成
   */
  onReady: function () {

  },

  /**
   * 生命周期函数--监听页面显示
   */
  onShow: function () {
    this.setData({
      tableList:[],
      total:0
    })
   //获取问卷列表
   this.getQuestionList();
   //停止下拉刷新
   wx.stopPullDownRefresh(); 
  },

  /**
   * 生命周期函数--监听页面隐藏
   */
  onHide: function () {

  },

  /**
   * 生命周期函数--监听页面卸载
   */
  onUnload: function () {

  },

  /**
   * 页面相关事件处理函数--监听用户下拉动作
   */
  onPullDownRefresh: function () {
    console.log('下拉刷新了')
    this.data.parms.currentPage = 1;
    this.data.tableList = [];
    this.onLoad();
  },

  /**
   * 页面上拉触底事件的处理函数
   */
  onReachBottom: function () {
    console.log('上拉刷新了')
    let that = this;
    let totalPage = Math.ceil(that.data.total / that.data.parms.pageSize);
    if (that.data.parms.currentPage >= totalPage) {
      //如果data中的当前页数大于等于总页数，则没有下一页啦
      wx.showToast({
        title: '没有更多数据了',
      })
    } else {
      that.setData({
        currentPage: that.data.parms.currentPage++
      })
      console.log(this.data.parms)
      that.onLoad();
    }
  },

  /**
   * 用户点击右上角分享
   */
  onShareAppMessage: function () {

  },
  //跳转到详情页
  gotoDetail:function(e) {
    console.log(e.currentTarget.dataset.item)
    wx.navigateTo({
     url:'../myanswer/index?questionId='+e.currentTarget.dataset.item.questionId
    })
  }
})
```



#### 第42讲  我的问卷详情查看接口开发

###### 1、小程序模块的SysPaperService接口新增方法

```js
package com.itmk.wxapi.sys_paper.service;

import com.baomidou.mybatisplus.extension.service.IService;
import com.itmk.wxapi.sys_paper.entity.SysPaper;

import java.util.List;

public interface SysPaperService extends IService<SysPaper> {
    List<SysPaper> getMyPaperList(Long questionId,String openid);
}

```



###### 2、实现上面的方法

```js
package com.itmk.wxapi.sys_paper.service.impl;
import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;

import com.itmk.wxapi.sys_paper.entity.SysPaper;
import com.itmk.wxapi.sys_paper.mapper.SysPaperMapper;
import com.itmk.wxapi.sys_paper.service.SysPaperService;
import org.springframework.stereotype.Service;

import java.util.List;

@Service
public class SysPaperServiceImpl extends ServiceImpl<SysPaperMapper, SysPaper> implements SysPaperService {

    @Override
    public List<SysPaper> getMyPaperList(Long questionId, String openid) {
        return this.baseMapper.getMyPaperList(questionId,openid);
    }
}

```

###### 3、SysPaperMapper添加如下方法

```js
package com.itmk.wxapi.sys_paper.mapper;

import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import com.itmk.wxapi.sys_paper.entity.SysPaper;
import org.apache.ibatis.annotations.Param;

import java.util.List;


public interface SysPaperMapper extends BaseMapper<SysPaper> {
    List<SysPaper> getMyPaperList(@Param("questionId") Long questionId,@Param("openid") String openid);
}

```

###### 4、SysPaperMapper.xml映射文件添加sql

```js
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.itmk.wxapi.sys_paper.mapper.SysPaperMapper">
    <select id="getMyPaperList">
        select  sp.*,ap.paper_value
        from  answer_question as aq
        left join sys_paper as sp on sp.question_id = aq.question_id
        left join answer_paper as ap on sp.paper_id = ap.paper_id
        where aq.openid =#{openid}  and aq.question_id =#{questionId}
    </select>
</mapper>
```

###### 5、SysQuestionService添加getMyPaperList()方法

```js
	//查询问卷回显列表
    SysQuestion getMyPaperList(Long questionId,String openid);
```

###### 6、实现上面方法

```js
 @Override
    public SysQuestion getMyPaperList(Long questionId, String openid) {
        //根据问卷id查询问卷
        SysQuestion sysQuestion = this.baseMapper.selectById(questionId);
        //根据问卷id查询试题列表
        //构造查询条件
        QueryWrapper<SysPaper> query = new QueryWrapper<>();
        query.lambda().eq(SysPaper::getQuestionId,questionId);
        //问卷的所有试题列表
        List<SysPaper> paperList = sysPaperService.list(query);
        //查询用户做的试题列表 根据openid查询
        List<SysPaper> myPaperList = sysPaperService.getMyPaperList(questionId, openid);
        if(paperList.size()>0){
            for (int i=0;i<paperList.size();i++){
                for (int j=0;j<myPaperList.size();j++){
                    //两个id相等，说明做了试题
                    if(paperList.get(i).getPaperId().equals(myPaperList.get(j).getPaperId())){
                        //设置用户的答案
                        paperList.get(i).setPaperValue(myPaperList.get(j).getPaperValue());
                        //判断是否是单选和多选
                        if(paperList.get(i).getPaperType().equals("1") || paperList.get(i).getPaperType().equals("2")){
                            //查询对应的选项
                            QueryWrapper<SysPaperChoice> queryWrapper = new QueryWrapper<>();
                            queryWrapper.lambda().eq(SysPaperChoice::getPaperId,paperList.get(i).getPaperId());
                            //试题选项
                            List<SysPaperChoice> choiceList = sysPaperChoiceService.list(queryWrapper);
                            for (int k=0;k<choiceList.size();k++){
                                String regex = ",";
                                //原来的答案
                                String[] strings = myPaperList.get(j).getPaperValue().split(regex);
                                for (int h=0;h<strings.length;h++){

                                    if(choiceList.get(k).getChioceId().equals(Long.valueOf(strings[h]))){
                                        choiceList.get(k).setChecked(true);
                                    }
                                }
                            }
                            paperList.get(i).setPaperChoice(choiceList);
                        }
                    }
                }
            }
        }
        sysQuestion.setListPaper(paperList);
        return sysQuestion;
    }
```

###### 7、HomeController控制器添加getMyPaperListShow()方法

```js
 /**
     * 查询试题回显
     */
    @GetMapping("/getMyPaperListShow")
    public ResultVo getMyPaperListShow(String openid,Long questionId){
        SysQuestion list = sysQuestionService.getMyPaperList(questionId,openid);
        return ResultUtils.success("查询成功",list);
    }
```



#### 第43讲  问卷试题回显数据对接

###### 1、页面

```js
<!--试题列表页面-->
<view class="answercontainer">
  <form>
    <view class="item" wx:for="{{paperList}}" wx:for-item='paper' wx:key='index'>
      <!-- 标题 -->
      <view class="title">
        {{index+1+'、'+paper.paperTitle}}
      </view>
      <!-- 试题选项 -->
      <view class="choiceList">
        <!-- 判断是单选、多选、单文本、多文本 -->
        <!-- 单选 -->
        <radio-group data-papertype="{{paper.paperType}}" data-paperid="{{paper.paperId}}"  wx:if="{{paper.paperType == '1'}}">
          <label class="radioClass" wx:for="{{paper.paperChoice}}" wx:for-item='choice' wx:key='choice.chioceId'>
            <view>
              <radio disabled checked="{{choice.checked}}" value="{{choice.chioceId}}"></radio>
            </view>
            <view class="radioText">
              {{choice.choiceText}}
            </view>
          </label>
        </radio-group>
        <!-- 多选 -->
        <checkbox-group data-papertype="{{paper.paperType}}" data-paperid="{{paper.paperId}}"  wx:if="{{paper.paperType == '2'}}">
          <label class="radioClass" wx:for="{{paper.paperChoice}}" wx:for-item='choice' wx:key='choice.chioceId'>
            <view>
              <checkbox disabled checked="{{choice.checked}}" value="{{choice.chioceId}}"></checkbox>
            </view>
            <view class="radioText">
              {{choice.choiceText}}
            </view>
          </label>
        </checkbox-group>
        <!-- 单文本 -->
        <input disabled data-papertype="{{paper.paperType}}" data-paperid="{{paper.paperId}}"  style="height:100rpx;" value="{{paper.paperValue}}" wx:if="{{paper.paperType == '3'}}" />
        <!-- 多文本 -->
        <textarea disabled data-papertype="{{paper.paperType}}" value="{{paper.paperValue}}" data-paperid="{{paper.paperId}}"  wx:if="{{paper.paperType == '4'}}"></textarea>
      </view>
    </view>
  </form>
</view>
```

###### 2、index.js

```js
// pages/answer/index.js
const app = getApp();
import {
  getMyPaperListShowApi
} from '../../api/home.js'
Page({

  /**
   * 页面的初始数据
   */
  data: {
    questionId: '',
    //试题数据列表
    paperList: [],
    //表单提交的数据
    answer: {
      openid: '',
      questionId: '',
      paperList: []
    }
  },

  /**
   * 生命周期函数--监听页面加载
   */
  onLoad: function (options) {
    console.log(options)
    this.setData({
      questionId: options.questionId
    })
    let parm = {
      questionId: options.questionId,
      openid:wx.getStorageSync('openid')
    }
    this.getPaperList(parm);
  },
  async getPaperList(parm) {
    let that = this;
    let res = await getMyPaperListShowApi(parm);
    if (res && res.code == 200) {
      console.log(res)
      //如果数据变化，需要页面也变化，需要setData
      that.setData({
        paperList: res.data.listPaper
      })
      console.log(that.data.paperList)
    }
  },
  /**
   * 生命周期函数--监听页面初次渲染完成
   */
  onReady: function () {

  },

  /**
   * 生命周期函数--监听页面显示
   */
  onShow: function () {

  },

  /**
   * 生命周期函数--监听页面隐藏
   */
  onHide: function () {

  },

  /**
   * 生命周期函数--监听页面卸载
   */
  onUnload: function () {

  },

  /**
   * 页面相关事件处理函数--监听用户下拉动作
   */
  onPullDownRefresh: function () {

  },

  /**
   * 页面上拉触底事件的处理函数
   */
  onReachBottom: function () {

  },

  /**
   * 用户点击右上角分享
   */
  onShareAppMessage: function () {

  },
  selectChange(e) {
    // console.log(e)
    let that = this;
    //obj是试题信息和答案的存储
    let obj = {
      questionId: '',
      paperId: '',
      paperType: '',
      paperValue: ''
    }
    obj.questionId = that.data.questionId;
    obj.paperId = e.currentTarget.dataset.paperid;
    obj.paperType = e.currentTarget.dataset.papertype;
    //获取选中的值
    //多选的时候，需要把值设置为字符串
    if (e.currentTarget.dataset.papertype == '2') {
      obj.paperValue = e.detail.value.join(",")
    } else {
      obj.paperValue = e.detail.value;
    }
    //判断答卷是否存在
    let list = that.data.answer.paperList;
    if (list.length > 0) {
      //需要判断是否存在
      for (let i = 0; i < list.length; i++) {
        if (list[i].paperId === obj.paperId && list[i].paperType === obj.paperType) {
          //删除原来的
          list.splice(i, 1);
        }
      }
      //删除之后，把新的存进去
      list.push(obj);
    } else {
      list.push(obj);
    }
    console.log(list)
  },
  //问卷提交事件
  async submitBtn(e) {
    this.data.answer.openid = app.globalData.openid;
    this.data.answer.questionId = this.data.questionId;
    console.log(this.data.answer)
    let res = await saveCommitApi(this.data.answer);
    if (res && res.code == 200) {
      console.log(res)
      wx.navigateBack({
        delta:1
      })
    }
  }
})
```

###### 3、api/home.js

```js
//试题回显
export async function getMyPaperListShowApi(params) {
  return await http.GET("/wxapi/home/getMyPaperListShow",params)
}
```

###### 4、样式

```js
.answercontainer{
  /* height: 100%; */
  width: 100%;
  background-color: #F0F0F0;
  display: flex;
  flex-direction: column;
  box-sizing: border-box;
  /* padding-bottom: 125rpx; */
}
.item{
  background-color: #FFF;
  margin: 25rpx;
  border-radius: 20rpx;
  padding: 25rpx;
}
.title{
  border-bottom: 1px solid #d1d1d1;
  padding-bottom: 20rpx;
  color: #333333;
}
.choiceList{
  color: #666666;
  display: flex;
  flex-direction: column;
}
.radioClass{
  display: flex;
  padding: 10rpx;
}
.radioText{
  padding-left: 10rpx;
}
.bottom-bar{
  width: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  position: fixed;
  bottom: 0;
  left: 0;
  background-color: #F0F0F0;
}
.comit-btn{
  width: 90%!important;
  background-color: #6ECEB0;
  color: #FFF;
  margin-bottom: 30rpx;
  z-index: 999;
}
```



#### 第44讲 问卷投票统计接口开发

###### 1、在后台模块SysPaperChoiceMapper接口添加如下方法

```js
 List<SysPaperChoice> getListPaperChoice(@Param("questionId") Long questionId);
```

###### 2、SysPaperChoiceMapper.xml添加映射文件

```js
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.itmk.web.sys_paper_choice.mapper.SysPaperChoiceMapper">
    <select id="getListPaperChoice" resultType="com.itmk.web.sys_paper_choice.entity.SysPaperChoice">
        select  sp.question_id,spc.*,count(ac.chioce_id) as total
        from  sys_paper as sp
        right join sys_paper_choice as spc  on sp.paper_id = spc.paper_id
        left join answer_paper_choice as ac on ac.chioce_id = spc.chioce_id
        where sp.question_id =#{questionId}
        GROUP BY spc.chioce_id
    </select>
</mapper>
```

###### 3、SysPaperChoiceService接口添加如下方法

```js
 List<SysPaperChoice> getListPaperChoice(Long questionId);
```

###### 4、实现上面的方法

```js
package com.itmk.web.sys_paper_choice.service.impl;

import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;
import com.itmk.web.sys_paper_choice.entity.SysPaperChoice;
import com.itmk.web.sys_paper_choice.mapper.SysPaperChoiceMapper;
import com.itmk.web.sys_paper_choice.service.SysPaperChoiceService;
import org.springframework.stereotype.Service;

import java.util.List;

@Service
public class SysPaperChoiceServiceImpl extends ServiceImpl<SysPaperChoiceMapper, SysPaperChoice> implements SysPaperChoiceService {
    @Override
    public List<SysPaperChoice> getListPaperChoice(Long questionId) {
        return this.baseMapper.getListPaperChoice(questionId);
    }
}

```

###### 5、SysPaperChoice实体类添加如下字段

```js
    @TableField(exist = false)
    private Long questionId;
    @TableField(exist = false)
    private Long total;  
```

###### 6、SysQuestionController控制器添加getTotalList()方法

```js
/**
     * 问卷统计查询
     */
    @GetMapping("/getTotalList")
    public ResultVo getTotalList(Long questionId){
        //1、查询问卷详情
        SysQuestion sysQuestion = sysQuestionService.getById(questionId);
        //2、查询问卷的所有试题
        QueryWrapper<SysPaper> query = new QueryWrapper<>();
        query.lambda().eq(SysPaper::getQuestionId,questionId)
                .orderByAsc(SysPaper::getPaperOrder);
        List<SysPaper> paperList = sysPaperService.list(query);
        //3查询试题对应的选项统计
        List<SysPaperChoice> choiceList = sysPaperChoiceService.getListPaperChoice(questionId);
        for (int i=0;i<paperList.size();i++){
            List<SysPaperChoice> paperChoice = new ArrayList<>();
            Long paperId = paperList.get(i).getPaperId();
            choiceList.stream().filter(item -> item.getPaperId().equals(paperId)).forEach(item->{
                SysPaperChoice choice = new SysPaperChoice();
                BeanUtils.copyProperties(item,choice);
                paperChoice.add(choice);
            });
            //设置单选、多选的选项
            paperList.get(i).setPaperChoice(paperChoice);
        }
        sysQuestion.setListPaper(paperList);
        return ResultUtils.success("查询成功",sysQuestion);
    }
```



#### 第45讲 问卷投票统计页面开发

###### 1、api/question.js添加getTotalListApi()方法

```js

//统计查询
export async function getTotalListApi(parm){
    return await http.get("/api/question/getTotalList",parm)
}
```

###### 2、页面源码

```js
<template>
  <el-main>
    <!-- 模糊查询 -->
    <el-form
      :model="parms"
      ref="searchForm"
      label-width="80px"
      :inline="true"
      size="small"
    >
      <el-form-item label="问卷标题">
        <el-input v-model="parms.questionTitle"></el-input>
      </el-form-item>
      <el-form-item>
        <el-button icon="el-icon-search" @click="searchBtn">搜索</el-button>
        <el-button style="color: #ff7670" @click="resetBtn" icon="el-icon-close"
          >重置</el-button
        >
      </el-form-item>
    </el-form>
    <!-- 表格列表 -->
    <el-table :height="tableHeight" :data="tableList" border stripe>
      <el-table-column prop="questionImg" width="80" label="问卷图片" align="center">
        <template slot-scope="scope">
          <el-image
            style="width: 50px; height: 50px; border-radius: 50%"
            :src="scope.row.questionImg"
          ></el-image>
        </template>
      </el-table-column>
      <el-table-column prop="questionTitle" label="问卷标题"></el-table-column>
      <el-table-column prop="questionDesc" label="问卷描述"></el-table-column>
      <el-table-column prop="questionOrder" label="问卷序号"></el-table-column>
      <el-table-column prop="questionStatus" label="状态">
        <template slot-scope="scope">
          <el-tag v-if="scope.row.questionStatus == '0'" type="danger" size="normal"
            >关闭</el-tag
          >
          <el-tag v-if="scope.row.questionStatus == '1'" type="success" size="normal"
            >调查中</el-tag
          >
        </template>
      </el-table-column>
      <el-table-column align="center" width="150" label="操作">
        <template slot-scope="scope">
          <el-button
            type="primary"
            icon="el-icon-edit"
            size="small"
            @click="lookBtn(scope.row)"
            >查看票数</el-button
          >
        </template>
      </el-table-column>
    </el-table>
    <!-- 分页 
    @size-change 页容量改变时触发的事件
    @current-change 页数改变时触发的事件
    :current-page  当前第几页 
    :page-sizes 
    :page-size  没有查询几条
     :total 总条数
    -->
    <el-pagination
      @size-change="sizeChange"
      @current-change="currentChange"
      :current-page.sync="parms.currentPage"
      :page-sizes="[10, 20, 40, 80, 100]"
      :page-size="parms.pageSize"
      layout="total, sizes, prev, pager, next, jumper"
      :total="parms.total"
      background
    >
    </el-pagination>
    <!-- 弹框 -->
    <sys-dialog
      :title="addDialog.title"
      :height="addDialog.height"
      :width="addDialog.width"
      :visible="addDialog.visible"
      @onClose="onClose"
      @onConfirm="onConfirm"
    >
      <template slot="content">
        <div>
          <div
            style="
              text-align: center;
              font-size: 21px;
              font-weight: 600;
              padding: 10px 0px;
            "
          >
            {{ questionTitle }}
          </div>
          <table style="width: 100%" border="1">
            <thead>
              <th>题目</th>
              <th>选项</th>
              <th>票数</th>
            </thead>
            <tbody>
              <template v-for="item in lookTableList">
                <tr v-for="(m, i) in item.paperChoice" :key="m.chioceId">
                  <td style="width:40%;text-align:center;" v-if='i == 0' :rowspan="item.paperChoice.length">{{item.paperTitle}}</td>
                  <td>{{m.choiceText}}</td>
                  <td>{{m.total}}</td>
                </tr>
              </template>
            </tbody>
          </table>
        </div>
      </template>
    </sys-dialog>
  </el-main>
</template>

<script>
import { getListApi, getTotalListApi } from "@/api/question";
import SysDialog from "@/components/system/SysDialog.vue";
export default {
  //注册组件
  components: {
    SysDialog,
  },
  data() {
    return {
      questionTitle: "",
      //统计表格的数据
      lookTableList: [],
      addDialog: {
        title: "票数统计",
        height: 500,
        width: 950,
        visible: false,
      },
      //表格的高度
      tableHeight: 0,
      //表格数据
      tableList: [],
      //列表参数
      parms: {
        currentPage: 1,
        pageSize: 10,
        questionTitle: "",
        total: 0, //分页用的总条数
      },
    };
  },
  created() {
    this.getList();
  },
  mounted() {
    this.$nextTick(() => {
      this.tableHeight = window.innerHeight - 200;
    });
  },
  methods: {
    //弹框确认
    onConfirm() {
      this.addDialog.visible = false;
    },
    //弹框的关闭
    onClose() {
      this.addDialog.visible = false;
    },
    //查看票数
    async lookBtn(row) {
      //查询统计数据
      let res = await getTotalListApi({ questionId: row.questionId });
      if (res && res.code == 200) {
        console.log(res.data.listPaper);
        this.lookTableList = res.data.listPaper;
        this.questionTitle = res.data.questionTitle;
      }
      this.addDialog.visible = true;
    },
    //重置按钮
    resetBtn() {
      this.parms.questionTitle = "";
      this.getList();
    },
    //搜索按钮
    searchBtn() {
      this.getList();
    },
    //页数改变时触发
    currentChange(val) {
      this.parms.currentPage = val;
      this.getList();
    },
    //页容量改变时触发
    sizeChange(val) {
      this.parms.pageSize = val;
      this.parms.currentPage = 1;
      this.getList();
    },
    //获取列表
    async getList() {
      let res = await getListApi(this.parms);
      if (res && res.code == 200) {
        //给表格数据赋值
        this.tableList = res.data.records;
        //分页总条数
        this.parms.total = res.data.total;
      }
      console.log(res);
    },
  },
};
</script>

<style lang="scss" scoped>
table {
  // width: 300px;
  text-align: center;
  border-collapse: collapse; /* 为table设置这个属性 */
}
</style>

```



#### 第46讲 投票统计打印功能实现

###### 1、安装打印插件

```js
npm install vue-print-nb --save
```

###### 2、在main.js引入插件

```js
//打印
import Print from 'vue-print-nb'
 Vue.use(Print); 
```



#### 第47讲  用户退出功能讲解



